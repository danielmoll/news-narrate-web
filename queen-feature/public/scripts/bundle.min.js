"use strict";var Game={};Game={},Game.State={},Game.Map={},Game.Map.Object={},Game.Score={nbCollectibles:0,nbCollected:0,levelScores:{},allCollected:function(){return this.nbCollectibles===this.nbCollected}},Game.Map.MAPS=["tutorial","decade_50s","decade_60s","decade_2010s"],Game.Levels=[{text:"50s",stateKey:"decade_50s",spriteKey:"button_level_50s",collectibles:["record","tv","mini"]},{text:"60s",stateKey:"decade_60s",spriteKey:"button_level_60s",collectibles:["beatles","the_sun","worldcup"]},{text:"70s",stateKey:null,spriteKey:"button_level_70s",collectibles:[".",".","."]},{text:"80s",stateKey:"tutorial",spriteKey:"button_level_80s",collectibles:["corgi",".","."]},{text:"90s",stateKey:null,spriteKey:"button_level_90s",collectibles:[".",".","."]},{text:"00s",stateKey:null,spriteKey:"button_level_00s",collectibles:[".",".","."]},{text:"10s",stateKey:"decade_2010s",spriteKey:"button_level_10s",collectibles:["corgi","crown","."]}],Game.init=function(){var e=new Phaser.Game(568,320,Phaser.AUTO,"main",null,!1,!1);this.game=e,e.analytics=Game.Analytics,e.storage=new Game.Storage("skynews-queen-feature-game"),e.state.add("startup",Game.State.Startup),e.state.add("preloader",Game.State.Preloader),e.state.add("intro_skynews",Game.State.Intro_Skynews),e.state.add("intro_alexs_house",Game.State.Intro_AlexsHouse),e.state.add("navigation",Game.State.Navigation),e.state.add("tutorial",Game.State.Tutorial),e.state.add("intro_50s",Game.State.Intro_50s),e.state.add("decade_50s",Game.State.Decade_50s),e.state.add("decade_60s",Game.State.Decade_60s),e.state.add("decade_2010s",Game.State.Decade_2010s),e.state.add("end_screen",Game.State.EndScreen),Game.Levels.forEach(function(e){e.collectibles.forEach(function(e){"."!==e&&this.Score.nbCollectibles++}.bind(this))}.bind(this)),Game.getCollectedItems(),e.state.start("startup")},Game.getCollectedItems=function(){this.Score.nbCollected=0,Game.Levels.forEach(function(e){var t=this.game.storage.get(e.stateKey);t&&t.scoredItems.forEach(function(e){"jewel"!==e.sprite_key&&this.Score.nbCollected++}.bind(this)),Game.Score.levelScores[e.stateKey]=t}.bind(this))},window.onload=function(){Game.init()},Phaser.Plugin.Fade=function(e,t){Phaser.Plugin.call(this,e,t)},Phaser.Plugin.Fade.prototype=Object.create(Phaser.Plugin.prototype),Phaser.Plugin.Fade.prototype.constructor=Phaser.Plugin.SamplePlugin,Phaser.Plugin.Fade.prototype.fadeOut=function(e,t,a,s){this.fade(e,t,a,0,1,s)},Phaser.Plugin.Fade.prototype.fadeIn=function(e,t,a,s){this.fade(e,t,a,1,0,s)},Phaser.Plugin.Fade.prototype.fade=function(e,t,a,s,i,o){a=a||0;var n,r=this.game.add.graphics(0,0);r.beginFill(e,1),r.drawRect(this.game.camera.x,this.game.camera.y,1.5*this.game.world.width,1.5*this.game.world.height),r.alpha=s,r.endFill(),n=this.game.add.tween(r),n.to({alpha:i},t,null),o&&n.onComplete.add(o,this),n.start()},Game.Analytics={stateStarted:function(e){this.sendEvent(["state started",e])},stateComplete:function(e){this.sendEvent(["state completed",e])},itemCollected:function(e){this.sendEvent(["item collected",e])},gameCompleted:function(){this.sendEvent(["game completed"])},sendEvent:function(e){setTimeout(function(){ga("send","event","The Reign Game",e[0],e[1])},1)}};var PLAYER_SPEED=200;Game.Controls=function(e,t){this.game=e,this.player=t,this.moving=!1,this.create()},Game.Controls.prototype.create=function(){this.cursors=this.game.input.keyboard.createCursorKeys()},Game.Controls.prototype.handleDown=function(e){this.moving?this.jump():(e.x<this.game.width/2?this.moveLeft():this.moveRight(),this.moving=!0)},Game.Controls.prototype.handleUp=function(){console.log(this.game.input.totalActivePointers),0===this.game.input.totalActivePointers?(this.player.animations.stop(),this.player.frame=2,this.player.body.velocity.x=0,this.moving=!1):this.handleDown(this.game.input.activePointer)},Game.Controls.prototype.moveLeft=function(){this.player.body.velocity.x=-PLAYER_SPEED,this.player.animations.play("left")},Game.Controls.prototype.moveRight=function(){this.player.body.velocity.x=PLAYER_SPEED,this.player.animations.play("right")},Game.Controls.prototype.jump=function(){this.player.body.onFloor()&&(this.player.body.velocity.y=-300)},Game.Controls.prototype.update=function(){var e=0;this.game.input.pointer1.isDown&&e++,this.game.input.pointer2.isDown&&e++,(this.cursors.up.isDown||e>1)&&this.jump(),1===e&&(this.activePointer=this.game.input.pointer1.isDown?this.game.input.pointer1:this.game.input.pointer2),this.cursors.left.isDown?this.moveLeft():this.cursors.right.isDown?this.moveRight():0===e&&(this.player.body.velocity.x=0,this.activePointer=null),this.activePointer&&(this.activePointer.x<this.game.width/2?this.moveLeft():this.activePointer.x>this.game.width/2&&this.moveRight()),0===this.player.body.velocity.x&&(this.player.animations.stop(),this.player.frame=2)},Game.LevelScore=function(e,t,a){this.game=e,this.sprites={},this.scoredItems=[],this.collectedItems=this.game.storage.get(t),this.collectibles=a,this.collectibleSize=16,this.addDisplay()},Game.LevelScore.prototype.addDisplay=function(){var e,t,a,s,i=this.game.width-33,o=!1;this.scoreGroup=this.game.add.group(),this.scoreGroup.fixedToCamera=!0,this.scoreText=new Phaser.BitmapText(this.game,i,7,"nokia","0",20),this.scoreGroup.add(this.scoreText),this.collectibles.forEach(function(n){if("jewel"===n.properties.sprite_key){if(!o){o=!0,i-=32;var r=this.game.add.sprite(i,0,"jewel");this.scoreGroup.add(r),i-=20}}else e=n.properties.sprite_key,this.collectedItems&&this.collectedItems.scoredItems.forEach(function(e){e.sprite_key===n.properties.sprite_key&&(t=!0)}),t||(e+="_grey"),a=this.game.add.sprite(i,7,e),s=Math.min(this.collectibleSize/a.width,this.collectibleSize/a.height),a.scale.setTo(s,s),this.scoreGroup.add(a),this.sprites[n.properties.sprite_key]=a,i-=a.width*s+16}.bind(this))},Game.LevelScore.prototype.scoreItem=function(e,t){this.game.analytics.itemCollected(e.sprite_key);var a=this.sprites[e.sprite_key];a&&a.loadTexture(e.sprite_key),this.scoredItems.push(e),Game.Score.levelScores[t]={scoredItems:this.scoredItems},"jewel"!==e.sprite_key&&Game.Score.nbCollected<Game.Score.nbCollectibles&&Game.Score.nbCollected++,this.game.storage.set(t,{scoredItems:this.scoredItems}),this.updatePoints(this.scoredItems)},Game.LevelScore.prototype.updatePoints=function(e){var t,a=0;e.forEach(function(e){t=e.score,typeof t!==Number&&(t=parseInt(t,10)),a+=t}),this.scoreText&&this.scoreText.setText(a)},Game.Map.Module=function(e,t){this.game=e,this.tilemap=e.add.tilemap(t);for(var a=0;a<this.tilemap.tilesets.length;a++)this.tilemap.addTilesetImage(this.tilemap.tilesets[a].name)},Game.Map.Module.prototype={createLayer:function(){return this.tilemap.createLayer.apply(this.tilemap,arguments)},createLayers:function(){var e,t,a={};for(t=0;t<arguments.length;t++)e=arguments[t],a[e]=this.tilemap.createLayer(e);return a},findTextObjects:function(){var e=this,t=[];return this.tilemap.objects.text&&this.tilemap.objects.text.forEach(function(a){a.y-=e.tilemap.tileHeight,a.properties.text=a.properties.text.replace(/\\n/g,"\n").replace(/\\r/g,"\r"),a.properties.size=a.properties.size||20,t.push(a)}),t},findCollectibleObjects:function(){var e=this,t=[];return this.tilemap.objects.collectibles&&this.tilemap.objects.collectibles.forEach(function(a){a.y-=e.tilemap.tileHeight,t.push(a)}),t},findObjectsByType:function(e){var t=this,a=[];return this.tilemap.objects.objects&&this.tilemap.objects.objects.forEach(function(s){s.type===e&&(s.y-=t.tilemap.tileHeight,a.push(s))}),a},getCollisionSprites:function(e,t,a,s){a=a||0,s=s||0;var i,o=this,n=[];return this.tilemap.objects[e].forEach(function(e){e.y-=o.tilemap.tileHeight,i=t.create(e.x+32*a,e.y+32*s),o.game.physics.arcade.enable(i),i.body.setSize(e.properties.width,e.properties.height),i.body.immovable=!0,n.push(i)}),n},spriteFromObject:function(e,t){var a=t.create(e.x,e.y,e.properties.sprite);return a.properties={},Object.keys(e.properties).forEach(function(t){a.properties[t]=e.properties[t]}),a}},Game.PauseMenu=function(e){this.game=e,this.buttonDefinitions=[{sprite:"time_machine_button",x:40,y:80,callback:"backToNavigation"},{sprite:"resume_button",x:40,y:120,callback:"resume"},{sprite:"restart_level_button",x:40,y:160,callback:"restartLevel"},{sprite:"share_on_facebook",x:40,y:200,callback:"shareOnFacebook"},{sprite:"share_on_twitter",x:40,y:240,callback:"shareOnTwitter"}],this.buttons=[],this.addPauseButton(),this.drawMenu(),this.game.input.onDown.add(this.handleInput,this)},Game.PauseMenu.prototype.addPauseButton=function(){this.pauseButton=this.game.add.button(10,10,"pause",this.showPauseMenu,this),this.pauseButton.fixedToCamera=!0},Game.PauseMenu.prototype.drawMenu=function(){var e,t,a;this.menuGroup=this.game.add.group(),this.menuGroup.visible=!1,a=this.game.add.graphics(0,0),a.fixedToCamera=!0,a.beginFill(0,.8),a.drawRect(this.game.camera.x,this.game.camera.y,this.game.width,this.game.height),a.endFill(),this.menuGroup.add(a),e=new Phaser.Text(this.game,240,40,"Paused",{font:"helvetica",fontSize:18,fill:"#ffffff"}),e.fixedToCamera=!0,this.menuGroup.add(e),this.buttonDefinitions.forEach(function(e){t=new Phaser.Image(this.game,e.x,e.y,e.sprite),t.fixedToCamera=!0,this.menuGroup.add(t),this.buttons.push({x1:t.x,y1:t.y,x2:t.x+t.width,y2:t.y+t.height,callback:e.callback})}.bind(this))},Game.PauseMenu.prototype.handleInput=function(e){this.game.paused&&this.buttons.forEach(function(t){e.x>t.x1&&e.x<t.x2&&e.y>t.y1&&e.y<t.y2&&t.callback&&this[t.callback]()}.bind(this))},Game.PauseMenu.prototype.backToNavigation=function(){this.game.paused=!1,this.game.state.start("navigation")},Game.PauseMenu.prototype.resume=function(){this.game.paused=!1,this.pauseButton.visible=!0,this.menuGroup.visible=!1},Game.PauseMenu.prototype.restartLevel=function(){this.game.paused=!1,this.game.state.start(this.game.state.current)},Game.PauseMenu.prototype.showPauseMenu=function(){this.game.paused=!0,this.pauseButton.visible=!1,this.menuGroup.visible=!0},Game.PauseMenu.prototype.shareOnFacebook=function(){console.log("shared on Facebook")},Game.PauseMenu.prototype.shareOnTwitter=function(){console.log("shared on Twitter")},Game.Storage=function(e){this.storageName=e||"skynews-game",this.read()},Game.Storage.prototype.save=function(){localStorage.setItem(this.storageName,JSON.stringify(this.state))},Game.Storage.prototype.read=function(){this.state=JSON.parse(localStorage.getItem(this.storageName)||"{}")||{}},Game.Storage.prototype.set=function(e,t){this.state[e]=t,this.save()},Game.Storage.prototype.get=function(e){return this.state[e]},Game.State.BaseState=function(){this.levelKey=null,this.controls=null,this.collectibleItems=[],this.collectedItems=[],this.parallaxTextGroup=null,this.fixedTextGroup=null},Game.State.BaseState.prototype={TEXT_PARALLAX_SCALE:1.1,create:function(){this.game.analytics.stateStarted(this.levelKey),this.game.physics.arcade.gravity.y=600,this._createState(),this.game.fadePlugin.fadeIn(0,750,0)},addPlayer:function(){var e=this.levelModule.findObjectsByType("player_spawn");this.player=this.game.add.sprite(e[0].x,e[0].y-32,"player"),this.game.physics.arcade.enable(this.player),this.player.body.collideWorldBounds=!0,this.game.camera.follow(this.player),this.player.animations.add("left",[0,1],5,!0),this.player.animations.add("right",[3,4],5,!0)},addCollectibles:function(){this.collectibleItems=[];var e=this.levelModule.findCollectibleObjects();e.forEach(function(e){var t=this.game.add.sprite(e.x,e.y,e.properties.sprite_key);"jewel"!==e.properties.sprite_key&&(t._isArtefact=!0,t._revealFactId=e.properties.revealFactId,this.addArtefactEmitter(t)),t.properties=e.properties,this.game.physics.arcade.enable(t),t.body.allowGravity=!1,t.anchor=new Phaser.Point(.5,.5),this.collectibleItems.push(t)}.bind(this))},addArtefactEmitter:function(e){var t=this.game.add.emitter(e.x,e.y,10);t.makeParticles(["sparkle1","sparkle2","sparkle3"]),t.minParticleSpeed.setTo(-50,-50),t.maxParticleSpeed.setTo(50,50),t.gravity=-600,t.alpha=.5,t.minParticleAlpha=.7,t.maxParticleAlpha=1,t.minParticleScale=.5,t.maxParticleScale=1.5,t.start(!1,1e3,100),e._emitter=t},addNextLevelPortal:function(){var e=this.levelModule.findObjectsByType("next_level");e.length&&(this.nextLevel=this.game.add.sprite(e[0].x,e[0].y,"transparent_32-160"),this.game.physics.arcade.enable(this.nextLevel),this.nextLevel.body.allowGravity=!1,this.nextLevel.y-=110)},_createState:function(){var e;this.levelModule=new Game.Map.Module(this.game,this.levelKey),this.modules={},this.createBackgroundLayers&&"function"==typeof this.createBackgroundLayers&&this.createBackgroundLayers(),this.platform=this.levelModule.createLayer("platform"),this.platform.alpha=0,this.platform.resizeWorld(),this.addNextLevelPortal(),e=this.levelModule.findTextObjects(),this.factReference={},this.addPlayer(),this.addCollectibles(),this.controls=new Game.Controls(this.game,this.player),this.createForegroundLayers&&"function"==typeof this.createForegroundLayers&&this.createForegroundLayers(),e.forEach(function(e){"factoid"===e.properties.type?this.factReference[e.properties.id]=new Game.Map.Object.Factoid(this.game,e):new Game.Map.Object.FloatingText(this.game,e)}.bind(this)),this.setCollisions&&"function"==typeof this.setCollisions&&this.setCollisions(),this.scoreDisplay=new Game.LevelScore(this.game,this.levelKey,this.collectibleItems),this.pauseMenu=new Game.PauseMenu(this.game)},_collectiblesCollisionHandler:function(e,t){var a=null;t._emitter&&(t._emitter.on=!1),a=t,a.x=a.x-this.game.camera.x,a.y=a.y-this.game.camera.y,t.fixedToCamera=!0,a.body.destroy(),this.game.add.tween(a).to({alpha:0},500,"Linear",!0),this.game.add.tween(a.scale).to({x:3,y:3},250,Phaser.Easing.Quadratic.In,!0).chain(this.game.add.tween(a.scale).to({x:1,y:1},250,Phaser.Easing.Quadratic.Out)),this.game.add.tween(a.cameraOffset).to({y:-32},500,Phaser.Easing.Quadratic.InOut,!0),this.game.add.tween(a.cameraOffset).to({x:500},500,Phaser.Easing.Quadratic.InOut,!0).onComplete.add(a.destroy,a),this.collectedItems.push(a),this.itemCollectedHandler&&"function"==typeof this.itemCollectedHandler&&this.itemCollectedHandler(a),this.scoreDisplay.scoreItem(a.properties,this.levelKey),a._revealFactId&&this.factReference[a._revealFactId].reveal()},_nextLevelHandler:function(){var e=this.nextLevelKey;this.game.fadePlugin.fadeOut(0,750,0,function(){this.game.analytics.stateComplete(this.levelKey),Game.Score.allCollected()&&(e="end_screen"),this.game.state.start(e)}.bind(this))},update:function(){this._updateState(),this.updateState&&"function"==typeof this.updateState&&this.updateState()},_updateState:function(){this.parallaxTextGroup&&(this.parallaxTextGroup.x=this.game.world.x*this.TEXT_PARALLAX_SCALE),this.game.physics.arcade.collide(this.player,this.platform),this.game.physics.arcade.overlap(this.player,this.collectibleItems,this._collectiblesCollisionHandler,null,this),this.game.physics.arcade.overlap(this.player,this.nextLevel,this._nextLevelHandler,null,this),this.controls.update()}},Game.State.Decade_2010s=function(){},Game.State.Decade_2010s.prototype=new Game.State.BaseState,Game.State.Decade_2010s.prototype.levelKey="decade_2010s",Game.State.Decade_2010s.prototype.nextLevelKey="navigation",Game.State.Decade_2010s.prototype.setCollisions=function(){this.levelModule.tilemap.setCollisionBetween(834,849),this.levelModule.tilemap.setCollisionBetween(861,882)},Game.State.Decade_50s=function(){},Game.State.Decade_50s.prototype=new Game.State.BaseState,Game.State.Decade_50s.prototype.levelKey="decade_50s",Game.State.Decade_50s.prototype.nextLevelKey="decade_60s",Game.State.Decade_50s.prototype.setCollisions=function(){this.levelModule.tilemap.setCollision(76)},Game.State.Decade_50s.prototype.createBackgroundLayers=function(){this.levelModule.createLayer("background")},Game.State.Decade_50s.prototype.createForegroundLayers=function(){this.levelModule.createLayer("foreground")},Game.State.Decade_60s=function(){},Game.State.Decade_60s.prototype=new Game.State.BaseState,Game.State.Decade_60s.prototype.levelKey="decade_60s",Game.State.Decade_60s.prototype.nextLevelKey="decade_2010s",Game.State.Decade_60s.prototype.setCollisions=function(){this.levelModule.tilemap.setCollision(3)},Game.State.Decade_60s.prototype.createBackgroundLayers=function(){this.levelModule.createLayer("bg_colour"),this.levelModule.createLayer("background")},Game.State.Decade_60s.prototype.createForegroundLayers=function(){this.levelModule.createLayer("foreground")},Game.State.Decade_60s.prototype.updateState=function(){this.parallaxTextGroup.x=this.game.world.x*this.TEXT_PARALLAX_SCALE,this.parallaxTextGroup.y=this.game.world.y*this.TEXT_PARALLAX_SCALE},Game.State.EndScreen=function(){},Game.State.EndScreen.prototype={cursors:null,transitionning:!1,fixedTextOverlays:[{text:"Well done",size:100,x:20,y:20,alpha:.2},{text:"All royal artefacts have been returned!",size:20,x:20,y:120}],create:function(){this.game.analytics.gameCompleted(),this.transitionning=!1,this.createState(),this.game.fadePlugin.fadeIn(0,750,0)},createState:function(){var e=this.game.add.graphics(0,0);e.beginFill(0,1),e.drawRect(this.game.camera.x,this.game.camera.y,1.5*this.game.width,1.5*this.game.height),e.endFill(),this.textGroup=this.game.add.group(),this.textGroup.fixedToCamera=!1,this.textGroup.alpha=1,this.fixedTextOverlays.forEach(function(e){var t=new Phaser.BitmapText(this.game,e.x,e.y,"nokia",e.text,e.size);t.alpha=e.alpha||1,this.textGroup.add(t)}.bind(this)),this.game.add.button(this.game.width-120,this.game.height-50,"next_button",this.nextLevel,this),this.cursors=this.game.input.keyboard.createCursorKeys()},nextLevel:function(){this.transitionning||(this.transitionning=!0,this.game.fadePlugin.fadeOut(0,750,0,function(){this.game.state.start("navigation")}))}},Game.State.Intro_50s=function(){},Game.State.Intro_50s.prototype={cursors:null,transitionning:!1,fixedTextOverlays:[{text:"1950s",size:200,x:20,y:20,alpha:.2},{text:"Post-war Britain started the 1950s hard-up and hurting.\n\nFood rations were in place until 1954, there were unexploded bombs in the\rstreets, and Britain's international standing was shaken by the Suez crisis.\n\nBut by the end of the decade the UK had a new Queen, television sets,\rand rock n'roll.\n\nPrime Minister Harold MacMillan proclaimed 'most of\rour people have never had it so good'.",size:16,x:20,y:20}],create:function(){this.transitionning=!1,this.createState(),this.game.fadePlugin.fadeIn(0,750,0)},createState:function(){var e=this.game.add.graphics(0,0);e.beginFill(0,1),e.drawRect(this.game.camera.x,this.game.camera.y,1.5*this.game.width,1.5*this.game.height),e.endFill(),this.endTextGroup=this.game.add.group(),this.endTextGroup.fixedToCamera=!1,this.endTextGroup.alpha=1,this.fixedTextOverlays.forEach(function(e){var t=new Phaser.Text(this.game,e.x,e.y,e.text,{font:"helvetica",fontSize:e.size,fill:"#ffffff"});t.alpha=e.alpha||1,this.endTextGroup.add(t)}.bind(this)),this.game.add.button(this.game.width-120,this.game.height-50,"next_button",this.nextLevel,this),this.cursors=this.game.input.keyboard.createCursorKeys()},nextLevel:function(){this.transitionning||(this.transitionning=!0,this.game.fadePlugin.fadeOut(0,750,0,function(){this.game.state.start("decade_50s")}))}},Game.State.Intro_AlexsHouse=function(){},Game.State.Intro_AlexsHouse.prototype={cursors:null,transitionning:!1,create:function(){this.transitionning=!1,this.game.add.image(0,0,"alexs_house"),this.game.add.button(this.game.width-120,this.game.height-50,"next_button",this.nextLevel,this),this.game.fadePlugin.fadeIn(0,750,0)},nextLevel:function(){this.transitionning||(this.transitionning=!0,this.game.fadePlugin.fadeOut(0,750,0,function(){this.game.state.start("navigation")}))}},Game.State.Intro_Skynews=function(){},Game.State.Intro_Skynews.prototype={cursors:null,transitionning:!1,create:function(){var e,t,a,s,i;this.game.analytics.stateStarted("intro"),this.transitionning=!1,this.game.stage.backgroundColor="#fff",this.game.add.image(0,0,"kay"),e=this.game.add.image(10,10,"skynews_logo"),t=this.game.add.image(0,300,"intro_ticker"),a=this.game.add.image(568,300,"intro_ticker"),s=this.game.add.group(),s.add(t),s.add(a),i=this.game.add.tween(s).to({x:-568},1e4,"Linear",!0),i.repeat(),this.clock=this.game.add.text(0,300," 00:00 ",{font:"16px Arial",fill:"#fff",backgroundColor:"black",boundsAlignV:"middle"}),this.speechText1=this.game.add.text(10,50,"A dastardly villain has travelled through time and stolen artifacts from the Queen's reign",{font:"16px Arial",fill:"#000",backgroundColor:"white",wordWrap:!0,wordWrapWidth:200}),this.speechText2=this.game.add.text(10,50,"Police are baffled. Won't somebody come forward and help? For our country!",{font:"16px Arial",fill:"#000",backgroundColor:"white",wordWrap:!0,wordWrapWidth:200}),this.speechText2.visible=!1,this.updateClock(),this.game.time.events.loop(Phaser.Timer.SECOND,this.updateClock,this),this.game.add.button(this.game.width-120,this.game.height-50,"next_button",this.nextFrame,this),this.game.fadePlugin.fadeIn(0,750,0)},nextFrame:function(){this.speechText1.visible?(this.speechText2.visible=!0,this.speechText1.visible=!1):this.nextLevel()},updateClock:function(){var e=new Date;this.clock.setText(" "+("0"+e.getHours()).slice(-2)+":"+("0"+e.getMinutes()).slice(-2)+" ")},nextLevel:function(){this.transitionning||(this.transitionning=!0,this.game.fadePlugin.fadeOut(0,750,0,function(){this.game.state.start("intro_alexs_house")}))}},Game.State.Navigation=function(){},Game.State.Navigation.prototype={cursors:null,transitionning:!1,buttonsOriginX:24,buttonsOriginY:24,buttonsMargin:30,buttonsPerRow:3,buttonHeight:48,buttonWidth:48,collectibleSize:10,create:function(){this.game.analytics.stateStarted("navigation"),this.transitionning=!1,this.createState(),this.game.fadePlugin.fadeIn(0,750,0)},createState:function(){var e=this.game.add.graphics(0,0),t=0,a=0;e.beginFill(0,1),e.drawRect(this.game.camera.x,this.game.camera.y,1.5*this.game.width,1.5*this.game.height),e.endFill(),this.buttonsGroup=this.game.add.group(),Game.Levels.forEach(function(e){var s,i,o,n=Game.Score.levelScores[e.stateKey],r=0;i=this.buttonsOriginX+a*(this.buttonWidth+this.buttonsMargin),o=this.buttonsOriginY+t*(this.buttonHeight+this.buttonsMargin),s=this.game.add.button(i,o,e.spriteKey,this.nextLevel,this),s.properties=e,e.collectibles.forEach(function(e){var t,a,s=i+18*r,l=o+this.buttonHeight+10,h=!1,c=6710886;n&&n.scoredItems.forEach(function(t){t.sprite_key===e&&(h=!0)}.bind(this)),"."===e?(h&&(c=16777215),t=this.game.add.graphics(0,0),t.properties={},t.properties.collectibleName=e,t.beginFill(c,1),t.drawRect(s,l,this.collectibleSize,this.collectibleSize),t.endFill()):(h||(e+="_grey"),t=this.game.add.sprite(s,l,e),a=Math.min(this.collectibleSize/t.width,this.collectibleSize/t.height),t.scale.setTo(a,a)),r++}.bind(this)),a+1>=this.buttonsPerRow?(a=0,t++):a++}.bind(this)),this.cursors=this.game.input.keyboard.createCursorKeys()},nextLevel:function(e){this.transitionning||(this.transitionning=!0,this.game.fadePlugin.fadeOut(0,750,0,function(){this.game.state.start(e.properties.stateKey||"tutorial")}))}},Game.State.Preloader=function(){},Game.State.Preloader.prototype={preload:function(){this.stage.backgroundColor="#000000",this.add.sprite(195,138,"crown"),this.textGroup=this.game.add.group(),this.textGroup.fixedToCamera=!0,this.textGroup.add(new Phaser.BitmapText(this.game,this.game.width/2-50,this.game.height/2-15,"pixeltype","Loading...",40)),this.game.load.image("intro_ticker","assets/sprites/intro-ticker.png"),this.game.load.image("skynews_logo","assets/sprites/8bit_sky_logo.png"),this.game.load.image("kay","assets/sprites/kayburley.png"),this.game.load.image("alexs_house","assets/sprites/alexshouse.png"),this.load.spritesheet("player","assets/sprites/alex_character.png",59,69,6),this.load.spritesheet("next_button","assets/sprites/next_button.png",100,30),this.game.load.image("sparkle1","assets/sprites/sparkle1.png"),this.game.load.image("sparkle2","assets/sprites/sparkle2.png"),this.game.load.image("sparkle3","assets/sprites/sparkle3.png"),this.game.load.image("transparent_32-160","assets/sprites/transparent_32-160.png"),this.game.load.image("jewel","assets/sprites/jewel.png"),this.game.load.image("jewel_grey","assets/sprites/jewel_grey.png"),this.game.load.image("corgi","assets/sprites/corgi.png"),this.game.load.image("corgi_grey","assets/sprites/corgi_grey.png"),this.game.load.image("crown_grey","assets/sprites/crown_grey.png"),this.game.load.image("tv","assets/sprites/50s_tv.png"),this.game.load.image("tv_grey","assets/sprites/50s_tv_grey.png"),this.game.load.image("record","assets/sprites/50s_record.png"),this.game.load.image("record_grey","assets/sprites/50s_record_grey.png"),this.game.load.image("mini","assets/sprites/50s_mini.png"),this.game.load.image("mini_grey","assets/sprites/50s_mini_grey.png"),this.game.load.image("beatles","assets/sprites/60s_beatles.png"),this.game.load.image("beatles_grey","assets/sprites/60s_beatles_grey.png"),this.game.load.image("worldcup","assets/sprites/60s_worldcup.png"),this.game.load.image("worldcup_grey","assets/sprites/60s_worldcup_grey.png"),this.game.load.image("the_sun","assets/sprites/60s_the_sun.png"),this.game.load.image("the_sun_grey","assets/sprites/60s_the_sun_grey.png"),this.game.load.image("button_level_50s","assets/sprites/level_buttons/level_50s.png"),this.game.load.image("button_level_60s","assets/sprites/level_buttons/level_60s.png"),this.game.load.image("button_level_70s","assets/sprites/level_buttons/level_70s.png"),this.game.load.image("button_level_80s","assets/sprites/level_buttons/level_80s.png"),this.game.load.image("button_level_90s","assets/sprites/level_buttons/level_90s.png"),this.game.load.image("button_level_00s","assets/sprites/level_buttons/level_00s.png"),this.game.load.image("button_level_10s","assets/sprites/level_buttons/level_10s.png"),this.load.image("compass","assets/sprites/compass_rose.png"),this.load.image("touch_segment","assets/sprites/touch_segment.png"),this.load.image("touch","assets/sprites/touch.png"),this.load.image("pause","assets/sprites/pause.png"),this.load.image("time_machine_button","assets/sprites/time-machine-button.png"),this.load.image("resume_button","assets/sprites/resume-button.png"),this.load.image("restart_level_button","assets/sprites/restart-level-button.png"),this.load.image("share_on_facebook","assets/sprites/share-on-facebook-button.png"),this.load.image("share_on_twitter","assets/sprites/share-on-twitter-button.png"),this.loadTileMaps()},loadTileMaps:function(){var e,t,a={};for(t=0;t<Game.Map.MAPS.length;t++)this.addTileSets(Game.Map.MAPS[t],a);for(e in a)a.hasOwnProperty(e)&&this.load.image(e,a[e])},addTileSets:function(e,t){var a,s,i,o=this.cache.getTilemapData(e).data.tilesets;for(i=0;i<o.length;i++)s=o[i].name,a="assets/maps/"+o[i].image,s in t||(t[s]=a)},create:function(){setTimeout(function(){this.game.fadePlugin.fadeOut(0,750,0,function(){this.game.state.start("intro_skynews")}.bind(this))}.bind(this),500)}},Game.State.Startup=function(){},Game.State.Startup.prototype={preload:function(){this.load.image("crown","assets/sprites/crown.png"),this.load.bitmapFont("nokia","assets/fonts/bitmapFonts/nokia.png","assets/fonts/bitmapFonts/nokia.xml"),this.load.bitmapFont("pixeltype","assets/fonts/bitmapFonts/pixeltype.png","assets/fonts/bitmapFonts/pixeltype.xml");var e,t;for(t=0;t<Game.Map.MAPS.length;t++)e=Game.Map.MAPS[t],this.load.tilemap(e,"assets/maps/"+e+".json",null,Phaser.Tilemap.TILED_JSON)},create:function(){this.game.scale.scaleMode=Phaser.ScaleManager.SHOW_ALL,this.game.fadePlugin=this.game.plugins.add(new Phaser.Plugin.Fade(this)),this.game.physics.startSystem(Phaser.Physics.ARCADE),this.game.state.start("preloader")}},Game.State.Tutorial=function(){},Game.State.Tutorial.prototype=new Game.State.BaseState,Game.State.Tutorial.prototype.levelKey="tutorial",Game.State.Tutorial.prototype.nextLevelKey="decade_50s",Game.State.Tutorial.prototype.setCollisions=function(){this.levelModule.tilemap.setCollisionBetween(76,84)},Game.State.Tutorial.prototype.createForegroundLayers=function(){this.banisterLayer=this.levelModule.createLayer("banisters"),this.columnLayer=this.levelModule.createLayer("columns")};var Game={};Game={},Game.State={},Game.Map={},Game.Map.Object={},Game.Score={nbCollectibles:0,nbCollected:0,levelScores:{},allCollected:function(){return this.nbCollectibles===this.nbCollected}},Game.Map.MAPS=["tutorial","decade_50s","decade_60s","decade_2010s"],Game.Levels=[{text:"50s",stateKey:"decade_50s",spriteKey:"button_level_50s",collectibles:["record","tv","mini"]},{text:"60s",stateKey:"decade_60s",spriteKey:"button_level_60s",collectibles:["beatles","the_sun","worldcup"]},{text:"70s",stateKey:null,spriteKey:"button_level_70s",collectibles:[".",".","."]},{text:"80s",stateKey:"tutorial",spriteKey:"button_level_80s",collectibles:["corgi",".","."]},{text:"90s",stateKey:null,spriteKey:"button_level_90s",collectibles:[".",".","."]},{text:"00s",stateKey:null,spriteKey:"button_level_00s",collectibles:[".",".","."]},{text:"10s",stateKey:"decade_2010s",spriteKey:"button_level_10s",collectibles:["corgi","crown","."]}],Game.init=function(){var e=new Phaser.Game(568,320,Phaser.AUTO,"main",null,!1,!1);this.game=e,e.analytics=Game.Analytics,e.storage=new Game.Storage("skynews-queen-feature-game"),e.state.add("startup",Game.State.Startup),e.state.add("preloader",Game.State.Preloader),e.state.add("intro_skynews",Game.State.Intro_Skynews),e.state.add("intro_alexs_house",Game.State.Intro_AlexsHouse),e.state.add("navigation",Game.State.Navigation),e.state.add("tutorial",Game.State.Tutorial),e.state.add("intro_50s",Game.State.Intro_50s),e.state.add("decade_50s",Game.State.Decade_50s),e.state.add("decade_60s",Game.State.Decade_60s),e.state.add("decade_2010s",Game.State.Decade_2010s),e.state.add("end_screen",Game.State.EndScreen),Game.Levels.forEach(function(e){e.collectibles.forEach(function(e){"."!==e&&this.Score.nbCollectibles++}.bind(this))}.bind(this)),Game.getCollectedItems(),e.state.start("startup")},Game.getCollectedItems=function(){this.Score.nbCollected=0,Game.Levels.forEach(function(e){var t=this.game.storage.get(e.stateKey);t&&t.scoredItems.forEach(function(e){"jewel"!==e.sprite_key&&this.Score.nbCollected++}.bind(this)),Game.Score.levelScores[e.stateKey]=t}.bind(this))},window.onload=function(){Game.init()},Phaser.Plugin.Fade=function(e,t){Phaser.Plugin.call(this,e,t)},Phaser.Plugin.Fade.prototype=Object.create(Phaser.Plugin.prototype),Phaser.Plugin.Fade.prototype.constructor=Phaser.Plugin.SamplePlugin,Phaser.Plugin.Fade.prototype.fadeOut=function(e,t,a,s){this.fade(e,t,a,0,1,s)},Phaser.Plugin.Fade.prototype.fadeIn=function(e,t,a,s){this.fade(e,t,a,1,0,s)},Phaser.Plugin.Fade.prototype.fade=function(e,t,a,s,i,o){a=a||0;var n,r=this.game.add.graphics(0,0);r.beginFill(e,1),r.drawRect(this.game.camera.x,this.game.camera.y,1.5*this.game.world.width,1.5*this.game.world.height),r.alpha=s,r.endFill(),n=this.game.add.tween(r),n.to({alpha:i},t,null),o&&n.onComplete.add(o,this),n.start()},Game.Analytics={stateStarted:function(e){this.sendEvent(["state started",e])},stateComplete:function(e){this.sendEvent(["state completed",e])},itemCollected:function(e){this.sendEvent(["item collected",e])},gameCompleted:function(){this.sendEvent(["game completed"])},sendEvent:function(e){setTimeout(function(){ga("send","event","The Reign Game",e[0],e[1])},1)}};var PLAYER_SPEED=200;Game.Controls=function(e,t){this.game=e,this.player=t,this.moving=!1,this.create()},Game.Controls.prototype.create=function(){this.cursors=this.game.input.keyboard.createCursorKeys()},Game.Controls.prototype.handleDown=function(e){this.moving?this.jump():(e.x<this.game.width/2?this.moveLeft():this.moveRight(),this.moving=!0)},Game.Controls.prototype.handleUp=function(){console.log(this.game.input.totalActivePointers),0===this.game.input.totalActivePointers?(this.player.animations.stop(),this.player.frame=2,this.player.body.velocity.x=0,this.moving=!1):this.handleDown(this.game.input.activePointer);

},Game.Controls.prototype.moveLeft=function(){this.player.body.velocity.x=-PLAYER_SPEED,this.player.animations.play("left")},Game.Controls.prototype.moveRight=function(){this.player.body.velocity.x=PLAYER_SPEED,this.player.animations.play("right")},Game.Controls.prototype.jump=function(){this.player.body.onFloor()&&(this.player.body.velocity.y=-300)},Game.Controls.prototype.update=function(){var e=0;this.game.input.pointer1.isDown&&e++,this.game.input.pointer2.isDown&&e++,(this.cursors.up.isDown||e>1)&&this.jump(),1===e&&(this.activePointer=this.game.input.pointer1.isDown?this.game.input.pointer1:this.game.input.pointer2),this.cursors.left.isDown?this.moveLeft():this.cursors.right.isDown?this.moveRight():0===e&&(this.player.body.velocity.x=0,this.activePointer=null),this.activePointer&&(this.activePointer.x<this.game.width/2?this.moveLeft():this.activePointer.x>this.game.width/2&&this.moveRight()),0===this.player.body.velocity.x&&(this.player.animations.stop(),this.player.frame=2)},Game.LevelScore=function(e,t,a){this.game=e,this.sprites={},this.scoredItems=[],this.collectedItems=this.game.storage.get(t),this.collectibles=a,this.collectibleSize=16,this.addDisplay()},Game.LevelScore.prototype.addDisplay=function(){var e,t,a,s,i=this.game.width-33,o=!1;this.scoreGroup=this.game.add.group(),this.scoreGroup.fixedToCamera=!0,this.scoreText=new Phaser.BitmapText(this.game,i,7,"nokia","0",20),this.scoreGroup.add(this.scoreText),this.collectibles.forEach(function(n){if("jewel"===n.properties.sprite_key){if(!o){o=!0,i-=32;var r=this.game.add.sprite(i,0,"jewel");this.scoreGroup.add(r),i-=20}}else e=n.properties.sprite_key,this.collectedItems&&this.collectedItems.scoredItems.forEach(function(e){e.sprite_key===n.properties.sprite_key&&(t=!0)}),t||(e+="_grey"),a=this.game.add.sprite(i,7,e),s=Math.min(this.collectibleSize/a.width,this.collectibleSize/a.height),a.scale.setTo(s,s),this.scoreGroup.add(a),this.sprites[n.properties.sprite_key]=a,i-=a.width*s+16}.bind(this))},Game.LevelScore.prototype.scoreItem=function(e,t){this.game.analytics.itemCollected(e.sprite_key);var a=this.sprites[e.sprite_key];a&&a.loadTexture(e.sprite_key),this.scoredItems.push(e),Game.Score.levelScores[t]={scoredItems:this.scoredItems},"jewel"!==e.sprite_key&&Game.Score.nbCollected<Game.Score.nbCollectibles&&Game.Score.nbCollected++,this.game.storage.set(t,{scoredItems:this.scoredItems}),this.updatePoints(this.scoredItems)},Game.LevelScore.prototype.updatePoints=function(e){var t,a=0;e.forEach(function(e){t=e.score,typeof t!==Number&&(t=parseInt(t,10)),a+=t}),this.scoreText&&this.scoreText.setText(a)},Game.Map.Module=function(e,t){this.game=e,this.tilemap=e.add.tilemap(t);for(var a=0;a<this.tilemap.tilesets.length;a++)this.tilemap.addTilesetImage(this.tilemap.tilesets[a].name)},Game.Map.Module.prototype={createLayer:function(){return this.tilemap.createLayer.apply(this.tilemap,arguments)},createLayers:function(){var e,t,a={};for(t=0;t<arguments.length;t++)e=arguments[t],a[e]=this.tilemap.createLayer(e);return a},findTextObjects:function(){var e=this,t=[];return this.tilemap.objects.text&&this.tilemap.objects.text.forEach(function(a){a.y-=e.tilemap.tileHeight,a.properties.text=a.properties.text.replace(/\\n/g,"\n").replace(/\\r/g,"\r"),a.properties.size=a.properties.size||20,t.push(a)}),t},findCollectibleObjects:function(){var e=this,t=[];return this.tilemap.objects.collectibles&&this.tilemap.objects.collectibles.forEach(function(a){a.y-=e.tilemap.tileHeight,t.push(a)}),t},findObjectsByType:function(e){var t=this,a=[];return this.tilemap.objects.objects&&this.tilemap.objects.objects.forEach(function(s){s.type===e&&(s.y-=t.tilemap.tileHeight,a.push(s))}),a},getCollisionSprites:function(e,t,a,s){a=a||0,s=s||0;var i,o=this,n=[];return this.tilemap.objects[e].forEach(function(e){e.y-=o.tilemap.tileHeight,i=t.create(e.x+32*a,e.y+32*s),o.game.physics.arcade.enable(i),i.body.setSize(e.properties.width,e.properties.height),i.body.immovable=!0,n.push(i)}),n},spriteFromObject:function(e,t){var a=t.create(e.x,e.y,e.properties.sprite);return a.properties={},Object.keys(e.properties).forEach(function(t){a.properties[t]=e.properties[t]}),a}},Game.PauseMenu=function(e){this.game=e,this.buttonDefinitions=[{sprite:"time_machine_button",x:40,y:80,callback:"backToNavigation"},{sprite:"resume_button",x:40,y:120,callback:"resume"},{sprite:"restart_level_button",x:40,y:160,callback:"restartLevel"},{sprite:"share_on_facebook",x:40,y:200,callback:"shareOnFacebook"},{sprite:"share_on_twitter",x:40,y:240,callback:"shareOnTwitter"}],this.buttons=[],this.addPauseButton(),this.drawMenu(),this.game.input.onDown.add(this.handleInput,this)},Game.PauseMenu.prototype.addPauseButton=function(){this.pauseButton=this.game.add.button(10,10,"pause",this.showPauseMenu,this),this.pauseButton.fixedToCamera=!0},Game.PauseMenu.prototype.drawMenu=function(){var e,t,a;this.menuGroup=this.game.add.group(),this.menuGroup.visible=!1,a=this.game.add.graphics(0,0),a.fixedToCamera=!0,a.beginFill(0,.8),a.drawRect(this.game.camera.x,this.game.camera.y,this.game.width,this.game.height),a.endFill(),this.menuGroup.add(a),e=new Phaser.Text(this.game,240,40,"Paused",{font:"helvetica",fontSize:18,fill:"#ffffff"}),e.fixedToCamera=!0,this.menuGroup.add(e),this.buttonDefinitions.forEach(function(e){t=new Phaser.Image(this.game,e.x,e.y,e.sprite),t.fixedToCamera=!0,this.menuGroup.add(t),this.buttons.push({x1:t.x,y1:t.y,x2:t.x+t.width,y2:t.y+t.height,callback:e.callback})}.bind(this))},Game.PauseMenu.prototype.handleInput=function(e){this.game.paused&&this.buttons.forEach(function(t){e.x>t.x1&&e.x<t.x2&&e.y>t.y1&&e.y<t.y2&&t.callback&&this[t.callback]()}.bind(this))},Game.PauseMenu.prototype.backToNavigation=function(){this.game.paused=!1,this.game.state.start("navigation")},Game.PauseMenu.prototype.resume=function(){this.game.paused=!1,this.pauseButton.visible=!0,this.menuGroup.visible=!1},Game.PauseMenu.prototype.restartLevel=function(){this.game.paused=!1,this.game.state.start(this.game.state.current)},Game.PauseMenu.prototype.showPauseMenu=function(){this.game.paused=!0,this.pauseButton.visible=!1,this.menuGroup.visible=!0},Game.PauseMenu.prototype.shareOnFacebook=function(){console.log("shared on Facebook")},Game.PauseMenu.prototype.shareOnTwitter=function(){console.log("shared on Twitter")},Game.Storage=function(e){this.storageName=e||"skynews-game",this.read()},Game.Storage.prototype.save=function(){localStorage.setItem(this.storageName,JSON.stringify(this.state))},Game.Storage.prototype.read=function(){this.state=JSON.parse(localStorage.getItem(this.storageName)||"{}")||{}},Game.Storage.prototype.set=function(e,t){this.state[e]=t,this.save()},Game.Storage.prototype.get=function(e){return this.state[e]},Game.State.BaseState=function(){this.levelKey=null,this.controls=null,this.collectibleItems=[],this.collectedItems=[],this.parallaxTextGroup=null,this.fixedTextGroup=null},Game.State.BaseState.prototype={TEXT_PARALLAX_SCALE:1.1,create:function(){this.game.analytics.stateStarted(this.levelKey),this.game.physics.arcade.gravity.y=600,this._createState(),this.game.fadePlugin.fadeIn(0,750,0)},addPlayer:function(){var e=this.levelModule.findObjectsByType("player_spawn");this.player=this.game.add.sprite(e[0].x,e[0].y-32,"player"),this.game.physics.arcade.enable(this.player),this.player.body.collideWorldBounds=!0,this.game.camera.follow(this.player),this.player.animations.add("left",[0,1],5,!0),this.player.animations.add("right",[3,4],5,!0)},addCollectibles:function(){this.collectibleItems=[];var e=this.levelModule.findCollectibleObjects();e.forEach(function(e){var t=this.game.add.sprite(e.x,e.y,e.properties.sprite_key);"jewel"!==e.properties.sprite_key&&(t._isArtefact=!0,t._revealFactId=e.properties.revealFactId,this.addArtefactEmitter(t)),t.properties=e.properties,this.game.physics.arcade.enable(t),t.body.allowGravity=!1,t.anchor=new Phaser.Point(.5,.5),this.collectibleItems.push(t)}.bind(this))},addArtefactEmitter:function(e){var t=this.game.add.emitter(e.x,e.y,10);t.makeParticles(["sparkle1","sparkle2","sparkle3"]),t.minParticleSpeed.setTo(-50,-50),t.maxParticleSpeed.setTo(50,50),t.gravity=-600,t.alpha=.5,t.minParticleAlpha=.7,t.maxParticleAlpha=1,t.minParticleScale=.5,t.maxParticleScale=1.5,t.start(!1,1e3,100),e._emitter=t},addNextLevelPortal:function(){var e=this.levelModule.findObjectsByType("next_level");e.length&&(this.nextLevel=this.game.add.sprite(e[0].x,e[0].y,"transparent_32-160"),this.game.physics.arcade.enable(this.nextLevel),this.nextLevel.body.allowGravity=!1,this.nextLevel.y-=110)},_createState:function(){var e;this.levelModule=new Game.Map.Module(this.game,this.levelKey),this.modules={},this.createBackgroundLayers&&"function"==typeof this.createBackgroundLayers&&this.createBackgroundLayers(),this.platform=this.levelModule.createLayer("platform"),this.platform.alpha=0,this.platform.resizeWorld(),this.addNextLevelPortal(),e=this.levelModule.findTextObjects(),this.factReference={},this.addPlayer(),this.addCollectibles(),this.controls=new Game.Controls(this.game,this.player),this.createForegroundLayers&&"function"==typeof this.createForegroundLayers&&this.createForegroundLayers(),e.forEach(function(e){"factoid"===e.properties.type?this.factReference[e.properties.id]=new Game.Map.Object.Factoid(this.game,e):new Game.Map.Object.FloatingText(this.game,e)}.bind(this)),this.setCollisions&&"function"==typeof this.setCollisions&&this.setCollisions(),this.scoreDisplay=new Game.LevelScore(this.game,this.levelKey,this.collectibleItems),this.pauseMenu=new Game.PauseMenu(this.game)},_collectiblesCollisionHandler:function(e,t){var a=null;t._emitter&&(t._emitter.on=!1),a=t,a.x=a.x-this.game.camera.x,a.y=a.y-this.game.camera.y,t.fixedToCamera=!0,a.body.destroy(),this.game.add.tween(a).to({alpha:0},500,"Linear",!0),this.game.add.tween(a.scale).to({x:3,y:3},250,Phaser.Easing.Quadratic.In,!0).chain(this.game.add.tween(a.scale).to({x:1,y:1},250,Phaser.Easing.Quadratic.Out)),this.game.add.tween(a.cameraOffset).to({y:-32},500,Phaser.Easing.Quadratic.InOut,!0),this.game.add.tween(a.cameraOffset).to({x:500},500,Phaser.Easing.Quadratic.InOut,!0).onComplete.add(a.destroy,a),this.collectedItems.push(a),this.itemCollectedHandler&&"function"==typeof this.itemCollectedHandler&&this.itemCollectedHandler(a),this.scoreDisplay.scoreItem(a.properties,this.levelKey),a._revealFactId&&this.factReference[a._revealFactId].reveal()},_nextLevelHandler:function(){var e=this.nextLevelKey;this.game.fadePlugin.fadeOut(0,750,0,function(){this.game.analytics.stateComplete(this.levelKey),Game.Score.allCollected()&&(e="end_screen"),this.game.state.start(e)}.bind(this))},update:function(){this._updateState(),this.updateState&&"function"==typeof this.updateState&&this.updateState()},_updateState:function(){this.parallaxTextGroup&&(this.parallaxTextGroup.x=this.game.world.x*this.TEXT_PARALLAX_SCALE),this.game.physics.arcade.collide(this.player,this.platform),this.game.physics.arcade.overlap(this.player,this.collectibleItems,this._collectiblesCollisionHandler,null,this),this.game.physics.arcade.overlap(this.player,this.nextLevel,this._nextLevelHandler,null,this),this.controls.update()}},Game.State.Decade_2010s=function(){},Game.State.Decade_2010s.prototype=new Game.State.BaseState,Game.State.Decade_2010s.prototype.levelKey="decade_2010s",Game.State.Decade_2010s.prototype.nextLevelKey="navigation",Game.State.Decade_2010s.prototype.setCollisions=function(){this.levelModule.tilemap.setCollisionBetween(834,849),this.levelModule.tilemap.setCollisionBetween(861,882)},Game.State.Decade_50s=function(){},Game.State.Decade_50s.prototype=new Game.State.BaseState,Game.State.Decade_50s.prototype.levelKey="decade_50s",Game.State.Decade_50s.prototype.nextLevelKey="decade_60s",Game.State.Decade_50s.prototype.setCollisions=function(){this.levelModule.tilemap.setCollision(76)},Game.State.Decade_50s.prototype.createBackgroundLayers=function(){this.levelModule.createLayer("background")},Game.State.Decade_50s.prototype.createForegroundLayers=function(){this.levelModule.createLayer("foreground")},Game.State.Decade_60s=function(){},Game.State.Decade_60s.prototype=new Game.State.BaseState,Game.State.Decade_60s.prototype.levelKey="decade_60s",Game.State.Decade_60s.prototype.nextLevelKey="decade_2010s",Game.State.Decade_60s.prototype.setCollisions=function(){this.levelModule.tilemap.setCollision(3)},Game.State.Decade_60s.prototype.createBackgroundLayers=function(){this.levelModule.createLayer("bg_colour"),this.levelModule.createLayer("background")},Game.State.Decade_60s.prototype.createForegroundLayers=function(){this.levelModule.createLayer("foreground")},Game.State.Decade_60s.prototype.updateState=function(){this.parallaxTextGroup.x=this.game.world.x*this.TEXT_PARALLAX_SCALE,this.parallaxTextGroup.y=this.game.world.y*this.TEXT_PARALLAX_SCALE},Game.State.EndScreen=function(){},Game.State.EndScreen.prototype={cursors:null,transitionning:!1,fixedTextOverlays:[{text:"Well done",size:100,x:20,y:20,alpha:.2},{text:"All royal artefacts have been returned!",size:20,x:20,y:120}],create:function(){this.game.analytics.gameCompleted(),this.transitionning=!1,this.createState(),this.game.fadePlugin.fadeIn(0,750,0)},createState:function(){var e=this.game.add.graphics(0,0);e.beginFill(0,1),e.drawRect(this.game.camera.x,this.game.camera.y,1.5*this.game.width,1.5*this.game.height),e.endFill(),this.textGroup=this.game.add.group(),this.textGroup.fixedToCamera=!1,this.textGroup.alpha=1,this.fixedTextOverlays.forEach(function(e){var t=new Phaser.BitmapText(this.game,e.x,e.y,"nokia",e.text,e.size);t.alpha=e.alpha||1,this.textGroup.add(t)}.bind(this)),this.game.add.button(this.game.width-120,this.game.height-50,"next_button",this.nextLevel,this),this.cursors=this.game.input.keyboard.createCursorKeys()},nextLevel:function(){this.transitionning||(this.transitionning=!0,this.game.fadePlugin.fadeOut(0,750,0,function(){this.game.state.start("navigation")}))}},Game.State.Intro_50s=function(){},Game.State.Intro_50s.prototype={cursors:null,transitionning:!1,fixedTextOverlays:[{text:"1950s",size:200,x:20,y:20,alpha:.2},{text:"Post-war Britain started the 1950s hard-up and hurting.\n\nFood rations were in place until 1954, there were unexploded bombs in the\rstreets, and Britain's international standing was shaken by the Suez crisis.\n\nBut by the end of the decade the UK had a new Queen, television sets,\rand rock n'roll.\n\nPrime Minister Harold MacMillan proclaimed 'most of\rour people have never had it so good'.",size:16,x:20,y:20}],create:function(){this.transitionning=!1,this.createState(),this.game.fadePlugin.fadeIn(0,750,0)},createState:function(){var e=this.game.add.graphics(0,0);e.beginFill(0,1),e.drawRect(this.game.camera.x,this.game.camera.y,1.5*this.game.width,1.5*this.game.height),e.endFill(),this.endTextGroup=this.game.add.group(),this.endTextGroup.fixedToCamera=!1,this.endTextGroup.alpha=1,this.fixedTextOverlays.forEach(function(e){var t=new Phaser.Text(this.game,e.x,e.y,e.text,{font:"helvetica",fontSize:e.size,fill:"#ffffff"});t.alpha=e.alpha||1,this.endTextGroup.add(t)}.bind(this)),this.game.add.button(this.game.width-120,this.game.height-50,"next_button",this.nextLevel,this),this.cursors=this.game.input.keyboard.createCursorKeys()},nextLevel:function(){this.transitionning||(this.transitionning=!0,this.game.fadePlugin.fadeOut(0,750,0,function(){this.game.state.start("decade_50s")}))}},Game.State.Intro_AlexsHouse=function(){},Game.State.Intro_AlexsHouse.prototype={cursors:null,transitionning:!1,create:function(){this.transitionning=!1,this.game.add.image(0,0,"alexs_house"),this.game.add.button(this.game.width-120,this.game.height-50,"next_button",this.nextLevel,this),this.game.fadePlugin.fadeIn(0,750,0)},nextLevel:function(){this.transitionning||(this.transitionning=!0,this.game.fadePlugin.fadeOut(0,750,0,function(){this.game.state.start("navigation")}))}},Game.State.Intro_Skynews=function(){},Game.State.Intro_Skynews.prototype={cursors:null,transitionning:!1,create:function(){var e,t,a,s,i;this.game.analytics.stateStarted("intro"),this.transitionning=!1,this.game.stage.backgroundColor="#fff",this.game.add.image(0,0,"kay"),e=this.game.add.image(10,10,"skynews_logo"),t=this.game.add.image(0,300,"intro_ticker"),a=this.game.add.image(568,300,"intro_ticker"),s=this.game.add.group(),s.add(t),s.add(a),i=this.game.add.tween(s).to({x:-568},1e4,"Linear",!0),i.repeat(),this.clock=this.game.add.text(0,300," 00:00 ",{font:"16px Arial",fill:"#fff",backgroundColor:"black",boundsAlignV:"middle"}),this.speechText1=this.game.add.text(10,50,"A dastardly villain has travelled through time and stolen artifacts from the Queen's reign",{font:"16px Arial",fill:"#000",backgroundColor:"white",wordWrap:!0,wordWrapWidth:200}),this.speechText2=this.game.add.text(10,50,"Police are baffled. Won't somebody come forward and help? For our country!",{font:"16px Arial",fill:"#000",backgroundColor:"white",wordWrap:!0,wordWrapWidth:200}),this.speechText2.visible=!1,this.updateClock(),this.game.time.events.loop(Phaser.Timer.SECOND,this.updateClock,this),this.game.add.button(this.game.width-120,this.game.height-50,"next_button",this.nextFrame,this),this.game.fadePlugin.fadeIn(0,750,0)},nextFrame:function(){this.speechText1.visible?(this.speechText2.visible=!0,this.speechText1.visible=!1):this.nextLevel()},updateClock:function(){var e=new Date;this.clock.setText(" "+("0"+e.getHours()).slice(-2)+":"+("0"+e.getMinutes()).slice(-2)+" ")},nextLevel:function(){this.transitionning||(this.transitionning=!0,this.game.fadePlugin.fadeOut(0,750,0,function(){this.game.state.start("intro_alexs_house")}))}},Game.State.Navigation=function(){},Game.State.Navigation.prototype={cursors:null,transitionning:!1,buttonsOriginX:24,buttonsOriginY:24,buttonsMargin:30,buttonsPerRow:3,buttonHeight:48,buttonWidth:48,collectibleSize:10,create:function(){this.game.analytics.stateStarted("navigation"),this.transitionning=!1,this.createState(),this.game.fadePlugin.fadeIn(0,750,0)},createState:function(){var e=this.game.add.graphics(0,0),t=0,a=0;e.beginFill(0,1),e.drawRect(this.game.camera.x,this.game.camera.y,1.5*this.game.width,1.5*this.game.height),e.endFill(),this.buttonsGroup=this.game.add.group(),Game.Levels.forEach(function(e){var s,i,o,n=Game.Score.levelScores[e.stateKey],r=0;i=this.buttonsOriginX+a*(this.buttonWidth+this.buttonsMargin),o=this.buttonsOriginY+t*(this.buttonHeight+this.buttonsMargin),s=this.game.add.button(i,o,e.spriteKey,this.nextLevel,this),s.properties=e,e.collectibles.forEach(function(e){var t,a,s=i+18*r,l=o+this.buttonHeight+10,h=!1,c=6710886;n&&n.scoredItems.forEach(function(t){t.sprite_key===e&&(h=!0)}.bind(this)),"."===e?(h&&(c=16777215),t=this.game.add.graphics(0,0),t.properties={},t.properties.collectibleName=e,t.beginFill(c,1),t.drawRect(s,l,this.collectibleSize,this.collectibleSize),t.endFill()):(h||(e+="_grey"),t=this.game.add.sprite(s,l,e),a=Math.min(this.collectibleSize/t.width,this.collectibleSize/t.height),t.scale.setTo(a,a)),r++}.bind(this)),a+1>=this.buttonsPerRow?(a=0,t++):a++}.bind(this)),this.cursors=this.game.input.keyboard.createCursorKeys()},nextLevel:function(e){this.transitionning||(this.transitionning=!0,this.game.fadePlugin.fadeOut(0,750,0,function(){this.game.state.start(e.properties.stateKey||"tutorial")}))}},Game.State.Preloader=function(){},Game.State.Preloader.prototype={preload:function(){this.stage.backgroundColor="#000000",this.add.sprite(195,138,"crown"),this.textGroup=this.game.add.group(),this.textGroup.fixedToCamera=!0,this.textGroup.add(new Phaser.BitmapText(this.game,this.game.width/2-50,this.game.height/2-15,"pixeltype","Loading...",40)),this.game.load.image("intro_ticker","assets/sprites/intro-ticker.png"),this.game.load.image("skynews_logo","assets/sprites/8bit_sky_logo.png"),this.game.load.image("kay","assets/sprites/kayburley.png"),this.game.load.image("alexs_house","assets/sprites/alexshouse.png"),this.load.spritesheet("player","assets/sprites/alex_character.png",59,69,6),this.load.spritesheet("next_button","assets/sprites/next_button.png",100,30),this.game.load.image("sparkle1","assets/sprites/sparkle1.png"),this.game.load.image("sparkle2","assets/sprites/sparkle2.png"),this.game.load.image("sparkle3","assets/sprites/sparkle3.png"),this.game.load.image("transparent_32-160","assets/sprites/transparent_32-160.png"),this.game.load.image("jewel","assets/sprites/jewel.png"),this.game.load.image("jewel_grey","assets/sprites/jewel_grey.png"),this.game.load.image("corgi","assets/sprites/corgi.png"),this.game.load.image("corgi_grey","assets/sprites/corgi_grey.png"),this.game.load.image("crown_grey","assets/sprites/crown_grey.png"),this.game.load.image("tv","assets/sprites/50s_tv.png"),this.game.load.image("tv_grey","assets/sprites/50s_tv_grey.png"),this.game.load.image("record","assets/sprites/50s_record.png"),this.game.load.image("record_grey","assets/sprites/50s_record_grey.png"),this.game.load.image("mini","assets/sprites/50s_mini.png"),this.game.load.image("mini_grey","assets/sprites/50s_mini_grey.png"),this.game.load.image("beatles","assets/sprites/60s_beatles.png"),this.game.load.image("beatles_grey","assets/sprites/60s_beatles_grey.png"),this.game.load.image("worldcup","assets/sprites/60s_worldcup.png"),this.game.load.image("worldcup_grey","assets/sprites/60s_worldcup_grey.png"),this.game.load.image("the_sun","assets/sprites/60s_the_sun.png"),this.game.load.image("the_sun_grey","assets/sprites/60s_the_sun_grey.png"),this.game.load.image("button_level_50s","assets/sprites/level_buttons/level_50s.png"),this.game.load.image("button_level_60s","assets/sprites/level_buttons/level_60s.png"),this.game.load.image("button_level_70s","assets/sprites/level_buttons/level_70s.png"),this.game.load.image("button_level_80s","assets/sprites/level_buttons/level_80s.png"),this.game.load.image("button_level_90s","assets/sprites/level_buttons/level_90s.png"),this.game.load.image("button_level_00s","assets/sprites/level_buttons/level_00s.png"),this.game.load.image("button_level_10s","assets/sprites/level_buttons/level_10s.png"),this.load.image("compass","assets/sprites/compass_rose.png"),this.load.image("touch_segment","assets/sprites/touch_segment.png"),this.load.image("touch","assets/sprites/touch.png"),this.load.image("pause","assets/sprites/pause.png"),this.load.image("time_machine_button","assets/sprites/time-machine-button.png"),this.load.image("resume_button","assets/sprites/resume-button.png"),this.load.image("restart_level_button","assets/sprites/restart-level-button.png"),this.load.image("share_on_facebook","assets/sprites/share-on-facebook-button.png"),this.load.image("share_on_twitter","assets/sprites/share-on-twitter-button.png"),this.loadTileMaps()},loadTileMaps:function(){var e,t,a={};for(t=0;t<Game.Map.MAPS.length;t++)this.addTileSets(Game.Map.MAPS[t],a);for(e in a)a.hasOwnProperty(e)&&this.load.image(e,a[e])},addTileSets:function(e,t){var a,s,i,o=this.cache.getTilemapData(e).data.tilesets;for(i=0;i<o.length;i++)s=o[i].name,a="assets/maps/"+o[i].image,s in t||(t[s]=a)},create:function(){setTimeout(function(){this.game.fadePlugin.fadeOut(0,750,0,function(){this.game.state.start("intro_skynews")}.bind(this))}.bind(this),500)}},Game.State.Startup=function(){},Game.State.Startup.prototype={preload:function(){this.load.image("crown","assets/sprites/crown.png"),this.load.bitmapFont("nokia","assets/fonts/bitmapFonts/nokia.png","assets/fonts/bitmapFonts/nokia.xml"),this.load.bitmapFont("pixeltype","assets/fonts/bitmapFonts/pixeltype.png","assets/fonts/bitmapFonts/pixeltype.xml");var e,t;for(t=0;t<Game.Map.MAPS.length;t++)e=Game.Map.MAPS[t],this.load.tilemap(e,"assets/maps/"+e+".json",null,Phaser.Tilemap.TILED_JSON)},create:function(){this.game.scale.scaleMode=Phaser.ScaleManager.SHOW_ALL,this.game.fadePlugin=this.game.plugins.add(new Phaser.Plugin.Fade(this)),this.game.physics.startSystem(Phaser.Physics.ARCADE),this.game.state.start("preloader")}},Game.State.Tutorial=function(){},Game.State.Tutorial.prototype=new Game.State.BaseState,Game.State.Tutorial.prototype.levelKey="tutorial",Game.State.Tutorial.prototype.nextLevelKey="decade_50s",Game.State.Tutorial.prototype.setCollisions=function(){this.levelModule.tilemap.setCollisionBetween(76,84)},Game.State.Tutorial.prototype.createForegroundLayers=function(){this.banisterLayer=this.levelModule.createLayer("banisters"),this.columnLayer=this.levelModule.createLayer("columns")};var Game={};Game={},Game.State={},Game.Map={},Game.Map.Object={},Game.Score={nbCollectibles:0,nbCollected:0,levelScores:{},allCollected:function(){return this.nbCollectibles===this.nbCollected}},Game.Map.MAPS=["tutorial","decade_50s","decade_60s","decade_2010s"],Game.Levels=[{text:"50s",stateKey:"decade_50s",spriteKey:"button_level_50s",collectibles:["record","tv","mini"]},{text:"60s",stateKey:"decade_60s",spriteKey:"button_level_60s",collectibles:["beatles","the_sun","worldcup"]},{text:"70s",stateKey:null,spriteKey:"button_level_70s",collectibles:[".",".","."]},{text:"80s",stateKey:"tutorial",spriteKey:"button_level_80s",collectibles:["corgi",".","."]},{text:"90s",stateKey:null,spriteKey:"button_level_90s",collectibles:[".",".","."]},{text:"00s",stateKey:null,spriteKey:"button_level_00s",collectibles:[".",".","."]},{text:"10s",stateKey:"decade_2010s",spriteKey:"button_level_10s",collectibles:["corgi","crown","."]}],Game.init=function(){var e=new Phaser.Game(568,320,Phaser.AUTO,"main",null,!1,!1);this.game=e,e.analytics=Game.Analytics,e.storage=new Game.Storage("skynews-queen-feature-game"),e.state.add("startup",Game.State.Startup),e.state.add("preloader",Game.State.Preloader),e.state.add("intro_skynews",Game.State.Intro_Skynews),e.state.add("intro_alexs_house",Game.State.Intro_AlexsHouse),e.state.add("navigation",Game.State.Navigation),e.state.add("tutorial",Game.State.Tutorial),e.state.add("intro_50s",Game.State.Intro_50s),e.state.add("decade_50s",Game.State.Decade_50s),e.state.add("decade_60s",Game.State.Decade_60s),e.state.add("decade_2010s",Game.State.Decade_2010s),e.state.add("end_screen",Game.State.EndScreen),Game.Levels.forEach(function(e){e.collectibles.forEach(function(e){"."!==e&&this.Score.nbCollectibles++}.bind(this))}.bind(this)),Game.getCollectedItems(),e.state.start("startup")},Game.getCollectedItems=function(){this.Score.nbCollected=0,Game.Levels.forEach(function(e){var t=this.game.storage.get(e.stateKey);t&&t.scoredItems.forEach(function(e){"jewel"!==e.sprite_key&&this.Score.nbCollected++}.bind(this)),Game.Score.levelScores[e.stateKey]=t}.bind(this))},window.onload=function(){Game.init()},Phaser.Plugin.Fade=function(e,t){Phaser.Plugin.call(this,e,t)},Phaser.Plugin.Fade.prototype=Object.create(Phaser.Plugin.prototype),Phaser.Plugin.Fade.prototype.constructor=Phaser.Plugin.SamplePlugin,Phaser.Plugin.Fade.prototype.fadeOut=function(e,t,a,s){this.fade(e,t,a,0,1,s)},Phaser.Plugin.Fade.prototype.fadeIn=function(e,t,a,s){this.fade(e,t,a,1,0,s)},Phaser.Plugin.Fade.prototype.fade=function(e,t,a,s,i,o){a=a||0;var n,r=this.game.add.graphics(0,0);r.beginFill(e,1),r.drawRect(this.game.camera.x,this.game.camera.y,1.5*this.game.world.width,1.5*this.game.world.height),r.alpha=s,r.endFill(),n=this.game.add.tween(r),n.to({alpha:i},t,null),o&&n.onComplete.add(o,this),n.start()},Game.Analytics={stateStarted:function(e){this.sendEvent(["state started",e])},stateComplete:function(e){this.sendEvent(["state completed",e])},itemCollected:function(e){this.sendEvent(["item collected",e])},gameCompleted:function(){this.sendEvent(["game completed"])},sendEvent:function(e){setTimeout(function(){ga("send","event","The Reign Game",e[0],e[1])},1)}};var PLAYER_SPEED=200;Game.Controls=function(e,t){this.game=e,this.player=t,this.moving=!1,this.create()},Game.Controls.prototype.create=function(){this.cursors=this.game.input.keyboard.createCursorKeys()},Game.Controls.prototype.handleDown=function(e){this.moving?this.jump():(e.x<this.game.width/2?this.moveLeft():this.moveRight(),this.moving=!0)},Game.Controls.prototype.handleUp=function(){console.log(this.game.input.totalActivePointers),0===this.game.input.totalActivePointers?(this.player.animations.stop(),this.player.frame=2,this.player.body.velocity.x=0,this.moving=!1):this.handleDown(this.game.input.activePointer)},Game.Controls.prototype.moveLeft=function(){this.player.body.velocity.x=-PLAYER_SPEED,this.player.animations.play("left")},Game.Controls.prototype.moveRight=function(){this.player.body.velocity.x=PLAYER_SPEED,this.player.animations.play("right")},Game.Controls.prototype.jump=function(){this.player.body.onFloor()&&(this.player.body.velocity.y=-300)},Game.Controls.prototype.update=function(){var e=0;this.game.input.pointer1.isDown&&e++,this.game.input.pointer2.isDown&&e++,(this.cursors.up.isDown||e>1)&&this.jump(),1===e&&(this.activePointer=this.game.input.pointer1.isDown?this.game.input.pointer1:this.game.input.pointer2),this.cursors.left.isDown?this.moveLeft():this.cursors.right.isDown?this.moveRight():0===e&&(this.player.body.velocity.x=0,this.activePointer=null),this.activePointer&&(this.activePointer.x<this.game.width/2?this.moveLeft():this.activePointer.x>this.game.width/2&&this.moveRight()),0===this.player.body.velocity.x&&(this.player.animations.stop(),this.player.frame=2)},Game.LevelScore=function(e,t,a){this.game=e,this.sprites={},this.scoredItems=[],this.collectedItems=this.game.storage.get(t),this.collectibles=a,this.collectibleSize=16,this.addDisplay()},Game.LevelScore.prototype.addDisplay=function(){var e,t,a,s,i=this.game.width-33,o=!1;this.scoreGroup=this.game.add.group(),this.scoreGroup.fixedToCamera=!0,this.scoreText=new Phaser.BitmapText(this.game,i,7,"nokia","0",20),this.scoreGroup.add(this.scoreText),this.collectibles.forEach(function(n){if("jewel"===n.properties.sprite_key){if(!o){o=!0,i-=32;var r=this.game.add.sprite(i,0,"jewel");this.scoreGroup.add(r),i-=20}}else e=n.properties.sprite_key,this.collectedItems&&this.collectedItems.scoredItems.forEach(function(e){e.sprite_key===n.properties.sprite_key&&(t=!0)}),t||(e+="_grey"),a=this.game.add.sprite(i,7,e),s=Math.min(this.collectibleSize/a.width,this.collectibleSize/a.height),a.scale.setTo(s,s),this.scoreGroup.add(a),this.sprites[n.properties.sprite_key]=a,i-=a.width*s+16}.bind(this))},Game.LevelScore.prototype.scoreItem=function(e,t){this.game.analytics.itemCollected(e.sprite_key);var a=this.sprites[e.sprite_key];a&&a.loadTexture(e.sprite_key),this.scoredItems.push(e),Game.Score.levelScores[t]={scoredItems:this.scoredItems},"jewel"!==e.sprite_key&&Game.Score.nbCollected<Game.Score.nbCollectibles&&Game.Score.nbCollected++,this.game.storage.set(t,{scoredItems:this.scoredItems}),this.updatePoints(this.scoredItems)},Game.LevelScore.prototype.updatePoints=function(e){var t,a=0;e.forEach(function(e){t=e.score,typeof t!==Number&&(t=parseInt(t,10)),a+=t}),this.scoreText&&this.scoreText.setText(a)},Game.Map.Module=function(e,t){this.game=e,this.tilemap=e.add.tilemap(t);for(var a=0;a<this.tilemap.tilesets.length;a++)this.tilemap.addTilesetImage(this.tilemap.tilesets[a].name)},Game.Map.Module.prototype={createLayer:function(){return this.tilemap.createLayer.apply(this.tilemap,arguments)},createLayers:function(){var e,t,a={};for(t=0;t<arguments.length;t++)e=arguments[t],a[e]=this.tilemap.createLayer(e);return a},findTextObjects:function(){var e=this,t=[];return this.tilemap.objects.text&&this.tilemap.objects.text.forEach(function(a){a.y-=e.tilemap.tileHeight,a.properties.text=a.properties.text.replace(/\\n/g,"\n").replace(/\\r/g,"\r"),a.properties.size=a.properties.size||20,t.push(a)}),t},findCollectibleObjects:function(){var e=this,t=[];return this.tilemap.objects.collectibles&&this.tilemap.objects.collectibles.forEach(function(a){a.y-=e.tilemap.tileHeight,t.push(a)}),t},findObjectsByType:function(e){var t=this,a=[];return this.tilemap.objects.objects&&this.tilemap.objects.objects.forEach(function(s){s.type===e&&(s.y-=t.tilemap.tileHeight,a.push(s))}),a},getCollisionSprites:function(e,t,a,s){a=a||0,s=s||0;var i,o=this,n=[];return this.tilemap.objects[e].forEach(function(e){
e.y-=o.tilemap.tileHeight,i=t.create(e.x+32*a,e.y+32*s),o.game.physics.arcade.enable(i),i.body.setSize(e.properties.width,e.properties.height),i.body.immovable=!0,n.push(i)}),n},spriteFromObject:function(e,t){var a=t.create(e.x,e.y,e.properties.sprite);return a.properties={},Object.keys(e.properties).forEach(function(t){a.properties[t]=e.properties[t]}),a}},Game.PauseMenu=function(e){this.game=e,this.buttonDefinitions=[{sprite:"time_machine_button",x:40,y:80,callback:"backToNavigation"},{sprite:"resume_button",x:40,y:120,callback:"resume"},{sprite:"restart_level_button",x:40,y:160,callback:"restartLevel"},{sprite:"share_on_facebook",x:40,y:200,callback:"shareOnFacebook"},{sprite:"share_on_twitter",x:40,y:240,callback:"shareOnTwitter"}],this.buttons=[],this.addPauseButton(),this.drawMenu(),this.game.input.onDown.add(this.handleInput,this)},Game.PauseMenu.prototype.addPauseButton=function(){this.pauseButton=this.game.add.button(10,10,"pause",this.showPauseMenu,this),this.pauseButton.fixedToCamera=!0},Game.PauseMenu.prototype.drawMenu=function(){var e,t,a;this.menuGroup=this.game.add.group(),this.menuGroup.visible=!1,a=this.game.add.graphics(0,0),a.fixedToCamera=!0,a.beginFill(0,.8),a.drawRect(this.game.camera.x,this.game.camera.y,this.game.width,this.game.height),a.endFill(),this.menuGroup.add(a),e=new Phaser.Text(this.game,240,40,"Paused",{font:"helvetica",fontSize:18,fill:"#ffffff"}),e.fixedToCamera=!0,this.menuGroup.add(e),this.buttonDefinitions.forEach(function(e){t=new Phaser.Image(this.game,e.x,e.y,e.sprite),t.fixedToCamera=!0,this.menuGroup.add(t),this.buttons.push({x1:t.x,y1:t.y,x2:t.x+t.width,y2:t.y+t.height,callback:e.callback})}.bind(this))},Game.PauseMenu.prototype.handleInput=function(e){this.game.paused&&this.buttons.forEach(function(t){e.x>t.x1&&e.x<t.x2&&e.y>t.y1&&e.y<t.y2&&t.callback&&this[t.callback]()}.bind(this))},Game.PauseMenu.prototype.backToNavigation=function(){this.game.paused=!1,this.game.state.start("navigation")},Game.PauseMenu.prototype.resume=function(){this.game.paused=!1,this.pauseButton.visible=!0,this.menuGroup.visible=!1},Game.PauseMenu.prototype.restartLevel=function(){this.game.paused=!1,this.game.state.start(this.game.state.current)},Game.PauseMenu.prototype.showPauseMenu=function(){this.game.paused=!0,this.pauseButton.visible=!1,this.menuGroup.visible=!0},Game.PauseMenu.prototype.shareOnFacebook=function(){console.log("shared on Facebook")},Game.PauseMenu.prototype.shareOnTwitter=function(){console.log("shared on Twitter")},Game.Storage=function(e){this.storageName=e||"skynews-game",this.read()},Game.Storage.prototype.save=function(){localStorage.setItem(this.storageName,JSON.stringify(this.state))},Game.Storage.prototype.read=function(){this.state=JSON.parse(localStorage.getItem(this.storageName)||"{}")||{}},Game.Storage.prototype.set=function(e,t){this.state[e]=t,this.save()},Game.Storage.prototype.get=function(e){return this.state[e]},Game.State.BaseState=function(){this.levelKey=null,this.controls=null,this.collectibleItems=[],this.collectedItems=[],this.parallaxTextGroup=null,this.fixedTextGroup=null},Game.State.BaseState.prototype={TEXT_PARALLAX_SCALE:1.1,create:function(){this.game.analytics.stateStarted(this.levelKey),this.game.physics.arcade.gravity.y=600,this._createState(),this.game.fadePlugin.fadeIn(0,750,0)},addPlayer:function(){var e=this.levelModule.findObjectsByType("player_spawn");this.player=this.game.add.sprite(e[0].x,e[0].y-32,"player"),this.game.physics.arcade.enable(this.player),this.player.body.collideWorldBounds=!0,this.game.camera.follow(this.player),this.player.animations.add("left",[0,1],5,!0),this.player.animations.add("right",[3,4],5,!0)},addCollectibles:function(){this.collectibleItems=[];var e=this.levelModule.findCollectibleObjects();e.forEach(function(e){var t=this.game.add.sprite(e.x,e.y,e.properties.sprite_key);"jewel"!==e.properties.sprite_key&&(t._isArtefact=!0,t._revealFactId=e.properties.revealFactId,this.addArtefactEmitter(t)),t.properties=e.properties,this.game.physics.arcade.enable(t),t.body.allowGravity=!1,t.anchor=new Phaser.Point(.5,.5),this.collectibleItems.push(t)}.bind(this))},addArtefactEmitter:function(e){var t=this.game.add.emitter(e.x,e.y,10);t.makeParticles(["sparkle1","sparkle2","sparkle3"]),t.minParticleSpeed.setTo(-50,-50),t.maxParticleSpeed.setTo(50,50),t.gravity=-600,t.alpha=.5,t.minParticleAlpha=.7,t.maxParticleAlpha=1,t.minParticleScale=.5,t.maxParticleScale=1.5,t.start(!1,1e3,100),e._emitter=t},addNextLevelPortal:function(){var e=this.levelModule.findObjectsByType("next_level");e.length&&(this.nextLevel=this.game.add.sprite(e[0].x,e[0].y,"transparent_32-160"),this.game.physics.arcade.enable(this.nextLevel),this.nextLevel.body.allowGravity=!1,this.nextLevel.y-=110)},_createState:function(){var e;this.levelModule=new Game.Map.Module(this.game,this.levelKey),this.modules={},this.createBackgroundLayers&&"function"==typeof this.createBackgroundLayers&&this.createBackgroundLayers(),this.platform=this.levelModule.createLayer("platform"),this.platform.alpha=0,this.platform.resizeWorld(),this.addNextLevelPortal(),e=this.levelModule.findTextObjects(),this.factReference={},this.addPlayer(),this.addCollectibles(),this.controls=new Game.Controls(this.game,this.player),this.createForegroundLayers&&"function"==typeof this.createForegroundLayers&&this.createForegroundLayers(),e.forEach(function(e){"factoid"===e.properties.type?this.factReference[e.properties.id]=new Game.Map.Object.Factoid(this.game,e):new Game.Map.Object.FloatingText(this.game,e)}.bind(this)),this.setCollisions&&"function"==typeof this.setCollisions&&this.setCollisions(),this.scoreDisplay=new Game.LevelScore(this.game,this.levelKey,this.collectibleItems),this.pauseMenu=new Game.PauseMenu(this.game)},_collectiblesCollisionHandler:function(e,t){var a=null;t._emitter&&(t._emitter.on=!1),a=t,a.x=a.x-this.game.camera.x,a.y=a.y-this.game.camera.y,t.fixedToCamera=!0,a.body.destroy(),this.game.add.tween(a).to({alpha:0},500,"Linear",!0),this.game.add.tween(a.scale).to({x:3,y:3},250,Phaser.Easing.Quadratic.In,!0).chain(this.game.add.tween(a.scale).to({x:1,y:1},250,Phaser.Easing.Quadratic.Out)),this.game.add.tween(a.cameraOffset).to({y:-32},500,Phaser.Easing.Quadratic.InOut,!0),this.game.add.tween(a.cameraOffset).to({x:500},500,Phaser.Easing.Quadratic.InOut,!0).onComplete.add(a.destroy,a),this.collectedItems.push(a),this.itemCollectedHandler&&"function"==typeof this.itemCollectedHandler&&this.itemCollectedHandler(a),this.scoreDisplay.scoreItem(a.properties,this.levelKey),a._revealFactId&&this.factReference[a._revealFactId].reveal()},_nextLevelHandler:function(){var e=this.nextLevelKey;this.game.fadePlugin.fadeOut(0,750,0,function(){this.game.analytics.stateComplete(this.levelKey),Game.Score.allCollected()&&(e="end_screen"),this.game.state.start(e)}.bind(this))},update:function(){this._updateState(),this.updateState&&"function"==typeof this.updateState&&this.updateState()},_updateState:function(){this.parallaxTextGroup&&(this.parallaxTextGroup.x=this.game.world.x*this.TEXT_PARALLAX_SCALE),this.game.physics.arcade.collide(this.player,this.platform),this.game.physics.arcade.overlap(this.player,this.collectibleItems,this._collectiblesCollisionHandler,null,this),this.game.physics.arcade.overlap(this.player,this.nextLevel,this._nextLevelHandler,null,this),this.controls.update()}},Game.State.Decade_2010s=function(){},Game.State.Decade_2010s.prototype=new Game.State.BaseState,Game.State.Decade_2010s.prototype.levelKey="decade_2010s",Game.State.Decade_2010s.prototype.nextLevelKey="navigation",Game.State.Decade_2010s.prototype.setCollisions=function(){this.levelModule.tilemap.setCollisionBetween(834,849),this.levelModule.tilemap.setCollisionBetween(861,882)},Game.State.Decade_50s=function(){},Game.State.Decade_50s.prototype=new Game.State.BaseState,Game.State.Decade_50s.prototype.levelKey="decade_50s",Game.State.Decade_50s.prototype.nextLevelKey="decade_60s",Game.State.Decade_50s.prototype.setCollisions=function(){this.levelModule.tilemap.setCollision(76)},Game.State.Decade_50s.prototype.createBackgroundLayers=function(){this.levelModule.createLayer("background")},Game.State.Decade_50s.prototype.createForegroundLayers=function(){this.levelModule.createLayer("foreground")},Game.State.Decade_60s=function(){},Game.State.Decade_60s.prototype=new Game.State.BaseState,Game.State.Decade_60s.prototype.levelKey="decade_60s",Game.State.Decade_60s.prototype.nextLevelKey="decade_2010s",Game.State.Decade_60s.prototype.setCollisions=function(){this.levelModule.tilemap.setCollision(3)},Game.State.Decade_60s.prototype.createBackgroundLayers=function(){this.levelModule.createLayer("bg_colour"),this.levelModule.createLayer("background")},Game.State.Decade_60s.prototype.createForegroundLayers=function(){this.levelModule.createLayer("foreground")},Game.State.Decade_60s.prototype.updateState=function(){this.parallaxTextGroup.x=this.game.world.x*this.TEXT_PARALLAX_SCALE,this.parallaxTextGroup.y=this.game.world.y*this.TEXT_PARALLAX_SCALE},Game.State.EndScreen=function(){},Game.State.EndScreen.prototype={cursors:null,transitionning:!1,fixedTextOverlays:[{text:"Well done",size:100,x:20,y:20,alpha:.2},{text:"All royal artefacts have been returned!",size:20,x:20,y:120}],create:function(){this.game.analytics.gameCompleted(),this.transitionning=!1,this.createState(),this.game.fadePlugin.fadeIn(0,750,0)},createState:function(){var e=this.game.add.graphics(0,0);e.beginFill(0,1),e.drawRect(this.game.camera.x,this.game.camera.y,1.5*this.game.width,1.5*this.game.height),e.endFill(),this.textGroup=this.game.add.group(),this.textGroup.fixedToCamera=!1,this.textGroup.alpha=1,this.fixedTextOverlays.forEach(function(e){var t=new Phaser.BitmapText(this.game,e.x,e.y,"nokia",e.text,e.size);t.alpha=e.alpha||1,this.textGroup.add(t)}.bind(this)),this.game.add.button(this.game.width-120,this.game.height-50,"next_button",this.nextLevel,this),this.cursors=this.game.input.keyboard.createCursorKeys()},nextLevel:function(){this.transitionning||(this.transitionning=!0,this.game.fadePlugin.fadeOut(0,750,0,function(){this.game.state.start("navigation")}))}},Game.State.Intro_50s=function(){},Game.State.Intro_50s.prototype={cursors:null,transitionning:!1,fixedTextOverlays:[{text:"1950s",size:200,x:20,y:20,alpha:.2},{text:"Post-war Britain started the 1950s hard-up and hurting.\n\nFood rations were in place until 1954, there were unexploded bombs in the\rstreets, and Britain's international standing was shaken by the Suez crisis.\n\nBut by the end of the decade the UK had a new Queen, television sets,\rand rock n'roll.\n\nPrime Minister Harold MacMillan proclaimed 'most of\rour people have never had it so good'.",size:16,x:20,y:20}],create:function(){this.transitionning=!1,this.createState(),this.game.fadePlugin.fadeIn(0,750,0)},createState:function(){var e=this.game.add.graphics(0,0);e.beginFill(0,1),e.drawRect(this.game.camera.x,this.game.camera.y,1.5*this.game.width,1.5*this.game.height),e.endFill(),this.endTextGroup=this.game.add.group(),this.endTextGroup.fixedToCamera=!1,this.endTextGroup.alpha=1,this.fixedTextOverlays.forEach(function(e){var t=new Phaser.Text(this.game,e.x,e.y,e.text,{font:"helvetica",fontSize:e.size,fill:"#ffffff"});t.alpha=e.alpha||1,this.endTextGroup.add(t)}.bind(this)),this.game.add.button(this.game.width-120,this.game.height-50,"next_button",this.nextLevel,this),this.cursors=this.game.input.keyboard.createCursorKeys()},nextLevel:function(){this.transitionning||(this.transitionning=!0,this.game.fadePlugin.fadeOut(0,750,0,function(){this.game.state.start("decade_50s")}))}},Game.State.Intro_AlexsHouse=function(){},Game.State.Intro_AlexsHouse.prototype={cursors:null,transitionning:!1,create:function(){this.transitionning=!1,this.game.add.image(0,0,"alexs_house"),this.game.add.button(this.game.width-120,this.game.height-50,"next_button",this.nextLevel,this),this.game.fadePlugin.fadeIn(0,750,0)},nextLevel:function(){this.transitionning||(this.transitionning=!0,this.game.fadePlugin.fadeOut(0,750,0,function(){this.game.state.start("navigation")}))}},Game.State.Intro_Skynews=function(){},Game.State.Intro_Skynews.prototype={cursors:null,transitionning:!1,create:function(){var e,t,a,s,i;this.game.analytics.stateStarted("intro"),this.transitionning=!1,this.game.stage.backgroundColor="#fff",this.game.add.image(0,0,"kay"),e=this.game.add.image(10,10,"skynews_logo"),t=this.game.add.image(0,300,"intro_ticker"),a=this.game.add.image(568,300,"intro_ticker"),s=this.game.add.group(),s.add(t),s.add(a),i=this.game.add.tween(s).to({x:-568},1e4,"Linear",!0),i.repeat(),this.clock=this.game.add.text(0,300," 00:00 ",{font:"16px Arial",fill:"#fff",backgroundColor:"black",boundsAlignV:"middle"}),this.speechText1=this.game.add.text(10,50,"A dastardly villain has travelled through time and stolen artifacts from the Queen's reign",{font:"16px Arial",fill:"#000",backgroundColor:"white",wordWrap:!0,wordWrapWidth:200}),this.speechText2=this.game.add.text(10,50,"Police are baffled. Won't somebody come forward and help? For our country!",{font:"16px Arial",fill:"#000",backgroundColor:"white",wordWrap:!0,wordWrapWidth:200}),this.speechText2.visible=!1,this.updateClock(),this.game.time.events.loop(Phaser.Timer.SECOND,this.updateClock,this),this.game.add.button(this.game.width-120,this.game.height-50,"next_button",this.nextFrame,this),this.game.fadePlugin.fadeIn(0,750,0)},nextFrame:function(){this.speechText1.visible?(this.speechText2.visible=!0,this.speechText1.visible=!1):this.nextLevel()},updateClock:function(){var e=new Date;this.clock.setText(" "+("0"+e.getHours()).slice(-2)+":"+("0"+e.getMinutes()).slice(-2)+" ")},nextLevel:function(){this.transitionning||(this.transitionning=!0,this.game.fadePlugin.fadeOut(0,750,0,function(){this.game.state.start("intro_alexs_house")}))}},Game.State.Navigation=function(){},Game.State.Navigation.prototype={cursors:null,transitionning:!1,buttonsOriginX:24,buttonsOriginY:24,buttonsMargin:30,buttonsPerRow:3,buttonHeight:48,buttonWidth:48,collectibleSize:10,create:function(){this.game.analytics.stateStarted("navigation"),this.transitionning=!1,this.createState(),this.game.fadePlugin.fadeIn(0,750,0)},createState:function(){var e=this.game.add.graphics(0,0),t=0,a=0;e.beginFill(0,1),e.drawRect(this.game.camera.x,this.game.camera.y,1.5*this.game.width,1.5*this.game.height),e.endFill(),this.buttonsGroup=this.game.add.group(),Game.Levels.forEach(function(e){var s,i,o,n=Game.Score.levelScores[e.stateKey],r=0;i=this.buttonsOriginX+a*(this.buttonWidth+this.buttonsMargin),o=this.buttonsOriginY+t*(this.buttonHeight+this.buttonsMargin),s=this.game.add.button(i,o,e.spriteKey,this.nextLevel,this),s.properties=e,e.collectibles.forEach(function(e){var t,a,s=i+18*r,l=o+this.buttonHeight+10,h=!1,c=6710886;n&&n.scoredItems.forEach(function(t){t.sprite_key===e&&(h=!0)}.bind(this)),"."===e?(h&&(c=16777215),t=this.game.add.graphics(0,0),t.properties={},t.properties.collectibleName=e,t.beginFill(c,1),t.drawRect(s,l,this.collectibleSize,this.collectibleSize),t.endFill()):(h||(e+="_grey"),t=this.game.add.sprite(s,l,e),a=Math.min(this.collectibleSize/t.width,this.collectibleSize/t.height),t.scale.setTo(a,a)),r++}.bind(this)),a+1>=this.buttonsPerRow?(a=0,t++):a++}.bind(this)),this.cursors=this.game.input.keyboard.createCursorKeys()},nextLevel:function(e){this.transitionning||(this.transitionning=!0,this.game.fadePlugin.fadeOut(0,750,0,function(){this.game.state.start(e.properties.stateKey||"tutorial")}))}},Game.State.Preloader=function(){},Game.State.Preloader.prototype={preload:function(){this.stage.backgroundColor="#000000",this.add.sprite(195,138,"crown"),this.textGroup=this.game.add.group(),this.textGroup.fixedToCamera=!0,this.textGroup.add(new Phaser.BitmapText(this.game,this.game.width/2-50,this.game.height/2-15,"pixeltype","Loading...",40)),this.game.load.image("intro_ticker","assets/sprites/intro-ticker.png"),this.game.load.image("skynews_logo","assets/sprites/8bit_sky_logo.png"),this.game.load.image("kay","assets/sprites/kayburley.png"),this.game.load.image("alexs_house","assets/sprites/alexshouse.png"),this.load.spritesheet("player","assets/sprites/alex_character.png",59,69,6),this.load.spritesheet("next_button","assets/sprites/next_button.png",100,30),this.game.load.image("sparkle1","assets/sprites/sparkle1.png"),this.game.load.image("sparkle2","assets/sprites/sparkle2.png"),this.game.load.image("sparkle3","assets/sprites/sparkle3.png"),this.game.load.image("transparent_32-160","assets/sprites/transparent_32-160.png"),this.game.load.image("jewel","assets/sprites/jewel.png"),this.game.load.image("jewel_grey","assets/sprites/jewel_grey.png"),this.game.load.image("corgi","assets/sprites/corgi.png"),this.game.load.image("corgi_grey","assets/sprites/corgi_grey.png"),this.game.load.image("crown_grey","assets/sprites/crown_grey.png"),this.game.load.image("tv","assets/sprites/50s_tv.png"),this.game.load.image("tv_grey","assets/sprites/50s_tv_grey.png"),this.game.load.image("record","assets/sprites/50s_record.png"),this.game.load.image("record_grey","assets/sprites/50s_record_grey.png"),this.game.load.image("mini","assets/sprites/50s_mini.png"),this.game.load.image("mini_grey","assets/sprites/50s_mini_grey.png"),this.game.load.image("beatles","assets/sprites/60s_beatles.png"),this.game.load.image("beatles_grey","assets/sprites/60s_beatles_grey.png"),this.game.load.image("worldcup","assets/sprites/60s_worldcup.png"),this.game.load.image("worldcup_grey","assets/sprites/60s_worldcup_grey.png"),this.game.load.image("the_sun","assets/sprites/60s_the_sun.png"),this.game.load.image("the_sun_grey","assets/sprites/60s_the_sun_grey.png"),this.game.load.image("button_level_50s","assets/sprites/level_buttons/level_50s.png"),this.game.load.image("button_level_60s","assets/sprites/level_buttons/level_60s.png"),this.game.load.image("button_level_70s","assets/sprites/level_buttons/level_70s.png"),this.game.load.image("button_level_80s","assets/sprites/level_buttons/level_80s.png"),this.game.load.image("button_level_90s","assets/sprites/level_buttons/level_90s.png"),this.game.load.image("button_level_00s","assets/sprites/level_buttons/level_00s.png"),this.game.load.image("button_level_10s","assets/sprites/level_buttons/level_10s.png"),this.load.image("compass","assets/sprites/compass_rose.png"),this.load.image("touch_segment","assets/sprites/touch_segment.png"),this.load.image("touch","assets/sprites/touch.png"),this.load.image("pause","assets/sprites/pause.png"),this.load.image("time_machine_button","assets/sprites/time-machine-button.png"),this.load.image("resume_button","assets/sprites/resume-button.png"),this.load.image("restart_level_button","assets/sprites/restart-level-button.png"),this.load.image("share_on_facebook","assets/sprites/share-on-facebook-button.png"),this.load.image("share_on_twitter","assets/sprites/share-on-twitter-button.png"),this.loadTileMaps()},loadTileMaps:function(){var e,t,a={};for(t=0;t<Game.Map.MAPS.length;t++)this.addTileSets(Game.Map.MAPS[t],a);for(e in a)a.hasOwnProperty(e)&&this.load.image(e,a[e])},addTileSets:function(e,t){var a,s,i,o=this.cache.getTilemapData(e).data.tilesets;for(i=0;i<o.length;i++)s=o[i].name,a="assets/maps/"+o[i].image,s in t||(t[s]=a)},create:function(){setTimeout(function(){this.game.fadePlugin.fadeOut(0,750,0,function(){this.game.state.start("intro_skynews")}.bind(this))}.bind(this),500)}},Game.State.Startup=function(){},Game.State.Startup.prototype={preload:function(){this.load.image("crown","assets/sprites/crown.png"),this.load.bitmapFont("nokia","assets/fonts/bitmapFonts/nokia.png","assets/fonts/bitmapFonts/nokia.xml"),this.load.bitmapFont("pixeltype","assets/fonts/bitmapFonts/pixeltype.png","assets/fonts/bitmapFonts/pixeltype.xml");var e,t;for(t=0;t<Game.Map.MAPS.length;t++)e=Game.Map.MAPS[t],this.load.tilemap(e,"assets/maps/"+e+".json",null,Phaser.Tilemap.TILED_JSON)},create:function(){this.game.scale.scaleMode=Phaser.ScaleManager.SHOW_ALL,this.game.fadePlugin=this.game.plugins.add(new Phaser.Plugin.Fade(this)),this.game.physics.startSystem(Phaser.Physics.ARCADE),this.game.state.start("preloader")}},Game.State.Tutorial=function(){},Game.State.Tutorial.prototype=new Game.State.BaseState,Game.State.Tutorial.prototype.levelKey="tutorial",Game.State.Tutorial.prototype.nextLevelKey="decade_50s",Game.State.Tutorial.prototype.setCollisions=function(){this.levelModule.tilemap.setCollisionBetween(76,84)},Game.State.Tutorial.prototype.createForegroundLayers=function(){this.banisterLayer=this.levelModule.createLayer("banisters"),this.columnLayer=this.levelModule.createLayer("columns")};var Game={};Game={},Game.State={},Game.Map={},Game.Map.Object={},Game.Score={nbCollectibles:0,nbCollected:0,levelScores:{},allCollected:function(){return this.nbCollectibles===this.nbCollected}},Game.Map.MAPS=["tutorial","decade_50s","decade_60s","decade_2010s"],Game.Levels=[{text:"50s",stateKey:"decade_50s",spriteKey:"button_level_50s",collectibles:["record","tv","mini"]},{text:"60s",stateKey:"decade_60s",spriteKey:"button_level_60s",collectibles:["beatles","the_sun","worldcup"]},{text:"70s",stateKey:null,spriteKey:"button_level_70s",collectibles:[".",".","."]},{text:"80s",stateKey:"tutorial",spriteKey:"button_level_80s",collectibles:["corgi",".","."]},{text:"90s",stateKey:null,spriteKey:"button_level_90s",collectibles:[".",".","."]},{text:"00s",stateKey:null,spriteKey:"button_level_00s",collectibles:[".",".","."]},{text:"10s",stateKey:"decade_2010s",spriteKey:"button_level_10s",collectibles:["corgi","crown","."]}],Game.init=function(){var e=new Phaser.Game(568,320,Phaser.AUTO,"main",null,!1,!1);this.game=e,e.analytics=Game.Analytics,e.storage=new Game.Storage("skynews-queen-feature-game"),e.state.add("startup",Game.State.Startup),e.state.add("preloader",Game.State.Preloader),e.state.add("intro_skynews",Game.State.Intro_Skynews),e.state.add("intro_alexs_house",Game.State.Intro_AlexsHouse),e.state.add("navigation",Game.State.Navigation),e.state.add("tutorial",Game.State.Tutorial),e.state.add("intro_50s",Game.State.Intro_50s),e.state.add("decade_50s",Game.State.Decade_50s),e.state.add("decade_60s",Game.State.Decade_60s),e.state.add("decade_2010s",Game.State.Decade_2010s),e.state.add("end_screen",Game.State.EndScreen),Game.Levels.forEach(function(e){e.collectibles.forEach(function(e){"."!==e&&this.Score.nbCollectibles++}.bind(this))}.bind(this)),Game.getCollectedItems(),e.state.start("startup")},Game.getCollectedItems=function(){this.Score.nbCollected=0,Game.Levels.forEach(function(e){var t=this.game.storage.get(e.stateKey);t&&t.scoredItems.forEach(function(e){"jewel"!==e.sprite_key&&this.Score.nbCollected++}.bind(this)),Game.Score.levelScores[e.stateKey]=t}.bind(this))},window.onload=function(){Game.init()},Phaser.Plugin.Fade=function(e,t){Phaser.Plugin.call(this,e,t)},Phaser.Plugin.Fade.prototype=Object.create(Phaser.Plugin.prototype),Phaser.Plugin.Fade.prototype.constructor=Phaser.Plugin.SamplePlugin,Phaser.Plugin.Fade.prototype.fadeOut=function(e,t,a,s){this.fade(e,t,a,0,1,s)},Phaser.Plugin.Fade.prototype.fadeIn=function(e,t,a,s){this.fade(e,t,a,1,0,s)},Phaser.Plugin.Fade.prototype.fade=function(e,t,a,s,i,o){a=a||0;var n,r=this.game.add.graphics(0,0);r.beginFill(e,1),r.drawRect(this.game.camera.x,this.game.camera.y,1.5*this.game.world.width,1.5*this.game.world.height),r.alpha=s,r.endFill(),n=this.game.add.tween(r),n.to({alpha:i},t,null),o&&n.onComplete.add(o,this),n.start()},Game.Analytics={stateStarted:function(e){this.sendEvent(["state started",e])},stateComplete:function(e){this.sendEvent(["state completed",e])},itemCollected:function(e){this.sendEvent(["item collected",e])},gameCompleted:function(){this.sendEvent(["game completed"])},sendEvent:function(e){setTimeout(function(){ga("send","event","The Reign Game",e[0],e[1])},1)}};var PLAYER_SPEED=200;Game.Controls=function(e,t){this.game=e,this.player=t,this.moving=!1,this.create()},Game.Controls.prototype.create=function(){this.cursors=this.game.input.keyboard.createCursorKeys()},Game.Controls.prototype.handleDown=function(e){this.moving?this.jump():(e.x<this.game.width/2?this.moveLeft():this.moveRight(),this.moving=!0)},Game.Controls.prototype.handleUp=function(){console.log(this.game.input.totalActivePointers),0===this.game.input.totalActivePointers?(this.player.animations.stop(),this.player.frame=2,this.player.body.velocity.x=0,this.moving=!1):this.handleDown(this.game.input.activePointer)},Game.Controls.prototype.moveLeft=function(){this.player.body.velocity.x=-PLAYER_SPEED,this.player.animations.play("left")},Game.Controls.prototype.moveRight=function(){this.player.body.velocity.x=PLAYER_SPEED,this.player.animations.play("right")},Game.Controls.prototype.jump=function(){this.player.body.onFloor()&&(this.player.body.velocity.y=-300)},Game.Controls.prototype.update=function(){var e=0;this.game.input.pointer1.isDown&&e++,this.game.input.pointer2.isDown&&e++,(this.cursors.up.isDown||e>1)&&this.jump(),1===e&&(this.activePointer=this.game.input.pointer1.isDown?this.game.input.pointer1:this.game.input.pointer2),this.cursors.left.isDown?this.moveLeft():this.cursors.right.isDown?this.moveRight():0===e&&(this.player.body.velocity.x=0,this.activePointer=null),this.activePointer&&(this.activePointer.x<this.game.width/2?this.moveLeft():this.activePointer.x>this.game.width/2&&this.moveRight()),0===this.player.body.velocity.x&&(this.player.animations.stop(),this.player.frame=2)},Game.LevelScore=function(e,t,a){this.game=e,this.sprites={},this.scoredItems=[],this.collectedItems=this.game.storage.get(t),this.collectibles=a,this.collectibleSize=16,this.addDisplay()},Game.LevelScore.prototype.addDisplay=function(){var e,t,a,s,i=this.game.width-33,o=!1;this.scoreGroup=this.game.add.group(),this.scoreGroup.fixedToCamera=!0,this.scoreText=new Phaser.BitmapText(this.game,i,7,"nokia","0",20),this.scoreGroup.add(this.scoreText),this.collectibles.forEach(function(n){if("jewel"===n.properties.sprite_key){if(!o){o=!0,i-=32;var r=this.game.add.sprite(i,0,"jewel");this.scoreGroup.add(r),i-=20}}else e=n.properties.sprite_key,this.collectedItems&&this.collectedItems.scoredItems.forEach(function(e){e.sprite_key===n.properties.sprite_key&&(t=!0)}),t||(e+="_grey"),a=this.game.add.sprite(i,7,e),s=Math.min(this.collectibleSize/a.width,this.collectibleSize/a.height),a.scale.setTo(s,s),this.scoreGroup.add(a),this.sprites[n.properties.sprite_key]=a,i-=a.width*s+16}.bind(this))},Game.LevelScore.prototype.scoreItem=function(e,t){this.game.analytics.itemCollected(e.sprite_key);var a=this.sprites[e.sprite_key];a&&a.loadTexture(e.sprite_key),this.scoredItems.push(e),Game.Score.levelScores[t]={scoredItems:this.scoredItems},"jewel"!==e.sprite_key&&Game.Score.nbCollected<Game.Score.nbCollectibles&&Game.Score.nbCollected++,this.game.storage.set(t,{scoredItems:this.scoredItems}),this.updatePoints(this.scoredItems)},Game.LevelScore.prototype.updatePoints=function(e){var t,a=0;e.forEach(function(e){t=e.score,typeof t!==Number&&(t=parseInt(t,10)),a+=t}),this.scoreText&&this.scoreText.setText(a)},Game.Map.Module=function(e,t){this.game=e,this.tilemap=e.add.tilemap(t);for(var a=0;a<this.tilemap.tilesets.length;a++)this.tilemap.addTilesetImage(this.tilemap.tilesets[a].name)},Game.Map.Module.prototype={createLayer:function(){return this.tilemap.createLayer.apply(this.tilemap,arguments)},createLayers:function(){var e,t,a={};for(t=0;t<arguments.length;t++)e=arguments[t],a[e]=this.tilemap.createLayer(e);return a},findTextObjects:function(){var e=this,t=[];return this.tilemap.objects.text&&this.tilemap.objects.text.forEach(function(a){a.y-=e.tilemap.tileHeight,a.properties.text=a.properties.text.replace(/\\n/g,"\n").replace(/\\r/g,"\r"),a.properties.size=a.properties.size||20,t.push(a)}),t},findCollectibleObjects:function(){var e=this,t=[];return this.tilemap.objects.collectibles&&this.tilemap.objects.collectibles.forEach(function(a){a.y-=e.tilemap.tileHeight,t.push(a)}),t},findObjectsByType:function(e){var t=this,a=[];return this.tilemap.objects.objects&&this.tilemap.objects.objects.forEach(function(s){s.type===e&&(s.y-=t.tilemap.tileHeight,a.push(s))}),a},getCollisionSprites:function(e,t,a,s){a=a||0,s=s||0;var i,o=this,n=[];return this.tilemap.objects[e].forEach(function(e){e.y-=o.tilemap.tileHeight,i=t.create(e.x+32*a,e.y+32*s),o.game.physics.arcade.enable(i),i.body.setSize(e.properties.width,e.properties.height),i.body.immovable=!0,n.push(i)}),n},spriteFromObject:function(e,t){var a=t.create(e.x,e.y,e.properties.sprite);return a.properties={},Object.keys(e.properties).forEach(function(t){a.properties[t]=e.properties[t]}),a}},Game.PauseMenu=function(e){this.game=e,this.buttonDefinitions=[{sprite:"time_machine_button",x:40,y:80,callback:"backToNavigation"},{sprite:"resume_button",x:40,y:120,callback:"resume"},{sprite:"restart_level_button",x:40,y:160,callback:"restartLevel"},{sprite:"share_on_facebook",x:40,y:200,callback:"shareOnFacebook"},{sprite:"share_on_twitter",x:40,y:240,callback:"shareOnTwitter"}],this.buttons=[],this.addPauseButton(),this.drawMenu(),this.game.input.onDown.add(this.handleInput,this)},Game.PauseMenu.prototype.addPauseButton=function(){this.pauseButton=this.game.add.button(10,10,"pause",this.showPauseMenu,this),this.pauseButton.fixedToCamera=!0},Game.PauseMenu.prototype.drawMenu=function(){var e,t,a;this.menuGroup=this.game.add.group(),this.menuGroup.visible=!1,a=this.game.add.graphics(0,0),a.fixedToCamera=!0,a.beginFill(0,.8),a.drawRect(this.game.camera.x,this.game.camera.y,this.game.width,this.game.height),a.endFill(),this.menuGroup.add(a),e=new Phaser.Text(this.game,240,40,"Paused",{font:"helvetica",fontSize:18,fill:"#ffffff"}),e.fixedToCamera=!0,this.menuGroup.add(e),this.buttonDefinitions.forEach(function(e){t=new Phaser.Image(this.game,e.x,e.y,e.sprite),t.fixedToCamera=!0,this.menuGroup.add(t),this.buttons.push({x1:t.x,y1:t.y,x2:t.x+t.width,y2:t.y+t.height,callback:e.callback})}.bind(this))},Game.PauseMenu.prototype.handleInput=function(e){this.game.paused&&this.buttons.forEach(function(t){e.x>t.x1&&e.x<t.x2&&e.y>t.y1&&e.y<t.y2&&t.callback&&this[t.callback]()}.bind(this))},Game.PauseMenu.prototype.backToNavigation=function(){this.game.paused=!1,this.game.state.start("navigation")},Game.PauseMenu.prototype.resume=function(){this.game.paused=!1,this.pauseButton.visible=!0,this.menuGroup.visible=!1},Game.PauseMenu.prototype.restartLevel=function(){this.game.paused=!1,this.game.state.start(this.game.state.current)},Game.PauseMenu.prototype.showPauseMenu=function(){this.game.paused=!0,this.pauseButton.visible=!1,this.menuGroup.visible=!0},Game.PauseMenu.prototype.shareOnFacebook=function(){console.log("shared on Facebook")},Game.PauseMenu.prototype.shareOnTwitter=function(){console.log("shared on Twitter")},Game.Storage=function(e){this.storageName=e||"skynews-game",this.read()},Game.Storage.prototype.save=function(){localStorage.setItem(this.storageName,JSON.stringify(this.state))},Game.Storage.prototype.read=function(){this.state=JSON.parse(localStorage.getItem(this.storageName)||"{}")||{}},Game.Storage.prototype.set=function(e,t){this.state[e]=t,this.save()},Game.Storage.prototype.get=function(e){return this.state[e]},Game.State.BaseState=function(){this.levelKey=null,this.controls=null,this.collectibleItems=[],this.collectedItems=[],this.parallaxTextGroup=null,this.fixedTextGroup=null},Game.State.BaseState.prototype={TEXT_PARALLAX_SCALE:1.1,create:function(){this.game.analytics.stateStarted(this.levelKey),this.game.physics.arcade.gravity.y=600,this._createState(),this.game.fadePlugin.fadeIn(0,750,0)},addPlayer:function(){var e=this.levelModule.findObjectsByType("player_spawn");this.player=this.game.add.sprite(e[0].x,e[0].y-32,"player"),this.game.physics.arcade.enable(this.player),this.player.body.collideWorldBounds=!0,this.game.camera.follow(this.player),this.player.animations.add("left",[0,1],5,!0),this.player.animations.add("right",[3,4],5,!0)},addCollectibles:function(){this.collectibleItems=[];var e=this.levelModule.findCollectibleObjects();e.forEach(function(e){
var t=this.game.add.sprite(e.x,e.y,e.properties.sprite_key);"jewel"!==e.properties.sprite_key&&(t._isArtefact=!0,t._revealFactId=e.properties.revealFactId,this.addArtefactEmitter(t)),t.properties=e.properties,this.game.physics.arcade.enable(t),t.body.allowGravity=!1,t.anchor=new Phaser.Point(.5,.5),this.collectibleItems.push(t)}.bind(this))},addArtefactEmitter:function(e){var t=this.game.add.emitter(e.x,e.y,10);t.makeParticles(["sparkle1","sparkle2","sparkle3"]),t.minParticleSpeed.setTo(-50,-50),t.maxParticleSpeed.setTo(50,50),t.gravity=-600,t.alpha=.5,t.minParticleAlpha=.7,t.maxParticleAlpha=1,t.minParticleScale=.5,t.maxParticleScale=1.5,t.start(!1,1e3,100),e._emitter=t},addNextLevelPortal:function(){var e=this.levelModule.findObjectsByType("next_level");e.length&&(this.nextLevel=this.game.add.sprite(e[0].x,e[0].y,"transparent_32-160"),this.game.physics.arcade.enable(this.nextLevel),this.nextLevel.body.allowGravity=!1,this.nextLevel.y-=110)},_createState:function(){var e;this.levelModule=new Game.Map.Module(this.game,this.levelKey),this.modules={},this.createBackgroundLayers&&"function"==typeof this.createBackgroundLayers&&this.createBackgroundLayers(),this.platform=this.levelModule.createLayer("platform"),this.platform.alpha=0,this.platform.resizeWorld(),this.addNextLevelPortal(),e=this.levelModule.findTextObjects(),this.factReference={},this.addPlayer(),this.addCollectibles(),this.controls=new Game.Controls(this.game,this.player),this.createForegroundLayers&&"function"==typeof this.createForegroundLayers&&this.createForegroundLayers(),e.forEach(function(e){"factoid"===e.properties.type?this.factReference[e.properties.id]=new Game.Map.Object.Factoid(this.game,e):new Game.Map.Object.FloatingText(this.game,e)}.bind(this)),this.setCollisions&&"function"==typeof this.setCollisions&&this.setCollisions(),this.scoreDisplay=new Game.LevelScore(this.game,this.levelKey,this.collectibleItems),this.pauseMenu=new Game.PauseMenu(this.game)},_collectiblesCollisionHandler:function(e,t){var a=null;t._emitter&&(t._emitter.on=!1),a=t,a.x=a.x-this.game.camera.x,a.y=a.y-this.game.camera.y,t.fixedToCamera=!0,a.body.destroy(),this.game.add.tween(a).to({alpha:0},500,"Linear",!0),this.game.add.tween(a.scale).to({x:3,y:3},250,Phaser.Easing.Quadratic.In,!0).chain(this.game.add.tween(a.scale).to({x:1,y:1},250,Phaser.Easing.Quadratic.Out)),this.game.add.tween(a.cameraOffset).to({y:-32},500,Phaser.Easing.Quadratic.InOut,!0),this.game.add.tween(a.cameraOffset).to({x:500},500,Phaser.Easing.Quadratic.InOut,!0).onComplete.add(a.destroy,a),this.collectedItems.push(a),this.itemCollectedHandler&&"function"==typeof this.itemCollectedHandler&&this.itemCollectedHandler(a),this.scoreDisplay.scoreItem(a.properties,this.levelKey),a._revealFactId&&this.factReference[a._revealFactId].reveal()},_nextLevelHandler:function(){var e=this.nextLevelKey;this.game.fadePlugin.fadeOut(0,750,0,function(){this.game.analytics.stateComplete(this.levelKey),Game.Score.allCollected()&&(e="end_screen"),this.game.state.start(e)}.bind(this))},update:function(){this._updateState(),this.updateState&&"function"==typeof this.updateState&&this.updateState()},_updateState:function(){this.parallaxTextGroup&&(this.parallaxTextGroup.x=this.game.world.x*this.TEXT_PARALLAX_SCALE),this.game.physics.arcade.collide(this.player,this.platform),this.game.physics.arcade.overlap(this.player,this.collectibleItems,this._collectiblesCollisionHandler,null,this),this.game.physics.arcade.overlap(this.player,this.nextLevel,this._nextLevelHandler,null,this),this.controls.update()}},Game.State.Decade_2010s=function(){},Game.State.Decade_2010s.prototype=new Game.State.BaseState,Game.State.Decade_2010s.prototype.levelKey="decade_2010s",Game.State.Decade_2010s.prototype.nextLevelKey="navigation",Game.State.Decade_2010s.prototype.setCollisions=function(){this.levelModule.tilemap.setCollisionBetween(834,849),this.levelModule.tilemap.setCollisionBetween(861,882)},Game.State.Decade_50s=function(){},Game.State.Decade_50s.prototype=new Game.State.BaseState,Game.State.Decade_50s.prototype.levelKey="decade_50s",Game.State.Decade_50s.prototype.nextLevelKey="decade_60s",Game.State.Decade_50s.prototype.setCollisions=function(){this.levelModule.tilemap.setCollision(76)},Game.State.Decade_50s.prototype.createBackgroundLayers=function(){this.levelModule.createLayer("background")},Game.State.Decade_50s.prototype.createForegroundLayers=function(){this.levelModule.createLayer("foreground")},Game.State.Decade_60s=function(){},Game.State.Decade_60s.prototype=new Game.State.BaseState,Game.State.Decade_60s.prototype.levelKey="decade_60s",Game.State.Decade_60s.prototype.nextLevelKey="decade_2010s",Game.State.Decade_60s.prototype.setCollisions=function(){this.levelModule.tilemap.setCollision(3)},Game.State.Decade_60s.prototype.createBackgroundLayers=function(){this.levelModule.createLayer("bg_colour"),this.levelModule.createLayer("background")},Game.State.Decade_60s.prototype.createForegroundLayers=function(){this.levelModule.createLayer("foreground")},Game.State.Decade_60s.prototype.updateState=function(){this.parallaxTextGroup.x=this.game.world.x*this.TEXT_PARALLAX_SCALE,this.parallaxTextGroup.y=this.game.world.y*this.TEXT_PARALLAX_SCALE},Game.State.EndScreen=function(){},Game.State.EndScreen.prototype={cursors:null,transitionning:!1,fixedTextOverlays:[{text:"Well done",size:100,x:20,y:20,alpha:.2},{text:"All royal artefacts have been returned!",size:20,x:20,y:120}],create:function(){this.game.analytics.gameCompleted(),this.transitionning=!1,this.createState(),this.game.fadePlugin.fadeIn(0,750,0)},createState:function(){var e=this.game.add.graphics(0,0);e.beginFill(0,1),e.drawRect(this.game.camera.x,this.game.camera.y,1.5*this.game.width,1.5*this.game.height),e.endFill(),this.textGroup=this.game.add.group(),this.textGroup.fixedToCamera=!1,this.textGroup.alpha=1,this.fixedTextOverlays.forEach(function(e){var t=new Phaser.BitmapText(this.game,e.x,e.y,"nokia",e.text,e.size);t.alpha=e.alpha||1,this.textGroup.add(t)}.bind(this)),this.game.add.button(this.game.width-120,this.game.height-50,"next_button",this.nextLevel,this),this.cursors=this.game.input.keyboard.createCursorKeys()},nextLevel:function(){this.transitionning||(this.transitionning=!0,this.game.fadePlugin.fadeOut(0,750,0,function(){this.game.state.start("navigation")}))}},Game.State.Intro_50s=function(){},Game.State.Intro_50s.prototype={cursors:null,transitionning:!1,fixedTextOverlays:[{text:"1950s",size:200,x:20,y:20,alpha:.2},{text:"Post-war Britain started the 1950s hard-up and hurting.\n\nFood rations were in place until 1954, there were unexploded bombs in the\rstreets, and Britain's international standing was shaken by the Suez crisis.\n\nBut by the end of the decade the UK had a new Queen, television sets,\rand rock n'roll.\n\nPrime Minister Harold MacMillan proclaimed 'most of\rour people have never had it so good'.",size:16,x:20,y:20}],create:function(){this.transitionning=!1,this.createState(),this.game.fadePlugin.fadeIn(0,750,0)},createState:function(){var e=this.game.add.graphics(0,0);e.beginFill(0,1),e.drawRect(this.game.camera.x,this.game.camera.y,1.5*this.game.width,1.5*this.game.height),e.endFill(),this.endTextGroup=this.game.add.group(),this.endTextGroup.fixedToCamera=!1,this.endTextGroup.alpha=1,this.fixedTextOverlays.forEach(function(e){var t=new Phaser.Text(this.game,e.x,e.y,e.text,{font:"helvetica",fontSize:e.size,fill:"#ffffff"});t.alpha=e.alpha||1,this.endTextGroup.add(t)}.bind(this)),this.game.add.button(this.game.width-120,this.game.height-50,"next_button",this.nextLevel,this),this.cursors=this.game.input.keyboard.createCursorKeys()},nextLevel:function(){this.transitionning||(this.transitionning=!0,this.game.fadePlugin.fadeOut(0,750,0,function(){this.game.state.start("decade_50s")}))}},Game.State.Intro_AlexsHouse=function(){},Game.State.Intro_AlexsHouse.prototype={cursors:null,transitionning:!1,create:function(){this.transitionning=!1,this.game.add.image(0,0,"alexs_house"),this.game.add.button(this.game.width-120,this.game.height-50,"next_button",this.nextLevel,this),this.game.fadePlugin.fadeIn(0,750,0)},nextLevel:function(){this.transitionning||(this.transitionning=!0,this.game.fadePlugin.fadeOut(0,750,0,function(){this.game.state.start("navigation")}))}},Game.State.Intro_Skynews=function(){},Game.State.Intro_Skynews.prototype={cursors:null,transitionning:!1,create:function(){var e,t,a,s,i;this.game.analytics.stateStarted("intro"),this.transitionning=!1,this.game.stage.backgroundColor="#fff",this.game.add.image(0,0,"kay"),e=this.game.add.image(10,10,"skynews_logo"),t=this.game.add.image(0,300,"intro_ticker"),a=this.game.add.image(568,300,"intro_ticker"),s=this.game.add.group(),s.add(t),s.add(a),i=this.game.add.tween(s).to({x:-568},1e4,"Linear",!0),i.repeat(),this.clock=this.game.add.text(0,300," 00:00 ",{font:"16px Arial",fill:"#fff",backgroundColor:"black",boundsAlignV:"middle"}),this.speechText1=this.game.add.text(10,50,"A dastardly villain has travelled through time and stolen artifacts from the Queen's reign",{font:"16px Arial",fill:"#000",backgroundColor:"white",wordWrap:!0,wordWrapWidth:200}),this.speechText2=this.game.add.text(10,50,"Police are baffled. Won't somebody come forward and help? For our country!",{font:"16px Arial",fill:"#000",backgroundColor:"white",wordWrap:!0,wordWrapWidth:200}),this.speechText2.visible=!1,this.updateClock(),this.game.time.events.loop(Phaser.Timer.SECOND,this.updateClock,this),this.game.add.button(this.game.width-120,this.game.height-50,"next_button",this.nextFrame,this),this.game.fadePlugin.fadeIn(0,750,0)},nextFrame:function(){this.speechText1.visible?(this.speechText2.visible=!0,this.speechText1.visible=!1):this.nextLevel()},updateClock:function(){var e=new Date;this.clock.setText(" "+("0"+e.getHours()).slice(-2)+":"+("0"+e.getMinutes()).slice(-2)+" ")},nextLevel:function(){this.transitionning||(this.transitionning=!0,this.game.fadePlugin.fadeOut(0,750,0,function(){this.game.state.start("intro_alexs_house")}))}},Game.State.Navigation=function(){},Game.State.Navigation.prototype={cursors:null,transitionning:!1,buttonsOriginX:24,buttonsOriginY:24,buttonsMargin:30,buttonsPerRow:3,buttonHeight:48,buttonWidth:48,collectibleSize:10,create:function(){this.game.analytics.stateStarted("navigation"),this.transitionning=!1,this.createState(),this.game.fadePlugin.fadeIn(0,750,0)},createState:function(){var e=this.game.add.graphics(0,0),t=0,a=0;e.beginFill(0,1),e.drawRect(this.game.camera.x,this.game.camera.y,1.5*this.game.width,1.5*this.game.height),e.endFill(),this.buttonsGroup=this.game.add.group(),Game.Levels.forEach(function(e){var s,i,o,n=Game.Score.levelScores[e.stateKey],r=0;i=this.buttonsOriginX+a*(this.buttonWidth+this.buttonsMargin),o=this.buttonsOriginY+t*(this.buttonHeight+this.buttonsMargin),s=this.game.add.button(i,o,e.spriteKey,this.nextLevel,this),s.properties=e,e.collectibles.forEach(function(e){var t,a,s=i+18*r,l=o+this.buttonHeight+10,h=!1,c=6710886;n&&n.scoredItems.forEach(function(t){t.sprite_key===e&&(h=!0)}.bind(this)),"."===e?(h&&(c=16777215),t=this.game.add.graphics(0,0),t.properties={},t.properties.collectibleName=e,t.beginFill(c,1),t.drawRect(s,l,this.collectibleSize,this.collectibleSize),t.endFill()):(h||(e+="_grey"),t=this.game.add.sprite(s,l,e),a=Math.min(this.collectibleSize/t.width,this.collectibleSize/t.height),t.scale.setTo(a,a)),r++}.bind(this)),a+1>=this.buttonsPerRow?(a=0,t++):a++}.bind(this)),this.cursors=this.game.input.keyboard.createCursorKeys()},nextLevel:function(e){this.transitionning||(this.transitionning=!0,this.game.fadePlugin.fadeOut(0,750,0,function(){this.game.state.start(e.properties.stateKey||"tutorial")}))}},Game.State.Preloader=function(){},Game.State.Preloader.prototype={preload:function(){this.stage.backgroundColor="#000000",this.add.sprite(195,138,"crown"),this.textGroup=this.game.add.group(),this.textGroup.fixedToCamera=!0,this.textGroup.add(new Phaser.BitmapText(this.game,this.game.width/2-50,this.game.height/2-15,"pixeltype","Loading...",40)),this.game.load.image("intro_ticker","assets/sprites/intro-ticker.png"),this.game.load.image("skynews_logo","assets/sprites/8bit_sky_logo.png"),this.game.load.image("kay","assets/sprites/kayburley.png"),this.game.load.image("alexs_house","assets/sprites/alexshouse.png"),this.load.spritesheet("player","assets/sprites/alex_character.png",59,69,6),this.load.spritesheet("next_button","assets/sprites/next_button.png",100,30),this.game.load.image("sparkle1","assets/sprites/sparkle1.png"),this.game.load.image("sparkle2","assets/sprites/sparkle2.png"),this.game.load.image("sparkle3","assets/sprites/sparkle3.png"),this.game.load.image("transparent_32-160","assets/sprites/transparent_32-160.png"),this.game.load.image("jewel","assets/sprites/jewel.png"),this.game.load.image("jewel_grey","assets/sprites/jewel_grey.png"),this.game.load.image("corgi","assets/sprites/corgi.png"),this.game.load.image("corgi_grey","assets/sprites/corgi_grey.png"),this.game.load.image("crown_grey","assets/sprites/crown_grey.png"),this.game.load.image("tv","assets/sprites/50s_tv.png"),this.game.load.image("tv_grey","assets/sprites/50s_tv_grey.png"),this.game.load.image("record","assets/sprites/50s_record.png"),this.game.load.image("record_grey","assets/sprites/50s_record_grey.png"),this.game.load.image("mini","assets/sprites/50s_mini.png"),this.game.load.image("mini_grey","assets/sprites/50s_mini_grey.png"),this.game.load.image("beatles","assets/sprites/60s_beatles.png"),this.game.load.image("beatles_grey","assets/sprites/60s_beatles_grey.png"),this.game.load.image("worldcup","assets/sprites/60s_worldcup.png"),this.game.load.image("worldcup_grey","assets/sprites/60s_worldcup_grey.png"),this.game.load.image("the_sun","assets/sprites/60s_the_sun.png"),this.game.load.image("the_sun_grey","assets/sprites/60s_the_sun_grey.png"),this.game.load.image("button_level_50s","assets/sprites/level_buttons/level_50s.png"),this.game.load.image("button_level_60s","assets/sprites/level_buttons/level_60s.png"),this.game.load.image("button_level_70s","assets/sprites/level_buttons/level_70s.png"),this.game.load.image("button_level_80s","assets/sprites/level_buttons/level_80s.png"),this.game.load.image("button_level_90s","assets/sprites/level_buttons/level_90s.png"),this.game.load.image("button_level_00s","assets/sprites/level_buttons/level_00s.png"),this.game.load.image("button_level_10s","assets/sprites/level_buttons/level_10s.png"),this.load.image("compass","assets/sprites/compass_rose.png"),this.load.image("touch_segment","assets/sprites/touch_segment.png"),this.load.image("touch","assets/sprites/touch.png"),this.load.image("pause","assets/sprites/pause.png"),this.load.image("time_machine_button","assets/sprites/time-machine-button.png"),this.load.image("resume_button","assets/sprites/resume-button.png"),this.load.image("restart_level_button","assets/sprites/restart-level-button.png"),this.load.image("share_on_facebook","assets/sprites/share-on-facebook-button.png"),this.load.image("share_on_twitter","assets/sprites/share-on-twitter-button.png"),this.loadTileMaps()},loadTileMaps:function(){var e,t,a={};for(t=0;t<Game.Map.MAPS.length;t++)this.addTileSets(Game.Map.MAPS[t],a);for(e in a)a.hasOwnProperty(e)&&this.load.image(e,a[e])},addTileSets:function(e,t){var a,s,i,o=this.cache.getTilemapData(e).data.tilesets;for(i=0;i<o.length;i++)s=o[i].name,a="assets/maps/"+o[i].image,s in t||(t[s]=a)},create:function(){setTimeout(function(){this.game.fadePlugin.fadeOut(0,750,0,function(){this.game.state.start("intro_skynews")}.bind(this))}.bind(this),500)}},Game.State.Startup=function(){},Game.State.Startup.prototype={preload:function(){this.load.image("crown","assets/sprites/crown.png"),this.load.bitmapFont("nokia","assets/fonts/bitmapFonts/nokia.png","assets/fonts/bitmapFonts/nokia.xml"),this.load.bitmapFont("pixeltype","assets/fonts/bitmapFonts/pixeltype.png","assets/fonts/bitmapFonts/pixeltype.xml");var e,t;for(t=0;t<Game.Map.MAPS.length;t++)e=Game.Map.MAPS[t],this.load.tilemap(e,"assets/maps/"+e+".json",null,Phaser.Tilemap.TILED_JSON)},create:function(){this.game.scale.scaleMode=Phaser.ScaleManager.SHOW_ALL,this.game.fadePlugin=this.game.plugins.add(new Phaser.Plugin.Fade(this)),this.game.physics.startSystem(Phaser.Physics.ARCADE),this.game.state.start("preloader")}},Game.State.Tutorial=function(){},Game.State.Tutorial.prototype=new Game.State.BaseState,Game.State.Tutorial.prototype.levelKey="tutorial",Game.State.Tutorial.prototype.nextLevelKey="decade_50s",Game.State.Tutorial.prototype.setCollisions=function(){this.levelModule.tilemap.setCollisionBetween(76,84)},Game.State.Tutorial.prototype.createForegroundLayers=function(){this.banisterLayer=this.levelModule.createLayer("banisters"),this.columnLayer=this.levelModule.createLayer("columns")};var Game={};Game={},Game.State={},Game.Map={},Game.Map.Object={},Game.Score={nbCollectibles:0,nbCollected:0,levelScores:{},allCollected:function(){return this.nbCollectibles===this.nbCollected}},Game.Map.MAPS=["tutorial","decade_50s","decade_60s","decade_2010s"],Game.Levels=[{text:"50s",stateKey:"decade_50s",spriteKey:"button_level_50s",collectibles:["record","tv","mini"]},{text:"60s",stateKey:"decade_60s",spriteKey:"button_level_60s",collectibles:["beatles","the_sun","worldcup"]},{text:"70s",stateKey:null,spriteKey:"button_level_70s",collectibles:[".",".","."]},{text:"80s",stateKey:"tutorial",spriteKey:"button_level_80s",collectibles:["corgi",".","."]},{text:"90s",stateKey:null,spriteKey:"button_level_90s",collectibles:[".",".","."]},{text:"00s",stateKey:null,spriteKey:"button_level_00s",collectibles:[".",".","."]},{text:"10s",stateKey:"decade_2010s",spriteKey:"button_level_10s",collectibles:["corgi","crown","."]}],Game.init=function(){var e=new Phaser.Game(568,320,Phaser.AUTO,"main",null,!1,!1);this.game=e,e.analytics=Game.Analytics,e.storage=new Game.Storage("skynews-queen-feature-game"),e.state.add("startup",Game.State.Startup),e.state.add("preloader",Game.State.Preloader),e.state.add("intro_skynews",Game.State.Intro_Skynews),e.state.add("intro_alexs_house",Game.State.Intro_AlexsHouse),e.state.add("navigation",Game.State.Navigation),e.state.add("tutorial",Game.State.Tutorial),e.state.add("intro_50s",Game.State.Intro_50s),e.state.add("decade_50s",Game.State.Decade_50s),e.state.add("decade_60s",Game.State.Decade_60s),e.state.add("decade_2010s",Game.State.Decade_2010s),e.state.add("end_screen",Game.State.EndScreen),Game.Levels.forEach(function(e){e.collectibles.forEach(function(e){"."!==e&&this.Score.nbCollectibles++}.bind(this))}.bind(this)),Game.getCollectedItems(),e.state.start("startup")},Game.getCollectedItems=function(){this.Score.nbCollected=0,Game.Levels.forEach(function(e){var t=this.game.storage.get(e.stateKey);t&&t.scoredItems.forEach(function(e){"jewel"!==e.sprite_key&&this.Score.nbCollected++}.bind(this)),Game.Score.levelScores[e.stateKey]=t}.bind(this))},window.onload=function(){Game.init()},Phaser.Plugin.Fade=function(e,t){Phaser.Plugin.call(this,e,t)},Phaser.Plugin.Fade.prototype=Object.create(Phaser.Plugin.prototype),Phaser.Plugin.Fade.prototype.constructor=Phaser.Plugin.SamplePlugin,Phaser.Plugin.Fade.prototype.fadeOut=function(e,t,a,s){this.fade(e,t,a,0,1,s)},Phaser.Plugin.Fade.prototype.fadeIn=function(e,t,a,s){this.fade(e,t,a,1,0,s)},Phaser.Plugin.Fade.prototype.fade=function(e,t,a,s,i,o){a=a||0;var n,r=this.game.add.graphics(0,0);r.beginFill(e,1),r.drawRect(this.game.camera.x,this.game.camera.y,1.5*this.game.world.width,1.5*this.game.world.height),r.alpha=s,r.endFill(),n=this.game.add.tween(r),n.to({alpha:i},t,null),o&&n.onComplete.add(o,this),n.start()},Game.Analytics={stateStarted:function(e){this.sendEvent(["state started",e])},stateComplete:function(e){this.sendEvent(["state completed",e])},itemCollected:function(e){this.sendEvent(["item collected",e])},gameCompleted:function(){this.sendEvent(["game completed"])},sendEvent:function(e){setTimeout(function(){ga("send","event","The Reign Game",e[0],e[1])},1)}};var PLAYER_SPEED=200;Game.Controls=function(e,t){this.game=e,this.player=t,this.moving=!1,this.create()},Game.Controls.prototype.create=function(){this.cursors=this.game.input.keyboard.createCursorKeys()},Game.Controls.prototype.handleDown=function(e){this.moving?this.jump():(e.x<this.game.width/2?this.moveLeft():this.moveRight(),this.moving=!0)},Game.Controls.prototype.handleUp=function(){console.log(this.game.input.totalActivePointers),0===this.game.input.totalActivePointers?(this.player.animations.stop(),this.player.frame=2,this.player.body.velocity.x=0,this.moving=!1):this.handleDown(this.game.input.activePointer)},Game.Controls.prototype.moveLeft=function(){this.player.body.velocity.x=-PLAYER_SPEED,this.player.animations.play("left")},Game.Controls.prototype.moveRight=function(){this.player.body.velocity.x=PLAYER_SPEED,this.player.animations.play("right")},Game.Controls.prototype.jump=function(){this.player.body.onFloor()&&(this.player.body.velocity.y=-300)},Game.Controls.prototype.update=function(){var e=0;this.game.input.pointer1.isDown&&e++,this.game.input.pointer2.isDown&&e++,(this.cursors.up.isDown||e>1)&&this.jump(),1===e&&(this.activePointer=this.game.input.pointer1.isDown?this.game.input.pointer1:this.game.input.pointer2),this.cursors.left.isDown?this.moveLeft():this.cursors.right.isDown?this.moveRight():0===e&&(this.player.body.velocity.x=0,this.activePointer=null),this.activePointer&&(this.activePointer.x<this.game.width/2?this.moveLeft():this.activePointer.x>this.game.width/2&&this.moveRight()),0===this.player.body.velocity.x&&(this.player.animations.stop(),this.player.frame=2)};var FACTOID_TEXT_PADDING=10;Game.Map.Object.Factoid=function(e,t){this.game=e,this.text=new Phaser.Text(e,0,0,t.properties.text,{font:"20px silkscreennormal",wordWrap:!0,wordWrapWidth:32*t.properties.tiles,align:"center"}),this.bg=e.add.sprite(t.x,t.y,this._getBackground()),this.bg.anchor.set(.5,.5),this.text.anchor.set(.5,.5),this.bg.visible=!1,this.bg.addChild(this.text),this.emitter=e.add.emitter(t.x,t.y,100),this.emitter.makeParticles(["sparkle1","sparkle2","sparkle3"]),this.emitter.width=this.text.width,this.emitter.height=this.text.height,this.emitter.minParticleSpeed.setTo(-50,-50),this.emitter.maxParticleSpeed.setTo(50,50),this.emitter.gravity=-600,this.emitter.alpha=.5,this.emitter.minParticleAlpha=.7,this.emitter.maxParticleAlpha=1,this.emitter.minParticleScale=.5,this.emitter.maxParticleScale=1.5,this.emitter.start(!0)},Game.Map.Object.Factoid.prototype.reveal=function(){this.bg.visible=!0,this.bg.scale.x=.5,this.bg.scale.y=.5,this.bg.alpha=0,this.game.add.tween(this.bg.scale).to({x:1},1e3,Phaser.Easing.Bounce.Out,!0),this.game.add.tween(this.bg.scale).to({y:1},750,Phaser.Easing.Bounce.Out,!0),this.game.add.tween(this.bg).to({alpha:1},1e3,Phaser.Easing.Linear.None,!0),this.emitter.explode(1e3,100)},Game.Map.Object.Factoid.prototype._getBackground=function(){var e=this.text.width+5+2*FACTOID_TEXT_PADDING,t=this.text.height+2*FACTOID_TEXT_PADDING,a=this.game.add.bitmapData(e,t);return a.ctx.beginPath(),a.ctx.rect(0,0,e,t),a.ctx.fillStyle="rgba(255,255,255, 0.7)",a.ctx.strokeStyle="rgba(0,0,0,0.6)",a.ctx.lineWidth=5,a.ctx.fill(),a.ctx.stroke(),a},Game.Map.Object.FloatingText=function(e,t){this.game=e,this.text=e.add.text(t.x,t.y,t.properties.text,{font:"20px silkscreennormal",wordWrap:!0,wordWrapWidth:32*t.properties.tiles,align:"center",fill:"#000"}),this.text.anchor.set(.5,.5)},Game.LevelScore=function(e,t,a){this.game=e,this.sprites={},this.scoredItems=[],this.collectedItems=this.game.storage.get(t),this.collectibles=a,this.collectibleSize=16,this.addDisplay()},Game.LevelScore.prototype.addDisplay=function(){var e,t,a,s,i=this.game.width-33,o=!1;this.scoreGroup=this.game.add.group(),this.scoreGroup.fixedToCamera=!0,this.scoreText=new Phaser.BitmapText(this.game,i,7,"nokia","0",20),this.scoreGroup.add(this.scoreText),this.collectibles.forEach(function(n){if("jewel"===n.properties.sprite_key){if(!o){o=!0,i-=32;var r=this.game.add.sprite(i,0,"jewel");this.scoreGroup.add(r),i-=20}}else e=n.properties.sprite_key,this.collectedItems&&this.collectedItems.scoredItems.forEach(function(e){e.sprite_key===n.properties.sprite_key&&(t=!0)}),t||(e+="_grey"),a=this.game.add.sprite(i,7,e),s=Math.min(this.collectibleSize/a.width,this.collectibleSize/a.height),a.scale.setTo(s,s),this.scoreGroup.add(a),this.sprites[n.properties.sprite_key]=a,i-=a.width*s+16}.bind(this))},Game.LevelScore.prototype.scoreItem=function(e,t){this.game.analytics.itemCollected(e.sprite_key);var a=this.sprites[e.sprite_key];a&&a.loadTexture(e.sprite_key),this.scoredItems.push(e),Game.Score.levelScores[t]={scoredItems:this.scoredItems},"jewel"!==e.sprite_key&&Game.Score.nbCollected<Game.Score.nbCollectibles&&Game.Score.nbCollected++,this.game.storage.set(t,{scoredItems:this.scoredItems}),this.updatePoints(this.scoredItems)},Game.LevelScore.prototype.updatePoints=function(e){var t,a=0;e.forEach(function(e){t=e.score,typeof t!==Number&&(t=parseInt(t,10)),a+=t}),this.scoreText&&this.scoreText.setText(a)},Game.Map.Module=function(e,t){this.game=e,this.tilemap=e.add.tilemap(t);for(var a=0;a<this.tilemap.tilesets.length;a++)this.tilemap.addTilesetImage(this.tilemap.tilesets[a].name)},Game.Map.Module.prototype={createLayer:function(){return this.tilemap.createLayer.apply(this.tilemap,arguments)},createLayers:function(){var e,t,a={};for(t=0;t<arguments.length;t++)e=arguments[t],a[e]=this.tilemap.createLayer(e);return a},findTextObjects:function(){var e=this,t=[];return this.tilemap.objects.text&&this.tilemap.objects.text.forEach(function(a){a.y-=e.tilemap.tileHeight,a.properties.text=a.properties.text.replace(/\\n/g,"\n").replace(/\\r/g,"\r"),a.properties.size=a.properties.size||20,t.push(a)}),t},findCollectibleObjects:function(){var e=this,t=[];return this.tilemap.objects.collectibles&&this.tilemap.objects.collectibles.forEach(function(a){a.y-=e.tilemap.tileHeight,t.push(a)}),t},findObjectsByType:function(e){var t=this,a=[];return this.tilemap.objects.objects&&this.tilemap.objects.objects.forEach(function(s){s.type===e&&(s.y-=t.tilemap.tileHeight,a.push(s))}),a},getCollisionSprites:function(e,t,a,s){a=a||0,s=s||0;var i,o=this,n=[];return this.tilemap.objects[e].forEach(function(e){e.y-=o.tilemap.tileHeight,i=t.create(e.x+32*a,e.y+32*s),o.game.physics.arcade.enable(i),i.body.setSize(e.properties.width,e.properties.height),i.body.immovable=!0,n.push(i)}),n},spriteFromObject:function(e,t){var a=t.create(e.x,e.y,e.properties.sprite);return a.properties={},Object.keys(e.properties).forEach(function(t){a.properties[t]=e.properties[t]}),a}},Game.PauseMenu=function(e){this.game=e,this.buttonDefinitions=[{sprite:"time_machine_button",x:40,y:80,callback:"backToNavigation"},{sprite:"resume_button",x:40,y:120,callback:"resume"},{sprite:"restart_level_button",x:40,y:160,callback:"restartLevel"},{sprite:"share_on_facebook",x:40,y:200,callback:"shareOnFacebook"},{sprite:"share_on_twitter",x:40,y:240,callback:"shareOnTwitter"}],this.buttons=[],this.addPauseButton(),this.drawMenu(),this.game.input.onDown.add(this.handleInput,this)},Game.PauseMenu.prototype.addPauseButton=function(){this.pauseButton=this.game.add.button(10,10,"pause",this.showPauseMenu,this),this.pauseButton.fixedToCamera=!0},Game.PauseMenu.prototype.drawMenu=function(){var e,t,a;this.menuGroup=this.game.add.group(),this.menuGroup.visible=!1,a=this.game.add.graphics(0,0),a.fixedToCamera=!0,a.beginFill(0,.8),a.drawRect(this.game.camera.x,this.game.camera.y,this.game.width,this.game.height),a.endFill(),this.menuGroup.add(a),e=new Phaser.Text(this.game,240,40,"Paused",{font:"helvetica",fontSize:18,fill:"#ffffff"}),e.fixedToCamera=!0,this.menuGroup.add(e),this.buttonDefinitions.forEach(function(e){t=new Phaser.Image(this.game,e.x,e.y,e.sprite),t.fixedToCamera=!0,this.menuGroup.add(t),this.buttons.push({x1:t.x,y1:t.y,x2:t.x+t.width,y2:t.y+t.height,callback:e.callback})}.bind(this))},Game.PauseMenu.prototype.handleInput=function(e){this.game.paused&&this.buttons.forEach(function(t){e.x>t.x1&&e.x<t.x2&&e.y>t.y1&&e.y<t.y2&&t.callback&&this[t.callback]()}.bind(this))},Game.PauseMenu.prototype.backToNavigation=function(){this.game.paused=!1,this.game.state.start("navigation")},Game.PauseMenu.prototype.resume=function(){this.game.paused=!1,this.pauseButton.visible=!0,this.menuGroup.visible=!1},Game.PauseMenu.prototype.restartLevel=function(){this.game.paused=!1,this.game.state.start(this.game.state.current)},Game.PauseMenu.prototype.showPauseMenu=function(){this.game.paused=!0,this.pauseButton.visible=!1,this.menuGroup.visible=!0},Game.PauseMenu.prototype.shareOnFacebook=function(){console.log("shared on Facebook")},Game.PauseMenu.prototype.shareOnTwitter=function(){console.log("shared on Twitter")},Game.Storage=function(e){this.storageName=e||"skynews-game",this.read()},Game.Storage.prototype.save=function(){localStorage.setItem(this.storageName,JSON.stringify(this.state))},Game.Storage.prototype.read=function(){this.state=JSON.parse(localStorage.getItem(this.storageName)||"{}")||{}},Game.Storage.prototype.set=function(e,t){this.state[e]=t,this.save()},Game.Storage.prototype.get=function(e){return this.state[e]},Game.State.BaseState=function(){this.levelKey=null,this.controls=null,this.collectibleItems=[],this.collectedItems=[],this.parallaxTextGroup=null,this.fixedTextGroup=null},Game.State.BaseState.prototype={TEXT_PARALLAX_SCALE:1.1,create:function(){this.game.analytics.stateStarted(this.levelKey),this.game.physics.arcade.gravity.y=600,this._createState(),this.game.fadePlugin.fadeIn(0,750,0)},addPlayer:function(){var e=this.levelModule.findObjectsByType("player_spawn");this.player=this.game.add.sprite(e[0].x,e[0].y-32,"player"),this.game.physics.arcade.enable(this.player),this.player.body.collideWorldBounds=!0,this.game.camera.follow(this.player),this.player.animations.add("left",[0,1],5,!0),this.player.animations.add("right",[3,4],5,!0)},addCollectibles:function(){this.collectibleItems=[];var e=this.levelModule.findCollectibleObjects();e.forEach(function(e){var t=this.game.add.sprite(e.x,e.y,e.properties.sprite_key);"jewel"!==e.properties.sprite_key&&(t._isArtefact=!0,t._revealFactId=e.properties.revealFactId,this.addArtefactEmitter(t)),t.properties=e.properties,this.game.physics.arcade.enable(t),t.body.allowGravity=!1,t.anchor=new Phaser.Point(.5,.5),this.collectibleItems.push(t)}.bind(this))},addArtefactEmitter:function(e){var t=this.game.add.emitter(e.x,e.y,10);t.makeParticles(["sparkle1","sparkle2","sparkle3"]),t.minParticleSpeed.setTo(-50,-50),t.maxParticleSpeed.setTo(50,50),t.gravity=-600,t.alpha=.5,t.minParticleAlpha=.7,t.maxParticleAlpha=1,t.minParticleScale=.5,t.maxParticleScale=1.5,t.start(!1,1e3,100),e._emitter=t},addNextLevelPortal:function(){var e=this.levelModule.findObjectsByType("next_level");e.length&&(this.nextLevel=this.game.add.sprite(e[0].x,e[0].y,"transparent_32-160"),this.game.physics.arcade.enable(this.nextLevel),this.nextLevel.body.allowGravity=!1,this.nextLevel.y-=110)},_createState:function(){var e;this.levelModule=new Game.Map.Module(this.game,this.levelKey),this.modules={},this.createBackgroundLayers&&"function"==typeof this.createBackgroundLayers&&this.createBackgroundLayers(),this.platform=this.levelModule.createLayer("platform"),this.platform.alpha=0,this.platform.resizeWorld(),this.addNextLevelPortal(),e=this.levelModule.findTextObjects(),this.factReference={},this.addPlayer(),this.addCollectibles(),this.controls=new Game.Controls(this.game,this.player),this.createForegroundLayers&&"function"==typeof this.createForegroundLayers&&this.createForegroundLayers(),e.forEach(function(e){"factoid"===e.properties.type?this.factReference[e.properties.id]=new Game.Map.Object.Factoid(this.game,e):new Game.Map.Object.FloatingText(this.game,e)}.bind(this)),this.setCollisions&&"function"==typeof this.setCollisions&&this.setCollisions(),this.scoreDisplay=new Game.LevelScore(this.game,this.levelKey,this.collectibleItems),this.pauseMenu=new Game.PauseMenu(this.game)},_collectiblesCollisionHandler:function(e,t){
var a=null;t._emitter&&(t._emitter.on=!1),a=t,a.x=a.x-this.game.camera.x,a.y=a.y-this.game.camera.y,t.fixedToCamera=!0,a.body.destroy(),this.game.add.tween(a).to({alpha:0},500,"Linear",!0),this.game.add.tween(a.scale).to({x:3,y:3},250,Phaser.Easing.Quadratic.In,!0).chain(this.game.add.tween(a.scale).to({x:1,y:1},250,Phaser.Easing.Quadratic.Out)),this.game.add.tween(a.cameraOffset).to({y:-32},500,Phaser.Easing.Quadratic.InOut,!0),this.game.add.tween(a.cameraOffset).to({x:500},500,Phaser.Easing.Quadratic.InOut,!0).onComplete.add(a.destroy,a),this.collectedItems.push(a),this.itemCollectedHandler&&"function"==typeof this.itemCollectedHandler&&this.itemCollectedHandler(a),this.scoreDisplay.scoreItem(a.properties,this.levelKey),a._revealFactId&&this.factReference[a._revealFactId].reveal()},_nextLevelHandler:function(){var e=this.nextLevelKey;this.game.fadePlugin.fadeOut(0,750,0,function(){this.game.analytics.stateComplete(this.levelKey),Game.Score.allCollected()&&(e="end_screen"),this.game.state.start(e)}.bind(this))},update:function(){this._updateState(),this.updateState&&"function"==typeof this.updateState&&this.updateState()},_updateState:function(){this.parallaxTextGroup&&(this.parallaxTextGroup.x=this.game.world.x*this.TEXT_PARALLAX_SCALE),this.game.physics.arcade.collide(this.player,this.platform),this.game.physics.arcade.overlap(this.player,this.collectibleItems,this._collectiblesCollisionHandler,null,this),this.game.physics.arcade.overlap(this.player,this.nextLevel,this._nextLevelHandler,null,this),this.controls.update()}},Game.State.Decade_2010s=function(){},Game.State.Decade_2010s.prototype=new Game.State.BaseState,Game.State.Decade_2010s.prototype.levelKey="decade_2010s",Game.State.Decade_2010s.prototype.nextLevelKey="navigation",Game.State.Decade_2010s.prototype.setCollisions=function(){this.levelModule.tilemap.setCollisionBetween(834,849),this.levelModule.tilemap.setCollisionBetween(861,882)},Game.State.Decade_50s=function(){},Game.State.Decade_50s.prototype=new Game.State.BaseState,Game.State.Decade_50s.prototype.levelKey="decade_50s",Game.State.Decade_50s.prototype.nextLevelKey="decade_60s",Game.State.Decade_50s.prototype.setCollisions=function(){this.levelModule.tilemap.setCollision(76)},Game.State.Decade_50s.prototype.createBackgroundLayers=function(){this.levelModule.createLayer("background")},Game.State.Decade_50s.prototype.createForegroundLayers=function(){this.levelModule.createLayer("foreground")},Game.State.Decade_60s=function(){},Game.State.Decade_60s.prototype=new Game.State.BaseState,Game.State.Decade_60s.prototype.levelKey="decade_60s",Game.State.Decade_60s.prototype.nextLevelKey="decade_2010s",Game.State.Decade_60s.prototype.setCollisions=function(){this.levelModule.tilemap.setCollision(3)},Game.State.Decade_60s.prototype.createBackgroundLayers=function(){this.levelModule.createLayer("bg_colour"),this.levelModule.createLayer("background")},Game.State.Decade_60s.prototype.createForegroundLayers=function(){this.levelModule.createLayer("foreground")},Game.State.Decade_60s.prototype.updateState=function(){this.parallaxTextGroup.x=this.game.world.x*this.TEXT_PARALLAX_SCALE,this.parallaxTextGroup.y=this.game.world.y*this.TEXT_PARALLAX_SCALE},Game.State.EndScreen=function(){},Game.State.EndScreen.prototype={cursors:null,transitionning:!1,fixedTextOverlays:[{text:"Well done",size:100,x:20,y:20,alpha:.2},{text:"All royal artefacts have been returned!",size:20,x:20,y:120}],create:function(){this.game.analytics.gameCompleted(),this.transitionning=!1,this.createState(),this.game.fadePlugin.fadeIn(0,750,0)},createState:function(){var e=this.game.add.graphics(0,0);e.beginFill(0,1),e.drawRect(this.game.camera.x,this.game.camera.y,1.5*this.game.width,1.5*this.game.height),e.endFill(),this.textGroup=this.game.add.group(),this.textGroup.fixedToCamera=!1,this.textGroup.alpha=1,this.fixedTextOverlays.forEach(function(e){var t=new Phaser.BitmapText(this.game,e.x,e.y,"nokia",e.text,e.size);t.alpha=e.alpha||1,this.textGroup.add(t)}.bind(this)),this.game.add.button(this.game.width-120,this.game.height-50,"next_button",this.nextLevel,this),this.cursors=this.game.input.keyboard.createCursorKeys()},nextLevel:function(){this.transitionning||(this.transitionning=!0,this.game.fadePlugin.fadeOut(0,750,0,function(){this.game.state.start("navigation")}))}},Game.State.Intro_50s=function(){},Game.State.Intro_50s.prototype={cursors:null,transitionning:!1,fixedTextOverlays:[{text:"1950s",size:200,x:20,y:20,alpha:.2},{text:"Post-war Britain started the 1950s hard-up and hurting.\n\nFood rations were in place until 1954, there were unexploded bombs in the\rstreets, and Britain's international standing was shaken by the Suez crisis.\n\nBut by the end of the decade the UK had a new Queen, television sets,\rand rock n'roll.\n\nPrime Minister Harold MacMillan proclaimed 'most of\rour people have never had it so good'.",size:16,x:20,y:20}],create:function(){this.transitionning=!1,this.createState(),this.game.fadePlugin.fadeIn(0,750,0)},createState:function(){var e=this.game.add.graphics(0,0);e.beginFill(0,1),e.drawRect(this.game.camera.x,this.game.camera.y,1.5*this.game.width,1.5*this.game.height),e.endFill(),this.endTextGroup=this.game.add.group(),this.endTextGroup.fixedToCamera=!1,this.endTextGroup.alpha=1,this.fixedTextOverlays.forEach(function(e){var t=new Phaser.Text(this.game,e.x,e.y,e.text,{font:"helvetica",fontSize:e.size,fill:"#ffffff"});t.alpha=e.alpha||1,this.endTextGroup.add(t)}.bind(this)),this.game.add.button(this.game.width-120,this.game.height-50,"next_button",this.nextLevel,this),this.cursors=this.game.input.keyboard.createCursorKeys()},nextLevel:function(){this.transitionning||(this.transitionning=!0,this.game.fadePlugin.fadeOut(0,750,0,function(){this.game.state.start("decade_50s")}))}},Game.State.Intro_AlexsHouse=function(){},Game.State.Intro_AlexsHouse.prototype={cursors:null,transitionning:!1,create:function(){this.transitionning=!1,this.game.add.image(0,0,"alexs_house"),this.game.add.button(this.game.width-120,this.game.height-50,"next_button",this.nextLevel,this),this.game.fadePlugin.fadeIn(0,750,0)},nextLevel:function(){this.transitionning||(this.transitionning=!0,this.game.fadePlugin.fadeOut(0,750,0,function(){this.game.state.start("navigation")}))}},Game.State.Intro_Skynews=function(){},Game.State.Intro_Skynews.prototype={cursors:null,transitionning:!1,create:function(){var e,t,a,s,i;this.game.analytics.stateStarted("intro"),this.transitionning=!1,this.game.stage.backgroundColor="#fff",this.game.add.image(0,0,"kay"),e=this.game.add.image(10,10,"skynews_logo"),t=this.game.add.image(0,300,"intro_ticker"),a=this.game.add.image(568,300,"intro_ticker"),s=this.game.add.group(),s.add(t),s.add(a),i=this.game.add.tween(s).to({x:-568},1e4,"Linear",!0),i.repeat(),this.clock=this.game.add.text(0,300," 00:00 ",{font:"16px Arial",fill:"#fff",backgroundColor:"black",boundsAlignV:"middle"}),this.speechText1=this.game.add.text(10,50,"A dastardly villain has travelled through time and stolen artifacts from the Queen's reign",{font:"16px Arial",fill:"#000",backgroundColor:"white",wordWrap:!0,wordWrapWidth:200}),this.speechText2=this.game.add.text(10,50,"Police are baffled. Won't somebody come forward and help? For our country!",{font:"16px Arial",fill:"#000",backgroundColor:"white",wordWrap:!0,wordWrapWidth:200}),this.speechText2.visible=!1,this.updateClock(),this.game.time.events.loop(Phaser.Timer.SECOND,this.updateClock,this),this.game.add.button(this.game.width-120,this.game.height-50,"next_button",this.nextFrame,this),this.game.fadePlugin.fadeIn(0,750,0)},nextFrame:function(){this.speechText1.visible?(this.speechText2.visible=!0,this.speechText1.visible=!1):this.nextLevel()},updateClock:function(){var e=new Date;this.clock.setText(" "+("0"+e.getHours()).slice(-2)+":"+("0"+e.getMinutes()).slice(-2)+" ")},nextLevel:function(){this.transitionning||(this.transitionning=!0,this.game.fadePlugin.fadeOut(0,750,0,function(){this.game.state.start("intro_alexs_house")}))}},Game.State.Navigation=function(){},Game.State.Navigation.prototype={cursors:null,transitionning:!1,buttonsOriginX:24,buttonsOriginY:24,buttonsMargin:30,buttonsPerRow:3,buttonHeight:48,buttonWidth:48,collectibleSize:10,create:function(){this.game.analytics.stateStarted("navigation"),this.transitionning=!1,this.createState(),this.game.fadePlugin.fadeIn(0,750,0)},createState:function(){var e=this.game.add.graphics(0,0),t=0,a=0;e.beginFill(0,1),e.drawRect(this.game.camera.x,this.game.camera.y,1.5*this.game.width,1.5*this.game.height),e.endFill(),this.buttonsGroup=this.game.add.group(),Game.Levels.forEach(function(e){var s,i,o,n=Game.Score.levelScores[e.stateKey],r=0;i=this.buttonsOriginX+a*(this.buttonWidth+this.buttonsMargin),o=this.buttonsOriginY+t*(this.buttonHeight+this.buttonsMargin),s=this.game.add.button(i,o,e.spriteKey,this.nextLevel,this),s.properties=e,e.collectibles.forEach(function(e){var t,a,s=i+18*r,l=o+this.buttonHeight+10,h=!1,c=6710886;n&&n.scoredItems.forEach(function(t){t.sprite_key===e&&(h=!0)}.bind(this)),"."===e?(h&&(c=16777215),t=this.game.add.graphics(0,0),t.properties={},t.properties.collectibleName=e,t.beginFill(c,1),t.drawRect(s,l,this.collectibleSize,this.collectibleSize),t.endFill()):(h||(e+="_grey"),t=this.game.add.sprite(s,l,e),a=Math.min(this.collectibleSize/t.width,this.collectibleSize/t.height),t.scale.setTo(a,a)),r++}.bind(this)),a+1>=this.buttonsPerRow?(a=0,t++):a++}.bind(this)),this.cursors=this.game.input.keyboard.createCursorKeys()},nextLevel:function(e){this.transitionning||(this.transitionning=!0,this.game.fadePlugin.fadeOut(0,750,0,function(){this.game.state.start(e.properties.stateKey||"tutorial")}))}},Game.State.Preloader=function(){},Game.State.Preloader.prototype={preload:function(){this.stage.backgroundColor="#000000",this.add.sprite(195,138,"crown"),this.textGroup=this.game.add.group(),this.textGroup.fixedToCamera=!0,this.textGroup.add(new Phaser.BitmapText(this.game,this.game.width/2-50,this.game.height/2-15,"pixeltype","Loading...",40)),this.game.load.image("intro_ticker","assets/sprites/intro-ticker.png"),this.game.load.image("skynews_logo","assets/sprites/8bit_sky_logo.png"),this.game.load.image("kay","assets/sprites/kayburley.png"),this.game.load.image("alexs_house","assets/sprites/alexshouse.png"),this.load.spritesheet("player","assets/sprites/alex_character.png",59,69,6),this.load.spritesheet("next_button","assets/sprites/next_button.png",100,30),this.game.load.image("sparkle1","assets/sprites/sparkle1.png"),this.game.load.image("sparkle2","assets/sprites/sparkle2.png"),this.game.load.image("sparkle3","assets/sprites/sparkle3.png"),this.game.load.image("transparent_32-160","assets/sprites/transparent_32-160.png"),this.game.load.image("jewel","assets/sprites/jewel.png"),this.game.load.image("jewel_grey","assets/sprites/jewel_grey.png"),this.game.load.image("corgi","assets/sprites/corgi.png"),this.game.load.image("corgi_grey","assets/sprites/corgi_grey.png"),this.game.load.image("crown_grey","assets/sprites/crown_grey.png"),this.game.load.image("tv","assets/sprites/50s_tv.png"),this.game.load.image("tv_grey","assets/sprites/50s_tv_grey.png"),this.game.load.image("record","assets/sprites/50s_record.png"),this.game.load.image("record_grey","assets/sprites/50s_record_grey.png"),this.game.load.image("mini","assets/sprites/50s_mini.png"),this.game.load.image("mini_grey","assets/sprites/50s_mini_grey.png"),this.game.load.image("beatles","assets/sprites/60s_beatles.png"),this.game.load.image("beatles_grey","assets/sprites/60s_beatles_grey.png"),this.game.load.image("worldcup","assets/sprites/60s_worldcup.png"),this.game.load.image("worldcup_grey","assets/sprites/60s_worldcup_grey.png"),this.game.load.image("the_sun","assets/sprites/60s_the_sun.png"),this.game.load.image("the_sun_grey","assets/sprites/60s_the_sun_grey.png"),this.game.load.image("button_level_50s","assets/sprites/level_buttons/level_50s.png"),this.game.load.image("button_level_60s","assets/sprites/level_buttons/level_60s.png"),this.game.load.image("button_level_70s","assets/sprites/level_buttons/level_70s.png"),this.game.load.image("button_level_80s","assets/sprites/level_buttons/level_80s.png"),this.game.load.image("button_level_90s","assets/sprites/level_buttons/level_90s.png"),this.game.load.image("button_level_00s","assets/sprites/level_buttons/level_00s.png"),this.game.load.image("button_level_10s","assets/sprites/level_buttons/level_10s.png"),this.load.image("compass","assets/sprites/compass_rose.png"),this.load.image("touch_segment","assets/sprites/touch_segment.png"),this.load.image("touch","assets/sprites/touch.png"),this.load.image("pause","assets/sprites/pause.png"),this.load.image("time_machine_button","assets/sprites/time-machine-button.png"),this.load.image("resume_button","assets/sprites/resume-button.png"),this.load.image("restart_level_button","assets/sprites/restart-level-button.png"),this.load.image("share_on_facebook","assets/sprites/share-on-facebook-button.png"),this.load.image("share_on_twitter","assets/sprites/share-on-twitter-button.png"),this.loadTileMaps()},loadTileMaps:function(){var e,t,a={};for(t=0;t<Game.Map.MAPS.length;t++)this.addTileSets(Game.Map.MAPS[t],a);for(e in a)a.hasOwnProperty(e)&&this.load.image(e,a[e])},addTileSets:function(e,t){var a,s,i,o=this.cache.getTilemapData(e).data.tilesets;for(i=0;i<o.length;i++)s=o[i].name,a="assets/maps/"+o[i].image,s in t||(t[s]=a)},create:function(){setTimeout(function(){this.game.fadePlugin.fadeOut(0,750,0,function(){this.game.state.start("intro_skynews")}.bind(this))}.bind(this),500)}},Game.State.Startup=function(){},Game.State.Startup.prototype={preload:function(){this.load.image("crown","assets/sprites/crown.png"),this.load.bitmapFont("nokia","assets/fonts/bitmapFonts/nokia.png","assets/fonts/bitmapFonts/nokia.xml"),this.load.bitmapFont("pixeltype","assets/fonts/bitmapFonts/pixeltype.png","assets/fonts/bitmapFonts/pixeltype.xml");var e,t;for(t=0;t<Game.Map.MAPS.length;t++)e=Game.Map.MAPS[t],this.load.tilemap(e,"assets/maps/"+e+".json",null,Phaser.Tilemap.TILED_JSON)},create:function(){this.game.scale.scaleMode=Phaser.ScaleManager.SHOW_ALL,this.game.fadePlugin=this.game.plugins.add(new Phaser.Plugin.Fade(this)),this.game.physics.startSystem(Phaser.Physics.ARCADE),this.game.state.start("preloader")}},Game.State.Tutorial=function(){},Game.State.Tutorial.prototype=new Game.State.BaseState,Game.State.Tutorial.prototype.levelKey="tutorial",Game.State.Tutorial.prototype.nextLevelKey="decade_50s",Game.State.Tutorial.prototype.setCollisions=function(){this.levelModule.tilemap.setCollisionBetween(76,84)},Game.State.Tutorial.prototype.createForegroundLayers=function(){this.banisterLayer=this.levelModule.createLayer("banisters"),this.columnLayer=this.levelModule.createLayer("columns")};var Game={};Game={},Game.State={},Game.Map={},Game.Map.Object={},Game.Score={nbCollectibles:0,nbCollected:0,levelScores:{},allCollected:function(){return this.nbCollectibles===this.nbCollected}},Game.Map.MAPS=["tutorial","decade_50s","decade_60s","decade_2010s"],Game.Levels=[{text:"50s",stateKey:"decade_50s",spriteKey:"button_level_50s",collectibles:["record","tv","mini"]},{text:"60s",stateKey:"decade_60s",spriteKey:"button_level_60s",collectibles:["beatles","the_sun","worldcup"]},{text:"70s",stateKey:null,spriteKey:"button_level_70s",collectibles:[".",".","."]},{text:"80s",stateKey:"tutorial",spriteKey:"button_level_80s",collectibles:["corgi",".","."]},{text:"90s",stateKey:null,spriteKey:"button_level_90s",collectibles:[".",".","."]},{text:"00s",stateKey:null,spriteKey:"button_level_00s",collectibles:[".",".","."]},{text:"10s",stateKey:"decade_2010s",spriteKey:"button_level_10s",collectibles:["corgi","crown","."]}],Game.init=function(){var e=new Phaser.Game(568,320,Phaser.AUTO,"main",null,!1,!1);this.game=e,e.analytics=Game.Analytics,e.storage=new Game.Storage("skynews-queen-feature-game"),e.state.add("startup",Game.State.Startup),e.state.add("preloader",Game.State.Preloader),e.state.add("intro_skynews",Game.State.Intro_Skynews),e.state.add("intro_alexs_house",Game.State.Intro_AlexsHouse),e.state.add("navigation",Game.State.Navigation),e.state.add("tutorial",Game.State.Tutorial),e.state.add("intro_50s",Game.State.Intro_50s),e.state.add("decade_50s",Game.State.Decade_50s),e.state.add("decade_60s",Game.State.Decade_60s),e.state.add("decade_2010s",Game.State.Decade_2010s),e.state.add("end_screen",Game.State.EndScreen),Game.Levels.forEach(function(e){e.collectibles.forEach(function(e){"."!==e&&this.Score.nbCollectibles++}.bind(this))}.bind(this)),Game.getCollectedItems(),e.state.start("startup")},Game.getCollectedItems=function(){this.Score.nbCollected=0,Game.Levels.forEach(function(e){var t=this.game.storage.get(e.stateKey);t&&t.scoredItems.forEach(function(e){"jewel"!==e.sprite_key&&this.Score.nbCollected++}.bind(this)),Game.Score.levelScores[e.stateKey]=t}.bind(this))},window.onload=function(){Game.init()},Phaser.Plugin.Fade=function(e,t){Phaser.Plugin.call(this,e,t)},Phaser.Plugin.Fade.prototype=Object.create(Phaser.Plugin.prototype),Phaser.Plugin.Fade.prototype.constructor=Phaser.Plugin.SamplePlugin,Phaser.Plugin.Fade.prototype.fadeOut=function(e,t,a,s){this.fade(e,t,a,0,1,s)},Phaser.Plugin.Fade.prototype.fadeIn=function(e,t,a,s){this.fade(e,t,a,1,0,s)},Phaser.Plugin.Fade.prototype.fade=function(e,t,a,s,i,o){a=a||0;var n,r=this.game.add.graphics(0,0);r.beginFill(e,1),r.drawRect(this.game.camera.x,this.game.camera.y,1.5*this.game.world.width,1.5*this.game.world.height),r.alpha=s,r.endFill(),n=this.game.add.tween(r),n.to({alpha:i},t,null),o&&n.onComplete.add(o,this),n.start()},Game.Analytics={stateStarted:function(e){this.sendEvent(["state started",e])},stateComplete:function(e){this.sendEvent(["state completed",e])},itemCollected:function(e){this.sendEvent(["item collected",e])},gameCompleted:function(){this.sendEvent(["game completed"])},sendEvent:function(e){setTimeout(function(){ga("send","event","The Reign Game",e[0],e[1])},1)}};var PLAYER_SPEED=200;Game.Controls=function(e,t){this.game=e,this.player=t,this.moving=!1,this.create()},Game.Controls.prototype.create=function(){this.cursors=this.game.input.keyboard.createCursorKeys()},Game.Controls.prototype.handleDown=function(e){this.moving?this.jump():(e.x<this.game.width/2?this.moveLeft():this.moveRight(),this.moving=!0)},Game.Controls.prototype.handleUp=function(){console.log(this.game.input.totalActivePointers),0===this.game.input.totalActivePointers?(this.player.animations.stop(),this.player.frame=2,this.player.body.velocity.x=0,this.moving=!1):this.handleDown(this.game.input.activePointer)},Game.Controls.prototype.moveLeft=function(){this.player.body.velocity.x=-PLAYER_SPEED,this.player.animations.play("left")},Game.Controls.prototype.moveRight=function(){this.player.body.velocity.x=PLAYER_SPEED,this.player.animations.play("right")},Game.Controls.prototype.jump=function(){this.player.body.onFloor()&&(this.player.body.velocity.y=-300)},Game.Controls.prototype.update=function(){var e=0;this.game.input.pointer1.isDown&&e++,this.game.input.pointer2.isDown&&e++,(this.cursors.up.isDown||e>1)&&this.jump(),1===e&&(this.activePointer=this.game.input.pointer1.isDown?this.game.input.pointer1:this.game.input.pointer2),this.cursors.left.isDown?this.moveLeft():this.cursors.right.isDown?this.moveRight():0===e&&(this.player.body.velocity.x=0,this.activePointer=null),this.activePointer&&(this.activePointer.x<this.game.width/2?this.moveLeft():this.activePointer.x>this.game.width/2&&this.moveRight()),0===this.player.body.velocity.x&&(this.player.animations.stop(),this.player.frame=2)};var FACTOID_TEXT_PADDING=10;Game.Map.Object.Factoid=function(e,t){this.game=e,this.text=new Phaser.Text(e,0,0,t.properties.text,{font:"20px silkscreennormal",wordWrap:!0,wordWrapWidth:32*t.properties.tiles,align:"center"}),this.bg=e.add.sprite(t.x,t.y,this._getBackground()),this.bg.anchor.set(.5,.5),this.text.anchor.set(.5,.5),this.bg.visible=!1,this.bg.addChild(this.text),this.emitter=e.add.emitter(t.x,t.y,100),this.emitter.makeParticles(["sparkle1","sparkle2","sparkle3"]),this.emitter.width=this.text.width,this.emitter.height=this.text.height,this.emitter.minParticleSpeed.setTo(-50,-50),this.emitter.maxParticleSpeed.setTo(50,50),this.emitter.gravity=-600,this.emitter.alpha=.5,this.emitter.minParticleAlpha=.7,this.emitter.maxParticleAlpha=1,this.emitter.minParticleScale=.5,this.emitter.maxParticleScale=1.5,this.emitter.start(!0)},Game.Map.Object.Factoid.prototype.reveal=function(){this.bg.visible=!0,this.bg.scale.x=.5,this.bg.scale.y=.5,this.bg.alpha=0,this.game.add.tween(this.bg.scale).to({x:1},1e3,Phaser.Easing.Bounce.Out,!0),this.game.add.tween(this.bg.scale).to({y:1},750,Phaser.Easing.Bounce.Out,!0),this.game.add.tween(this.bg).to({alpha:1},1e3,Phaser.Easing.Linear.None,!0),this.emitter.explode(1e3,100)},Game.Map.Object.Factoid.prototype._getBackground=function(){var e=this.text.width+5+2*FACTOID_TEXT_PADDING,t=this.text.height+2*FACTOID_TEXT_PADDING,a=this.game.add.bitmapData(e,t);return a.ctx.beginPath(),a.ctx.rect(0,0,e,t),a.ctx.fillStyle="rgba(255,255,255, 0.7)",a.ctx.strokeStyle="rgba(0,0,0,0.6)",a.ctx.lineWidth=5,a.ctx.fill(),a.ctx.stroke(),a},Game.Map.Object.FloatingText=function(e,t){this.game=e,this.text=e.add.text(t.x,t.y,t.properties.text,{font:"20px silkscreennormal",wordWrap:!0,wordWrapWidth:32*t.properties.tiles,align:"center",fill:"#000"}),this.text.anchor.set(.5,.5)},Game.LevelScore=function(e,t,a){this.game=e,this.sprites={},this.scoredItems=[],this.collectedItems=this.game.storage.get(t),this.collectibles=a,this.collectibleSize=16,this.addDisplay()},Game.LevelScore.prototype.addDisplay=function(){var e,t,a,s,i=this.game.width-33,o=!1;this.scoreGroup=this.game.add.group(),this.scoreGroup.fixedToCamera=!0,this.scoreText=new Phaser.BitmapText(this.game,i,7,"nokia","0",20),this.scoreGroup.add(this.scoreText),this.collectibles.forEach(function(n){if("jewel"===n.properties.sprite_key){if(!o){o=!0,i-=32;var r=this.game.add.sprite(i,0,"jewel");this.scoreGroup.add(r),i-=20}}else e=n.properties.sprite_key,this.collectedItems&&this.collectedItems.scoredItems.forEach(function(e){e.sprite_key===n.properties.sprite_key&&(t=!0)}),t||(e+="_grey"),a=this.game.add.sprite(i,7,e),s=Math.min(this.collectibleSize/a.width,this.collectibleSize/a.height),a.scale.setTo(s,s),this.scoreGroup.add(a),this.sprites[n.properties.sprite_key]=a,i-=a.width*s+16}.bind(this))},Game.LevelScore.prototype.scoreItem=function(e,t){this.game.analytics.itemCollected(e.sprite_key);var a=this.sprites[e.sprite_key];a&&a.loadTexture(e.sprite_key),this.scoredItems.push(e),Game.Score.levelScores[t]={scoredItems:this.scoredItems},"jewel"!==e.sprite_key&&Game.Score.nbCollected<Game.Score.nbCollectibles&&Game.Score.nbCollected++,this.game.storage.set(t,{scoredItems:this.scoredItems}),this.updatePoints(this.scoredItems)},Game.LevelScore.prototype.updatePoints=function(e){var t,a=0;e.forEach(function(e){t=e.score,typeof t!==Number&&(t=parseInt(t,10)),a+=t}),this.scoreText&&this.scoreText.setText(a)},Game.Map.Module=function(e,t){this.game=e,this.tilemap=e.add.tilemap(t);for(var a=0;a<this.tilemap.tilesets.length;a++)this.tilemap.addTilesetImage(this.tilemap.tilesets[a].name)},Game.Map.Module.prototype={createLayer:function(){return this.tilemap.createLayer.apply(this.tilemap,arguments)},createLayers:function(){var e,t,a={};for(t=0;t<arguments.length;t++)e=arguments[t],a[e]=this.tilemap.createLayer(e);return a},findTextObjects:function(){var e=this,t=[];return this.tilemap.objects.text&&this.tilemap.objects.text.forEach(function(a){a.y-=e.tilemap.tileHeight,a.properties.text=a.properties.text.replace(/\\n/g,"\n").replace(/\\r/g,"\r"),a.properties.size=a.properties.size||20,t.push(a)}),t},findCollectibleObjects:function(){var e=this,t=[];return this.tilemap.objects.collectibles&&this.tilemap.objects.collectibles.forEach(function(a){a.y-=e.tilemap.tileHeight,t.push(a)}),t},findObjectsByType:function(e){var t=this,a=[];return this.tilemap.objects.objects&&this.tilemap.objects.objects.forEach(function(s){s.type===e&&(s.y-=t.tilemap.tileHeight,a.push(s))}),a},getCollisionSprites:function(e,t,a,s){a=a||0,s=s||0;var i,o=this,n=[];return this.tilemap.objects[e].forEach(function(e){e.y-=o.tilemap.tileHeight,i=t.create(e.x+32*a,e.y+32*s),o.game.physics.arcade.enable(i),i.body.setSize(e.properties.width,e.properties.height),i.body.immovable=!0,n.push(i)}),n},spriteFromObject:function(e,t){var a=t.create(e.x,e.y,e.properties.sprite);return a.properties={},Object.keys(e.properties).forEach(function(t){a.properties[t]=e.properties[t]}),a}},Game.PauseMenu=function(e){this.game=e,this.buttonDefinitions=[{sprite:"time_machine_button",x:40,y:80,callback:"backToNavigation"},{sprite:"resume_button",x:40,y:120,callback:"resume"},{sprite:"restart_level_button",x:40,y:160,callback:"restartLevel"},{sprite:"share_on_facebook",x:40,y:200,callback:"shareOnFacebook"},{sprite:"share_on_twitter",x:40,y:240,callback:"shareOnTwitter"}],this.buttons=[],this.addPauseButton(),this.drawMenu(),this.game.input.onDown.add(this.handleInput,this)},Game.PauseMenu.prototype.addPauseButton=function(){this.pauseButton=this.game.add.button(10,10,"pause",this.showPauseMenu,this),this.pauseButton.fixedToCamera=!0},Game.PauseMenu.prototype.drawMenu=function(){var e,t,a;this.menuGroup=this.game.add.group(),this.menuGroup.visible=!1,a=this.game.add.graphics(0,0),a.fixedToCamera=!0,a.beginFill(0,.8),a.drawRect(this.game.camera.x,this.game.camera.y,this.game.width,this.game.height),a.endFill(),this.menuGroup.add(a),e=new Phaser.Text(this.game,240,40,"Paused",{font:"helvetica",fontSize:18,fill:"#ffffff"}),e.fixedToCamera=!0,this.menuGroup.add(e),this.buttonDefinitions.forEach(function(e){t=new Phaser.Image(this.game,e.x,e.y,e.sprite),t.fixedToCamera=!0,this.menuGroup.add(t),this.buttons.push({x1:t.x,y1:t.y,x2:t.x+t.width,y2:t.y+t.height,callback:e.callback})}.bind(this))},Game.PauseMenu.prototype.handleInput=function(e){this.game.paused&&this.buttons.forEach(function(t){e.x>t.x1&&e.x<t.x2&&e.y>t.y1&&e.y<t.y2&&t.callback&&this[t.callback]()}.bind(this))},Game.PauseMenu.prototype.backToNavigation=function(){this.game.paused=!1,this.game.state.start("navigation")},Game.PauseMenu.prototype.resume=function(){this.game.paused=!1,this.pauseButton.visible=!0,this.menuGroup.visible=!1},Game.PauseMenu.prototype.restartLevel=function(){this.game.paused=!1,this.game.state.start(this.game.state.current)},Game.PauseMenu.prototype.showPauseMenu=function(){this.game.paused=!0,this.pauseButton.visible=!1,this.menuGroup.visible=!0},Game.PauseMenu.prototype.shareOnFacebook=function(){console.log("shared on Facebook")},Game.PauseMenu.prototype.shareOnTwitter=function(){console.log("shared on Twitter")},Game.Storage=function(e){this.storageName=e||"skynews-game",this.read()},Game.Storage.prototype.save=function(){localStorage.setItem(this.storageName,JSON.stringify(this.state))},Game.Storage.prototype.read=function(){this.state=JSON.parse(localStorage.getItem(this.storageName)||"{}")||{}},Game.Storage.prototype.set=function(e,t){this.state[e]=t,this.save()},Game.Storage.prototype.get=function(e){return this.state[e]},Game.State.BaseState=function(){this.levelKey=null,this.controls=null,this.collectibleItems=[],this.collectedItems=[],this.parallaxTextGroup=null,this.fixedTextGroup=null},Game.State.BaseState.prototype={TEXT_PARALLAX_SCALE:1.1,create:function(){this.game.analytics.stateStarted(this.levelKey),this.game.physics.arcade.gravity.y=600,this._createState(),this.game.fadePlugin.fadeIn(0,750,0)},addPlayer:function(){var e=this.levelModule.findObjectsByType("player_spawn");this.player=this.game.add.sprite(e[0].x,e[0].y-32,"player"),this.game.physics.arcade.enable(this.player),this.player.body.collideWorldBounds=!0,this.game.camera.follow(this.player),this.player.animations.add("left",[0,1],5,!0),this.player.animations.add("right",[3,4],5,!0)},addCollectibles:function(){this.collectibleItems=[];var e=this.levelModule.findCollectibleObjects();e.forEach(function(e){var t=this.game.add.sprite(e.x,e.y,e.properties.sprite_key);"jewel"!==e.properties.sprite_key&&(t._isArtefact=!0,t._revealFactId=e.properties.revealFactId,this.addArtefactEmitter(t)),t.properties=e.properties,this.game.physics.arcade.enable(t),t.body.allowGravity=!1,t.anchor=new Phaser.Point(.5,.5),this.collectibleItems.push(t)}.bind(this))},addArtefactEmitter:function(e){var t=this.game.add.emitter(e.x,e.y,10);t.makeParticles(["sparkle1","sparkle2","sparkle3"]),t.minParticleSpeed.setTo(-50,-50),t.maxParticleSpeed.setTo(50,50),t.gravity=-600,t.alpha=.5,t.minParticleAlpha=.7,t.maxParticleAlpha=1,t.minParticleScale=.5,t.maxParticleScale=1.5,t.start(!1,1e3,100),e._emitter=t},addNextLevelPortal:function(){var e=this.levelModule.findObjectsByType("next_level");e.length&&(this.nextLevel=this.game.add.sprite(e[0].x,e[0].y,"transparent_32-160"),this.game.physics.arcade.enable(this.nextLevel),this.nextLevel.body.allowGravity=!1,this.nextLevel.y-=110)},_createState:function(){var e;this.levelModule=new Game.Map.Module(this.game,this.levelKey),this.modules={},this.createBackgroundLayers&&"function"==typeof this.createBackgroundLayers&&this.createBackgroundLayers(),this.platform=this.levelModule.createLayer("platform"),this.platform.alpha=0,this.platform.resizeWorld(),this.addNextLevelPortal(),e=this.levelModule.findTextObjects(),this.factReference={},this.addPlayer(),this.addCollectibles(),this.controls=new Game.Controls(this.game,this.player),this.createForegroundLayers&&"function"==typeof this.createForegroundLayers&&this.createForegroundLayers(),e.forEach(function(e){"factoid"===e.properties.type?this.factReference[e.properties.id]=new Game.Map.Object.Factoid(this.game,e):new Game.Map.Object.FloatingText(this.game,e)}.bind(this)),this.setCollisions&&"function"==typeof this.setCollisions&&this.setCollisions(),this.scoreDisplay=new Game.LevelScore(this.game,this.levelKey,this.collectibleItems),this.pauseMenu=new Game.PauseMenu(this.game)},_collectiblesCollisionHandler:function(e,t){var a=null;t._emitter&&(t._emitter.on=!1),a=t,a.x=a.x-this.game.camera.x,a.y=a.y-this.game.camera.y,t.fixedToCamera=!0,a.body.destroy(),this.game.add.tween(a).to({alpha:0},500,"Linear",!0),this.game.add.tween(a.scale).to({x:3,y:3},250,Phaser.Easing.Quadratic.In,!0).chain(this.game.add.tween(a.scale).to({x:1,y:1},250,Phaser.Easing.Quadratic.Out)),this.game.add.tween(a.cameraOffset).to({y:-32},500,Phaser.Easing.Quadratic.InOut,!0),this.game.add.tween(a.cameraOffset).to({x:500},500,Phaser.Easing.Quadratic.InOut,!0).onComplete.add(a.destroy,a),this.collectedItems.push(a),this.itemCollectedHandler&&"function"==typeof this.itemCollectedHandler&&this.itemCollectedHandler(a),this.scoreDisplay.scoreItem(a.properties,this.levelKey),a._revealFactId&&this.factReference[a._revealFactId].reveal()},_nextLevelHandler:function(){var e=this.nextLevelKey;this.game.fadePlugin.fadeOut(0,750,0,function(){this.game.analytics.stateComplete(this.levelKey),Game.Score.allCollected()&&(e="end_screen"),this.game.state.start(e)}.bind(this))},update:function(){this._updateState(),this.updateState&&"function"==typeof this.updateState&&this.updateState()},_updateState:function(){this.parallaxTextGroup&&(this.parallaxTextGroup.x=this.game.world.x*this.TEXT_PARALLAX_SCALE),this.game.physics.arcade.collide(this.player,this.platform),this.game.physics.arcade.overlap(this.player,this.collectibleItems,this._collectiblesCollisionHandler,null,this),this.game.physics.arcade.overlap(this.player,this.nextLevel,this._nextLevelHandler,null,this),this.controls.update()}},Game.State.Decade_2010s=function(){},Game.State.Decade_2010s.prototype=new Game.State.BaseState,Game.State.Decade_2010s.prototype.levelKey="decade_2010s",Game.State.Decade_2010s.prototype.nextLevelKey="navigation",Game.State.Decade_2010s.prototype.setCollisions=function(){this.levelModule.tilemap.setCollisionBetween(834,849),this.levelModule.tilemap.setCollisionBetween(861,882)},Game.State.Decade_50s=function(){},Game.State.Decade_50s.prototype=new Game.State.BaseState,
Game.State.Decade_50s.prototype.levelKey="decade_50s",Game.State.Decade_50s.prototype.nextLevelKey="decade_60s",Game.State.Decade_50s.prototype.setCollisions=function(){this.levelModule.tilemap.setCollision(76)},Game.State.Decade_50s.prototype.createBackgroundLayers=function(){this.levelModule.createLayer("background")},Game.State.Decade_50s.prototype.createForegroundLayers=function(){this.levelModule.createLayer("foreground")},Game.State.Decade_60s=function(){},Game.State.Decade_60s.prototype=new Game.State.BaseState,Game.State.Decade_60s.prototype.levelKey="decade_60s",Game.State.Decade_60s.prototype.nextLevelKey="decade_2010s",Game.State.Decade_60s.prototype.setCollisions=function(){this.levelModule.tilemap.setCollision(3)},Game.State.Decade_60s.prototype.createBackgroundLayers=function(){this.levelModule.createLayer("bg_colour"),this.levelModule.createLayer("background")},Game.State.Decade_60s.prototype.createForegroundLayers=function(){this.levelModule.createLayer("foreground")},Game.State.Decade_60s.prototype.updateState=function(){this.parallaxTextGroup.x=this.game.world.x*this.TEXT_PARALLAX_SCALE,this.parallaxTextGroup.y=this.game.world.y*this.TEXT_PARALLAX_SCALE},Game.State.EndScreen=function(){},Game.State.EndScreen.prototype={cursors:null,transitionning:!1,fixedTextOverlays:[{text:"Well done",size:100,x:20,y:20,alpha:.2},{text:"All royal artefacts have been returned!",size:20,x:20,y:120}],create:function(){this.game.analytics.gameCompleted(),this.transitionning=!1,this.createState(),this.game.fadePlugin.fadeIn(0,750,0)},createState:function(){var e=this.game.add.graphics(0,0);e.beginFill(0,1),e.drawRect(this.game.camera.x,this.game.camera.y,1.5*this.game.width,1.5*this.game.height),e.endFill(),this.textGroup=this.game.add.group(),this.textGroup.fixedToCamera=!1,this.textGroup.alpha=1,this.fixedTextOverlays.forEach(function(e){var t=new Phaser.BitmapText(this.game,e.x,e.y,"nokia",e.text,e.size);t.alpha=e.alpha||1,this.textGroup.add(t)}.bind(this)),this.game.add.button(this.game.width-120,this.game.height-50,"next_button",this.nextLevel,this),this.cursors=this.game.input.keyboard.createCursorKeys()},nextLevel:function(){this.transitionning||(this.transitionning=!0,this.game.fadePlugin.fadeOut(0,750,0,function(){this.game.state.start("navigation")}))}},Game.State.Intro_50s=function(){},Game.State.Intro_50s.prototype={cursors:null,transitionning:!1,fixedTextOverlays:[{text:"1950s",size:200,x:20,y:20,alpha:.2},{text:"Post-war Britain started the 1950s hard-up and hurting.\n\nFood rations were in place until 1954, there were unexploded bombs in the\rstreets, and Britain's international standing was shaken by the Suez crisis.\n\nBut by the end of the decade the UK had a new Queen, television sets,\rand rock n'roll.\n\nPrime Minister Harold MacMillan proclaimed 'most of\rour people have never had it so good'.",size:16,x:20,y:20}],create:function(){this.transitionning=!1,this.createState(),this.game.fadePlugin.fadeIn(0,750,0)},createState:function(){var e=this.game.add.graphics(0,0);e.beginFill(0,1),e.drawRect(this.game.camera.x,this.game.camera.y,1.5*this.game.width,1.5*this.game.height),e.endFill(),this.endTextGroup=this.game.add.group(),this.endTextGroup.fixedToCamera=!1,this.endTextGroup.alpha=1,this.fixedTextOverlays.forEach(function(e){var t=new Phaser.Text(this.game,e.x,e.y,e.text,{font:"helvetica",fontSize:e.size,fill:"#ffffff"});t.alpha=e.alpha||1,this.endTextGroup.add(t)}.bind(this)),this.game.add.button(this.game.width-120,this.game.height-50,"next_button",this.nextLevel,this),this.cursors=this.game.input.keyboard.createCursorKeys()},nextLevel:function(){this.transitionning||(this.transitionning=!0,this.game.fadePlugin.fadeOut(0,750,0,function(){this.game.state.start("decade_50s")}))}},Game.State.Intro_AlexsHouse=function(){},Game.State.Intro_AlexsHouse.prototype={cursors:null,transitionning:!1,create:function(){this.transitionning=!1,this.game.add.image(0,0,"alexs_house"),this.game.add.button(this.game.width-120,this.game.height-50,"next_button",this.nextLevel,this),this.game.fadePlugin.fadeIn(0,750,0)},nextLevel:function(){this.transitionning||(this.transitionning=!0,this.game.fadePlugin.fadeOut(0,750,0,function(){this.game.state.start("navigation")}))}},Game.State.Intro_Skynews=function(){},Game.State.Intro_Skynews.prototype={cursors:null,transitionning:!1,create:function(){var e,t,a,s,i;this.game.analytics.stateStarted("intro"),this.transitionning=!1,this.game.stage.backgroundColor="#fff",this.game.add.image(0,0,"kay"),e=this.game.add.image(10,10,"skynews_logo"),t=this.game.add.image(0,300,"intro_ticker"),a=this.game.add.image(568,300,"intro_ticker"),s=this.game.add.group(),s.add(t),s.add(a),i=this.game.add.tween(s).to({x:-568},1e4,"Linear",!0),i.repeat(),this.clock=this.game.add.text(0,300," 00:00 ",{font:"16px Arial",fill:"#fff",backgroundColor:"black",boundsAlignV:"middle"}),this.speechText1=this.game.add.text(10,50,"A dastardly villain has travelled through time and stolen artifacts from the Queen's reign",{font:"16px Arial",fill:"#000",backgroundColor:"white",wordWrap:!0,wordWrapWidth:200}),this.speechText2=this.game.add.text(10,50,"Police are baffled. Won't somebody come forward and help? For our country!",{font:"16px Arial",fill:"#000",backgroundColor:"white",wordWrap:!0,wordWrapWidth:200}),this.speechText2.visible=!1,this.updateClock(),this.game.time.events.loop(Phaser.Timer.SECOND,this.updateClock,this),this.game.add.button(this.game.width-120,this.game.height-50,"next_button",this.nextFrame,this),this.game.fadePlugin.fadeIn(0,750,0)},nextFrame:function(){this.speechText1.visible?(this.speechText2.visible=!0,this.speechText1.visible=!1):this.nextLevel()},updateClock:function(){var e=new Date;this.clock.setText(" "+("0"+e.getHours()).slice(-2)+":"+("0"+e.getMinutes()).slice(-2)+" ")},nextLevel:function(){this.transitionning||(this.transitionning=!0,this.game.fadePlugin.fadeOut(0,750,0,function(){this.game.state.start("intro_alexs_house")}))}},Game.State.Navigation=function(){},Game.State.Navigation.prototype={cursors:null,transitionning:!1,buttonsOriginX:24,buttonsOriginY:24,buttonsMargin:30,buttonsPerRow:3,buttonHeight:48,buttonWidth:48,collectibleSize:10,create:function(){this.game.analytics.stateStarted("navigation"),this.transitionning=!1,this.createState(),this.game.fadePlugin.fadeIn(0,750,0)},createState:function(){var e=this.game.add.graphics(0,0),t=0,a=0;e.beginFill(0,1),e.drawRect(this.game.camera.x,this.game.camera.y,1.5*this.game.width,1.5*this.game.height),e.endFill(),this.buttonsGroup=this.game.add.group(),Game.Levels.forEach(function(e){var s,i,o,n=Game.Score.levelScores[e.stateKey],r=0;i=this.buttonsOriginX+a*(this.buttonWidth+this.buttonsMargin),o=this.buttonsOriginY+t*(this.buttonHeight+this.buttonsMargin),s=this.game.add.button(i,o,e.spriteKey,this.nextLevel,this),s.properties=e,e.collectibles.forEach(function(e){var t,a,s=i+18*r,l=o+this.buttonHeight+10,h=!1,c=6710886;n&&n.scoredItems.forEach(function(t){t.sprite_key===e&&(h=!0)}.bind(this)),"."===e?(h&&(c=16777215),t=this.game.add.graphics(0,0),t.properties={},t.properties.collectibleName=e,t.beginFill(c,1),t.drawRect(s,l,this.collectibleSize,this.collectibleSize),t.endFill()):(h||(e+="_grey"),t=this.game.add.sprite(s,l,e),a=Math.min(this.collectibleSize/t.width,this.collectibleSize/t.height),t.scale.setTo(a,a)),r++}.bind(this)),a+1>=this.buttonsPerRow?(a=0,t++):a++}.bind(this)),this.cursors=this.game.input.keyboard.createCursorKeys()},nextLevel:function(e){this.transitionning||(this.transitionning=!0,this.game.fadePlugin.fadeOut(0,750,0,function(){this.game.state.start(e.properties.stateKey||"tutorial")}))}},Game.State.Preloader=function(){},Game.State.Preloader.prototype={preload:function(){this.stage.backgroundColor="#000000",this.add.sprite(195,138,"crown"),this.textGroup=this.game.add.group(),this.textGroup.fixedToCamera=!0,this.textGroup.add(new Phaser.BitmapText(this.game,this.game.width/2-50,this.game.height/2-15,"pixeltype","Loading...",40)),this.game.load.image("intro_ticker","assets/sprites/intro-ticker.png"),this.game.load.image("skynews_logo","assets/sprites/8bit_sky_logo.png"),this.game.load.image("kay","assets/sprites/kayburley.png"),this.game.load.image("alexs_house","assets/sprites/alexshouse.png"),this.load.spritesheet("player","assets/sprites/alex_character.png",59,69,6),this.load.spritesheet("next_button","assets/sprites/next_button.png",100,30),this.game.load.image("sparkle1","assets/sprites/sparkle1.png"),this.game.load.image("sparkle2","assets/sprites/sparkle2.png"),this.game.load.image("sparkle3","assets/sprites/sparkle3.png"),this.game.load.image("transparent_32-160","assets/sprites/transparent_32-160.png"),this.game.load.image("jewel","assets/sprites/jewel.png"),this.game.load.image("jewel_grey","assets/sprites/jewel_grey.png"),this.game.load.image("corgi","assets/sprites/corgi.png"),this.game.load.image("corgi_grey","assets/sprites/corgi_grey.png"),this.game.load.image("crown_grey","assets/sprites/crown_grey.png"),this.game.load.image("tv","assets/sprites/50s_tv.png"),this.game.load.image("tv_grey","assets/sprites/50s_tv_grey.png"),this.game.load.image("record","assets/sprites/50s_record.png"),this.game.load.image("record_grey","assets/sprites/50s_record_grey.png"),this.game.load.image("mini","assets/sprites/50s_mini.png"),this.game.load.image("mini_grey","assets/sprites/50s_mini_grey.png"),this.game.load.image("beatles","assets/sprites/60s_beatles.png"),this.game.load.image("beatles_grey","assets/sprites/60s_beatles_grey.png"),this.game.load.image("worldcup","assets/sprites/60s_worldcup.png"),this.game.load.image("worldcup_grey","assets/sprites/60s_worldcup_grey.png"),this.game.load.image("the_sun","assets/sprites/60s_the_sun.png"),this.game.load.image("the_sun_grey","assets/sprites/60s_the_sun_grey.png"),this.game.load.image("button_level_50s","assets/sprites/level_buttons/level_50s.png"),this.game.load.image("button_level_60s","assets/sprites/level_buttons/level_60s.png"),this.game.load.image("button_level_70s","assets/sprites/level_buttons/level_70s.png"),this.game.load.image("button_level_80s","assets/sprites/level_buttons/level_80s.png"),this.game.load.image("button_level_90s","assets/sprites/level_buttons/level_90s.png"),this.game.load.image("button_level_00s","assets/sprites/level_buttons/level_00s.png"),this.game.load.image("button_level_10s","assets/sprites/level_buttons/level_10s.png"),this.load.image("compass","assets/sprites/compass_rose.png"),this.load.image("touch_segment","assets/sprites/touch_segment.png"),this.load.image("touch","assets/sprites/touch.png"),this.load.image("pause","assets/sprites/pause.png"),this.load.image("time_machine_button","assets/sprites/time-machine-button.png"),this.load.image("resume_button","assets/sprites/resume-button.png"),this.load.image("restart_level_button","assets/sprites/restart-level-button.png"),this.load.image("share_on_facebook","assets/sprites/share-on-facebook-button.png"),this.load.image("share_on_twitter","assets/sprites/share-on-twitter-button.png"),this.loadTileMaps()},loadTileMaps:function(){var e,t,a={};for(t=0;t<Game.Map.MAPS.length;t++)this.addTileSets(Game.Map.MAPS[t],a);for(e in a)a.hasOwnProperty(e)&&this.load.image(e,a[e])},addTileSets:function(e,t){var a,s,i,o=this.cache.getTilemapData(e).data.tilesets;for(i=0;i<o.length;i++)s=o[i].name,a="assets/maps/"+o[i].image,s in t||(t[s]=a)},create:function(){setTimeout(function(){this.game.fadePlugin.fadeOut(0,750,0,function(){this.game.state.start("intro_skynews")}.bind(this))}.bind(this),500)}},Game.State.Startup=function(){},Game.State.Startup.prototype={preload:function(){this.load.image("crown","assets/sprites/crown.png"),this.load.bitmapFont("nokia","assets/fonts/bitmapFonts/nokia.png","assets/fonts/bitmapFonts/nokia.xml"),this.load.bitmapFont("pixeltype","assets/fonts/bitmapFonts/pixeltype.png","assets/fonts/bitmapFonts/pixeltype.xml");var e,t;for(t=0;t<Game.Map.MAPS.length;t++)e=Game.Map.MAPS[t],this.load.tilemap(e,"assets/maps/"+e+".json",null,Phaser.Tilemap.TILED_JSON)},create:function(){this.game.scale.scaleMode=Phaser.ScaleManager.SHOW_ALL,this.game.fadePlugin=this.game.plugins.add(new Phaser.Plugin.Fade(this)),this.game.physics.startSystem(Phaser.Physics.ARCADE),this.game.state.start("preloader")}},Game.State.Tutorial=function(){},Game.State.Tutorial.prototype=new Game.State.BaseState,Game.State.Tutorial.prototype.levelKey="tutorial",Game.State.Tutorial.prototype.nextLevelKey="decade_50s",Game.State.Tutorial.prototype.setCollisions=function(){this.levelModule.tilemap.setCollisionBetween(76,84)},Game.State.Tutorial.prototype.createForegroundLayers=function(){this.banisterLayer=this.levelModule.createLayer("banisters"),this.columnLayer=this.levelModule.createLayer("columns")};var Game={};Game={},Game.State={},Game.Map={},Game.Map.Object={},Game.Score={nbCollectibles:0,nbCollected:0,levelScores:{},allCollected:function(){return this.nbCollectibles===this.nbCollected}},Game.Map.MAPS=["tutorial","decade_50s","decade_60s","decade_2010s"],Game.Levels=[{text:"50s",stateKey:"decade_50s",spriteKey:"button_level_50s",collectibles:["record","tv","mini"]},{text:"60s",stateKey:"decade_60s",spriteKey:"button_level_60s",collectibles:["beatles","the_sun","worldcup"]},{text:"70s",stateKey:null,spriteKey:"button_level_70s",collectibles:[".",".","."]},{text:"80s",stateKey:"tutorial",spriteKey:"button_level_80s",collectibles:["corgi",".","."]},{text:"90s",stateKey:null,spriteKey:"button_level_90s",collectibles:[".",".","."]},{text:"00s",stateKey:null,spriteKey:"button_level_00s",collectibles:[".",".","."]},{text:"10s",stateKey:"decade_2010s",spriteKey:"button_level_10s",collectibles:["corgi","crown","."]}],Game.init=function(){var e=new Phaser.Game(568,320,Phaser.AUTO,"main",null,!1,!1);this.game=e,e.analytics=Game.Analytics,e.storage=new Game.Storage("skynews-queen-feature-game"),e.state.add("startup",Game.State.Startup),e.state.add("preloader",Game.State.Preloader),e.state.add("intro_skynews",Game.State.Intro_Skynews),e.state.add("intro_alexs_house",Game.State.Intro_AlexsHouse),e.state.add("navigation",Game.State.Navigation),e.state.add("tutorial",Game.State.Tutorial),e.state.add("intro_50s",Game.State.Intro_50s),e.state.add("decade_50s",Game.State.Decade_50s),e.state.add("decade_60s",Game.State.Decade_60s),e.state.add("decade_2010s",Game.State.Decade_2010s),e.state.add("end_screen",Game.State.EndScreen),Game.Levels.forEach(function(e){e.collectibles.forEach(function(e){"."!==e&&this.Score.nbCollectibles++}.bind(this))}.bind(this)),Game.getCollectedItems(),e.state.start("startup")},Game.getCollectedItems=function(){this.Score.nbCollected=0,Game.Levels.forEach(function(e){var t=this.game.storage.get(e.stateKey);t&&t.scoredItems.forEach(function(e){"jewel"!==e.sprite_key&&this.Score.nbCollected++}.bind(this)),Game.Score.levelScores[e.stateKey]=t}.bind(this))},window.onload=function(){Game.init()},Phaser.Plugin.Fade=function(e,t){Phaser.Plugin.call(this,e,t)},Phaser.Plugin.Fade.prototype=Object.create(Phaser.Plugin.prototype),Phaser.Plugin.Fade.prototype.constructor=Phaser.Plugin.SamplePlugin,Phaser.Plugin.Fade.prototype.fadeOut=function(e,t,a,s){this.fade(e,t,a,0,1,s)},Phaser.Plugin.Fade.prototype.fadeIn=function(e,t,a,s){this.fade(e,t,a,1,0,s)},Phaser.Plugin.Fade.prototype.fade=function(e,t,a,s,i,o){a=a||0;var n,r=this.game.add.graphics(0,0);r.beginFill(e,1),r.drawRect(this.game.camera.x,this.game.camera.y,1.5*this.game.world.width,1.5*this.game.world.height),r.alpha=s,r.endFill(),n=this.game.add.tween(r),n.to({alpha:i},t,null),o&&n.onComplete.add(o,this),n.start()},Game.Analytics={stateStarted:function(e){this.sendEvent(["state started",e])},stateComplete:function(e){this.sendEvent(["state completed",e])},itemCollected:function(e){this.sendEvent(["item collected",e])},gameCompleted:function(){this.sendEvent(["game completed"])},sendEvent:function(e){setTimeout(function(){ga("send","event","The Reign Game",e[0],e[1])},1)}};var PLAYER_SPEED=200;Game.Controls=function(e,t){this.game=e,this.player=t,this.moving=!1,this.create()},Game.Controls.prototype.create=function(){this.cursors=this.game.input.keyboard.createCursorKeys()},Game.Controls.prototype.handleDown=function(e){this.moving?this.jump():(e.x<this.game.width/2?this.moveLeft():this.moveRight(),this.moving=!0)},Game.Controls.prototype.handleUp=function(){console.log(this.game.input.totalActivePointers),0===this.game.input.totalActivePointers?(this.player.animations.stop(),this.player.frame=2,this.player.body.velocity.x=0,this.moving=!1):this.handleDown(this.game.input.activePointer)},Game.Controls.prototype.moveLeft=function(){this.player.body.velocity.x=-PLAYER_SPEED,this.player.animations.play("left")},Game.Controls.prototype.moveRight=function(){this.player.body.velocity.x=PLAYER_SPEED,this.player.animations.play("right")},Game.Controls.prototype.jump=function(){this.player.body.onFloor()&&(this.player.body.velocity.y=-300)},Game.Controls.prototype.update=function(){var e=0;this.game.input.pointer1.isDown&&e++,this.game.input.pointer2.isDown&&e++,(this.cursors.up.isDown||e>1)&&this.jump(),1===e&&(this.activePointer=this.game.input.pointer1.isDown?this.game.input.pointer1:this.game.input.pointer2),this.cursors.left.isDown?this.moveLeft():this.cursors.right.isDown?this.moveRight():0===e&&(this.player.body.velocity.x=0,this.activePointer=null),this.activePointer&&(this.activePointer.x<this.game.width/2?this.moveLeft():this.activePointer.x>this.game.width/2&&this.moveRight()),0===this.player.body.velocity.x&&(this.player.animations.stop(),this.player.frame=2)};var FACTOID_TEXT_PADDING=10;Game.Map.Object.Factoid=function(e,t){this.game=e,this.text=new Phaser.Text(e,0,0,t.properties.text,{font:"20px silkscreennormal",wordWrap:!0,wordWrapWidth:32*t.properties.tiles,align:"center"}),this.bg=e.add.sprite(t.x,t.y,this._getBackground()),this.bg.anchor.set(.5,.5),this.text.anchor.set(.5,.5),this.bg.visible=!1,this.bg.addChild(this.text),this.emitter=e.add.emitter(t.x,t.y,100),this.emitter.makeParticles(["sparkle1","sparkle2","sparkle3"]),this.emitter.width=this.text.width,this.emitter.height=this.text.height,this.emitter.minParticleSpeed.setTo(-50,-50),this.emitter.maxParticleSpeed.setTo(50,50),this.emitter.gravity=-600,this.emitter.alpha=.5,this.emitter.minParticleAlpha=.7,this.emitter.maxParticleAlpha=1,this.emitter.minParticleScale=.5,this.emitter.maxParticleScale=1.5,this.emitter.start(!0)},Game.Map.Object.Factoid.prototype.reveal=function(){this.bg.visible=!0,this.bg.scale.x=.5,this.bg.scale.y=.5,this.bg.alpha=0,this.game.add.tween(this.bg.scale).to({x:1},1e3,Phaser.Easing.Bounce.Out,!0),this.game.add.tween(this.bg.scale).to({y:1},750,Phaser.Easing.Bounce.Out,!0),this.game.add.tween(this.bg).to({alpha:1},1e3,Phaser.Easing.Linear.None,!0),this.emitter.explode(1e3,100)},Game.Map.Object.Factoid.prototype._getBackground=function(){var e=this.text.width+5+2*FACTOID_TEXT_PADDING,t=this.text.height+2*FACTOID_TEXT_PADDING,a=this.game.add.bitmapData(e,t);return a.ctx.beginPath(),a.ctx.rect(0,0,e,t),a.ctx.fillStyle="rgba(255,255,255, 0.7)",a.ctx.strokeStyle="rgba(0,0,0,0.6)",a.ctx.lineWidth=5,a.ctx.fill(),a.ctx.stroke(),a},Game.Map.Object.FloatingText=function(e,t){this.game=e,this.text=e.add.text(t.x,t.y,t.properties.text,{font:"20px silkscreennormal",wordWrap:!0,wordWrapWidth:32*t.properties.tiles,align:"center",fill:"#000"}),this.text.anchor.set(.5,.5)},Game.LevelScore=function(e,t,a){this.game=e,this.sprites={},this.scoredItems=[],this.collectedItems=this.game.storage.get(t),this.collectibles=a,this.collectibleSize=16,this.addDisplay()},Game.LevelScore.prototype.addDisplay=function(){var e,t,a,s,i=this.game.width-33,o=!1;this.scoreGroup=this.game.add.group(),this.scoreGroup.fixedToCamera=!0,this.scoreText=new Phaser.BitmapText(this.game,i,7,"nokia","0",20),this.scoreGroup.add(this.scoreText),this.collectibles.forEach(function(n){if("jewel"===n.properties.sprite_key){if(!o){o=!0,i-=32;var r=this.game.add.sprite(i,0,"jewel");this.scoreGroup.add(r),i-=20}}else e=n.properties.sprite_key,this.collectedItems&&this.collectedItems.scoredItems.forEach(function(e){e.sprite_key===n.properties.sprite_key&&(t=!0)}),t||(e+="_grey"),a=this.game.add.sprite(i,7,e),s=Math.min(this.collectibleSize/a.width,this.collectibleSize/a.height),a.scale.setTo(s,s),this.scoreGroup.add(a),this.sprites[n.properties.sprite_key]=a,i-=a.width*s+16}.bind(this))},Game.LevelScore.prototype.scoreItem=function(e,t){this.game.analytics.itemCollected(e.sprite_key);var a=this.sprites[e.sprite_key];a&&a.loadTexture(e.sprite_key),this.scoredItems.push(e),Game.Score.levelScores[t]={scoredItems:this.scoredItems},"jewel"!==e.sprite_key&&Game.Score.nbCollected<Game.Score.nbCollectibles&&Game.Score.nbCollected++,this.game.storage.set(t,{scoredItems:this.scoredItems}),this.updatePoints(this.scoredItems)},Game.LevelScore.prototype.updatePoints=function(e){var t,a=0;e.forEach(function(e){t=e.score,typeof t!==Number&&(t=parseInt(t,10)),a+=t}),this.scoreText&&this.scoreText.setText(a)},Game.Map.Module=function(e,t){this.game=e,this.tilemap=e.add.tilemap(t);for(var a=0;a<this.tilemap.tilesets.length;a++)this.tilemap.addTilesetImage(this.tilemap.tilesets[a].name)},Game.Map.Module.prototype={createLayer:function(){return this.tilemap.createLayer.apply(this.tilemap,arguments)},createLayers:function(){var e,t,a={};for(t=0;t<arguments.length;t++)e=arguments[t],a[e]=this.tilemap.createLayer(e);return a},findTextObjects:function(){var e=this,t=[];return this.tilemap.objects.text&&this.tilemap.objects.text.forEach(function(a){a.y-=e.tilemap.tileHeight,a.properties.text=a.properties.text.replace(/\\n/g,"\n").replace(/\\r/g,"\r"),a.properties.size=a.properties.size||20,t.push(a)}),t},findCollectibleObjects:function(){var e=this,t=[];return this.tilemap.objects.collectibles&&this.tilemap.objects.collectibles.forEach(function(a){a.y-=e.tilemap.tileHeight,t.push(a)}),t},findObjectsByType:function(e){var t=this,a=[];return this.tilemap.objects.objects&&this.tilemap.objects.objects.forEach(function(s){s.type===e&&(s.y-=t.tilemap.tileHeight,a.push(s))}),a},getCollisionSprites:function(e,t,a,s){a=a||0,s=s||0;var i,o=this,n=[];return this.tilemap.objects[e].forEach(function(e){e.y-=o.tilemap.tileHeight,i=t.create(e.x+32*a,e.y+32*s),o.game.physics.arcade.enable(i),i.body.setSize(e.properties.width,e.properties.height),i.body.immovable=!0,n.push(i)}),n},spriteFromObject:function(e,t){var a=t.create(e.x,e.y,e.properties.sprite);return a.properties={},Object.keys(e.properties).forEach(function(t){a.properties[t]=e.properties[t]}),a}},Game.PauseMenu=function(e){this.game=e,this.buttonDefinitions=[{sprite:"time_machine_button",x:40,y:80,callback:"backToNavigation"},{sprite:"resume_button",x:40,y:120,callback:"resume"},{sprite:"restart_level_button",x:40,y:160,callback:"restartLevel"},{sprite:"share_on_facebook",x:40,y:200,callback:"shareOnFacebook"},{sprite:"share_on_twitter",x:40,y:240,callback:"shareOnTwitter"}],this.buttons=[],this.addPauseButton(),this.drawMenu(),this.game.input.onDown.add(this.handleInput,this)},Game.PauseMenu.prototype.addPauseButton=function(){this.pauseButton=this.game.add.button(10,10,"pause",this.showPauseMenu,this),this.pauseButton.fixedToCamera=!0},Game.PauseMenu.prototype.drawMenu=function(){var e,t,a;this.menuGroup=this.game.add.group(),this.menuGroup.visible=!1,a=this.game.add.graphics(0,0),a.fixedToCamera=!0,a.beginFill(0,.8),a.drawRect(this.game.camera.x,this.game.camera.y,this.game.width,this.game.height),a.endFill(),this.menuGroup.add(a),e=new Phaser.Text(this.game,240,40,"Paused",{font:"helvetica",fontSize:18,fill:"#ffffff"}),e.fixedToCamera=!0,this.menuGroup.add(e),this.buttonDefinitions.forEach(function(e){t=new Phaser.Image(this.game,e.x,e.y,e.sprite),t.fixedToCamera=!0,this.menuGroup.add(t),this.buttons.push({x1:t.x,y1:t.y,x2:t.x+t.width,y2:t.y+t.height,callback:e.callback})}.bind(this))},Game.PauseMenu.prototype.handleInput=function(e){this.game.paused&&this.buttons.forEach(function(t){e.x>t.x1&&e.x<t.x2&&e.y>t.y1&&e.y<t.y2&&t.callback&&this[t.callback]()}.bind(this))},Game.PauseMenu.prototype.backToNavigation=function(){this.game.paused=!1,this.game.state.start("navigation")},Game.PauseMenu.prototype.resume=function(){this.game.paused=!1,this.pauseButton.visible=!0,this.menuGroup.visible=!1},Game.PauseMenu.prototype.restartLevel=function(){this.game.paused=!1,this.game.state.start(this.game.state.current)},Game.PauseMenu.prototype.showPauseMenu=function(){this.game.paused=!0,this.pauseButton.visible=!1,this.menuGroup.visible=!0},Game.PauseMenu.prototype.shareOnFacebook=function(){console.log("shared on Facebook")},Game.PauseMenu.prototype.shareOnTwitter=function(){console.log("shared on Twitter")},Game.Storage=function(e){this.storageName=e||"skynews-game",this.read()},Game.Storage.prototype.save=function(){localStorage.setItem(this.storageName,JSON.stringify(this.state))},Game.Storage.prototype.read=function(){this.state=JSON.parse(localStorage.getItem(this.storageName)||"{}")||{}},Game.Storage.prototype.set=function(e,t){this.state[e]=t,this.save()},Game.Storage.prototype.get=function(e){return this.state[e]},Game.State.BaseState=function(){this.levelKey=null,this.controls=null,this.collectibleItems=[],this.collectedItems=[],this.parallaxTextGroup=null,this.fixedTextGroup=null},Game.State.BaseState.prototype={TEXT_PARALLAX_SCALE:1.1,create:function(){this.game.analytics.stateStarted(this.levelKey),this.game.physics.arcade.gravity.y=600,this._createState(),this.game.fadePlugin.fadeIn(0,750,0)},addPlayer:function(){var e=this.levelModule.findObjectsByType("player_spawn");this.player=this.game.add.sprite(e[0].x,e[0].y-32,"player"),this.game.physics.arcade.enable(this.player),this.player.body.collideWorldBounds=!0,this.game.camera.follow(this.player),this.player.animations.add("left",[0,1],5,!0),this.player.animations.add("right",[3,4],5,!0)},addCollectibles:function(){this.collectibleItems=[];var e=this.levelModule.findCollectibleObjects();e.forEach(function(e){var t=this.game.add.sprite(e.x,e.y,e.properties.sprite_key);"jewel"!==e.properties.sprite_key&&(t._isArtefact=!0,t._revealFactId=e.properties.revealFactId,this.addArtefactEmitter(t)),t.properties=e.properties,this.game.physics.arcade.enable(t),t.body.allowGravity=!1,t.anchor=new Phaser.Point(.5,.5),this.collectibleItems.push(t)}.bind(this))},addArtefactEmitter:function(e){var t=this.game.add.emitter(e.x,e.y,10);t.makeParticles(["sparkle1","sparkle2","sparkle3"]),t.minParticleSpeed.setTo(-50,-50),t.maxParticleSpeed.setTo(50,50),t.gravity=-600,t.alpha=.5,t.minParticleAlpha=.7,t.maxParticleAlpha=1,t.minParticleScale=.5,t.maxParticleScale=1.5,t.start(!1,1e3,100),e._emitter=t},addNextLevelPortal:function(){var e=this.levelModule.findObjectsByType("next_level");e.length&&(this.nextLevel=this.game.add.sprite(e[0].x,e[0].y,"transparent_32-160"),this.game.physics.arcade.enable(this.nextLevel),this.nextLevel.body.allowGravity=!1,this.nextLevel.y-=110)},_createState:function(){var e;this.levelModule=new Game.Map.Module(this.game,this.levelKey),this.modules={},this.createBackgroundLayers&&"function"==typeof this.createBackgroundLayers&&this.createBackgroundLayers(),this.platform=this.levelModule.createLayer("platform"),this.platform.alpha=0,this.platform.resizeWorld(),this.addNextLevelPortal(),e=this.levelModule.findTextObjects(),this.factReference={},this.addPlayer(),this.addCollectibles(),this.controls=new Game.Controls(this.game,this.player),this.createForegroundLayers&&"function"==typeof this.createForegroundLayers&&this.createForegroundLayers(),e.forEach(function(e){"factoid"===e.properties.type?this.factReference[e.properties.id]=new Game.Map.Object.Factoid(this.game,e):new Game.Map.Object.FloatingText(this.game,e)}.bind(this)),this.setCollisions&&"function"==typeof this.setCollisions&&this.setCollisions(),this.scoreDisplay=new Game.LevelScore(this.game,this.levelKey,this.collectibleItems),this.pauseMenu=new Game.PauseMenu(this.game)},_collectiblesCollisionHandler:function(e,t){var a=null;t._emitter&&(t._emitter.on=!1),a=t,a.x=a.x-this.game.camera.x,a.y=a.y-this.game.camera.y,t.fixedToCamera=!0,a.body.destroy(),this.game.add.tween(a).to({alpha:0},500,"Linear",!0),this.game.add.tween(a.scale).to({x:3,y:3},250,Phaser.Easing.Quadratic.In,!0).chain(this.game.add.tween(a.scale).to({x:1,y:1},250,Phaser.Easing.Quadratic.Out)),this.game.add.tween(a.cameraOffset).to({y:-32},500,Phaser.Easing.Quadratic.InOut,!0),this.game.add.tween(a.cameraOffset).to({x:500},500,Phaser.Easing.Quadratic.InOut,!0).onComplete.add(a.destroy,a),this.collectedItems.push(a),this.itemCollectedHandler&&"function"==typeof this.itemCollectedHandler&&this.itemCollectedHandler(a),this.scoreDisplay.scoreItem(a.properties,this.levelKey),a._revealFactId&&this.factReference[a._revealFactId].reveal()},_nextLevelHandler:function(){var e=this.nextLevelKey;this.game.fadePlugin.fadeOut(0,750,0,function(){this.game.analytics.stateComplete(this.levelKey),Game.Score.allCollected()&&(e="end_screen"),this.game.state.start(e)}.bind(this))},update:function(){this._updateState(),this.updateState&&"function"==typeof this.updateState&&this.updateState()},_updateState:function(){this.parallaxTextGroup&&(this.parallaxTextGroup.x=this.game.world.x*this.TEXT_PARALLAX_SCALE),this.game.physics.arcade.collide(this.player,this.platform),this.game.physics.arcade.overlap(this.player,this.collectibleItems,this._collectiblesCollisionHandler,null,this),this.game.physics.arcade.overlap(this.player,this.nextLevel,this._nextLevelHandler,null,this),this.controls.update()}},Game.State.Decade_2010s=function(){},Game.State.Decade_2010s.prototype=new Game.State.BaseState,Game.State.Decade_2010s.prototype.levelKey="decade_2010s",Game.State.Decade_2010s.prototype.nextLevelKey="navigation",Game.State.Decade_2010s.prototype.setCollisions=function(){this.levelModule.tilemap.setCollisionBetween(834,849),this.levelModule.tilemap.setCollisionBetween(861,882)},Game.State.Decade_50s=function(){},Game.State.Decade_50s.prototype=new Game.State.BaseState,Game.State.Decade_50s.prototype.levelKey="decade_50s",Game.State.Decade_50s.prototype.nextLevelKey="decade_60s",Game.State.Decade_50s.prototype.setCollisions=function(){this.levelModule.tilemap.setCollision(76)},Game.State.Decade_50s.prototype.createBackgroundLayers=function(){this.levelModule.createLayer("background")},Game.State.Decade_50s.prototype.createForegroundLayers=function(){this.levelModule.createLayer("foreground")},Game.State.Decade_60s=function(){},Game.State.Decade_60s.prototype=new Game.State.BaseState,Game.State.Decade_60s.prototype.levelKey="decade_60s",Game.State.Decade_60s.prototype.nextLevelKey="decade_2010s",Game.State.Decade_60s.prototype.setCollisions=function(){this.levelModule.tilemap.setCollision(3)},Game.State.Decade_60s.prototype.createBackgroundLayers=function(){this.levelModule.createLayer("bg_colour"),this.levelModule.createLayer("background")},Game.State.Decade_60s.prototype.createForegroundLayers=function(){this.levelModule.createLayer("foreground")},Game.State.Decade_60s.prototype.updateState=function(){this.parallaxTextGroup.x=this.game.world.x*this.TEXT_PARALLAX_SCALE,this.parallaxTextGroup.y=this.game.world.y*this.TEXT_PARALLAX_SCALE},Game.State.EndScreen=function(){},Game.State.EndScreen.prototype={cursors:null,transitionning:!1,fixedTextOverlays:[{text:"Well done",size:100,x:20,y:20,alpha:.2},{text:"All royal artefacts have been returned!",size:20,x:20,y:120}],create:function(){this.game.analytics.gameCompleted(),this.transitionning=!1,this.createState(),this.game.fadePlugin.fadeIn(0,750,0)},createState:function(){var e=this.game.add.graphics(0,0);e.beginFill(0,1),e.drawRect(this.game.camera.x,this.game.camera.y,1.5*this.game.width,1.5*this.game.height),e.endFill(),this.textGroup=this.game.add.group(),this.textGroup.fixedToCamera=!1,this.textGroup.alpha=1,this.fixedTextOverlays.forEach(function(e){var t=new Phaser.BitmapText(this.game,e.x,e.y,"nokia",e.text,e.size);t.alpha=e.alpha||1,this.textGroup.add(t);

}.bind(this)),this.game.add.button(this.game.width-120,this.game.height-50,"next_button",this.nextLevel,this),this.cursors=this.game.input.keyboard.createCursorKeys()},nextLevel:function(){this.transitionning||(this.transitionning=!0,this.game.fadePlugin.fadeOut(0,750,0,function(){this.game.state.start("navigation")}))}},Game.State.Intro_50s=function(){},Game.State.Intro_50s.prototype={cursors:null,transitionning:!1,fixedTextOverlays:[{text:"1950s",size:200,x:20,y:20,alpha:.2},{text:"Post-war Britain started the 1950s hard-up and hurting.\n\nFood rations were in place until 1954, there were unexploded bombs in the\rstreets, and Britain's international standing was shaken by the Suez crisis.\n\nBut by the end of the decade the UK had a new Queen, television sets,\rand rock n'roll.\n\nPrime Minister Harold MacMillan proclaimed 'most of\rour people have never had it so good'.",size:16,x:20,y:20}],create:function(){this.transitionning=!1,this.createState(),this.game.fadePlugin.fadeIn(0,750,0)},createState:function(){var e=this.game.add.graphics(0,0);e.beginFill(0,1),e.drawRect(this.game.camera.x,this.game.camera.y,1.5*this.game.width,1.5*this.game.height),e.endFill(),this.endTextGroup=this.game.add.group(),this.endTextGroup.fixedToCamera=!1,this.endTextGroup.alpha=1,this.fixedTextOverlays.forEach(function(e){var t=new Phaser.Text(this.game,e.x,e.y,e.text,{font:"helvetica",fontSize:e.size,fill:"#ffffff"});t.alpha=e.alpha||1,this.endTextGroup.add(t)}.bind(this)),this.game.add.button(this.game.width-120,this.game.height-50,"next_button",this.nextLevel,this),this.cursors=this.game.input.keyboard.createCursorKeys()},nextLevel:function(){this.transitionning||(this.transitionning=!0,this.game.fadePlugin.fadeOut(0,750,0,function(){this.game.state.start("decade_50s")}))}},Game.State.Intro_AlexsHouse=function(){},Game.State.Intro_AlexsHouse.prototype={cursors:null,transitionning:!1,create:function(){this.transitionning=!1,this.game.add.image(0,0,"alexs_house"),this.game.add.button(this.game.width-120,this.game.height-50,"next_button",this.nextLevel,this),this.game.fadePlugin.fadeIn(0,750,0)},nextLevel:function(){this.transitionning||(this.transitionning=!0,this.game.fadePlugin.fadeOut(0,750,0,function(){this.game.state.start("navigation")}))}},Game.State.Intro_Skynews=function(){},Game.State.Intro_Skynews.prototype={cursors:null,transitionning:!1,create:function(){var e,t,a,s,i;this.game.analytics.stateStarted("intro"),this.transitionning=!1,this.game.stage.backgroundColor="#fff",this.game.add.image(0,0,"kay"),e=this.game.add.image(10,10,"skynews_logo"),t=this.game.add.image(0,300,"intro_ticker"),a=this.game.add.image(568,300,"intro_ticker"),s=this.game.add.group(),s.add(t),s.add(a),i=this.game.add.tween(s).to({x:-568},1e4,"Linear",!0),i.repeat(),this.clock=this.game.add.text(0,300," 00:00 ",{font:"16px Arial",fill:"#fff",backgroundColor:"black",boundsAlignV:"middle"}),this.speechText1=this.game.add.text(10,50,"A dastardly villain has travelled through time and stolen artifacts from the Queen's reign",{font:"16px Arial",fill:"#000",backgroundColor:"white",wordWrap:!0,wordWrapWidth:200}),this.speechText2=this.game.add.text(10,50,"Police are baffled. Won't somebody come forward and help? For our country!",{font:"16px Arial",fill:"#000",backgroundColor:"white",wordWrap:!0,wordWrapWidth:200}),this.speechText2.visible=!1,this.updateClock(),this.game.time.events.loop(Phaser.Timer.SECOND,this.updateClock,this),this.game.add.button(this.game.width-120,this.game.height-50,"next_button",this.nextFrame,this),this.game.fadePlugin.fadeIn(0,750,0)},nextFrame:function(){this.speechText1.visible?(this.speechText2.visible=!0,this.speechText1.visible=!1):this.nextLevel()},updateClock:function(){var e=new Date;this.clock.setText(" "+("0"+e.getHours()).slice(-2)+":"+("0"+e.getMinutes()).slice(-2)+" ")},nextLevel:function(){this.transitionning||(this.transitionning=!0,this.game.fadePlugin.fadeOut(0,750,0,function(){this.game.state.start("intro_alexs_house")}))}},Game.State.Navigation=function(){},Game.State.Navigation.prototype={cursors:null,transitionning:!1,buttonsOriginX:24,buttonsOriginY:24,buttonsMargin:30,buttonsPerRow:3,buttonHeight:48,buttonWidth:48,collectibleSize:10,create:function(){this.game.analytics.stateStarted("navigation"),this.transitionning=!1,this.createState(),this.game.fadePlugin.fadeIn(0,750,0)},createState:function(){var e=this.game.add.graphics(0,0),t=0,a=0;e.beginFill(0,1),e.drawRect(this.game.camera.x,this.game.camera.y,1.5*this.game.width,1.5*this.game.height),e.endFill(),this.buttonsGroup=this.game.add.group(),Game.Levels.forEach(function(e){var s,i,o,n=Game.Score.levelScores[e.stateKey],r=0;i=this.buttonsOriginX+a*(this.buttonWidth+this.buttonsMargin),o=this.buttonsOriginY+t*(this.buttonHeight+this.buttonsMargin),s=this.game.add.button(i,o,e.spriteKey,this.nextLevel,this),s.properties=e,e.collectibles.forEach(function(e){var t,a,s=i+18*r,l=o+this.buttonHeight+10,h=!1,c=6710886;n&&n.scoredItems.forEach(function(t){t.sprite_key===e&&(h=!0)}.bind(this)),"."===e?(h&&(c=16777215),t=this.game.add.graphics(0,0),t.properties={},t.properties.collectibleName=e,t.beginFill(c,1),t.drawRect(s,l,this.collectibleSize,this.collectibleSize),t.endFill()):(h||(e+="_grey"),t=this.game.add.sprite(s,l,e),a=Math.min(this.collectibleSize/t.width,this.collectibleSize/t.height),t.scale.setTo(a,a)),r++}.bind(this)),a+1>=this.buttonsPerRow?(a=0,t++):a++}.bind(this)),this.cursors=this.game.input.keyboard.createCursorKeys()},nextLevel:function(e){this.transitionning||(this.transitionning=!0,this.game.fadePlugin.fadeOut(0,750,0,function(){this.game.state.start(e.properties.stateKey||"tutorial")}))}},Game.State.Preloader=function(){},Game.State.Preloader.prototype={preload:function(){this.stage.backgroundColor="#000000",this.add.sprite(195,138,"crown"),this.textGroup=this.game.add.group(),this.textGroup.fixedToCamera=!0,this.textGroup.add(new Phaser.BitmapText(this.game,this.game.width/2-50,this.game.height/2-15,"pixeltype","Loading...",40)),this.game.load.image("intro_ticker","assets/sprites/intro-ticker.png"),this.game.load.image("skynews_logo","assets/sprites/8bit_sky_logo.png"),this.game.load.image("kay","assets/sprites/kayburley.png"),this.game.load.image("alexs_house","assets/sprites/alexshouse.png"),this.load.spritesheet("player","assets/sprites/alex_character.png",59,69,6),this.load.spritesheet("next_button","assets/sprites/next_button.png",100,30),this.game.load.image("sparkle1","assets/sprites/sparkle1.png"),this.game.load.image("sparkle2","assets/sprites/sparkle2.png"),this.game.load.image("sparkle3","assets/sprites/sparkle3.png"),this.game.load.image("transparent_32-160","assets/sprites/transparent_32-160.png"),this.game.load.image("jewel","assets/sprites/jewel.png"),this.game.load.image("jewel_grey","assets/sprites/jewel_grey.png"),this.game.load.image("corgi","assets/sprites/corgi.png"),this.game.load.image("corgi_grey","assets/sprites/corgi_grey.png"),this.game.load.image("crown_grey","assets/sprites/crown_grey.png"),this.game.load.image("tv","assets/sprites/50s_tv.png"),this.game.load.image("tv_grey","assets/sprites/50s_tv_grey.png"),this.game.load.image("record","assets/sprites/50s_record.png"),this.game.load.image("record_grey","assets/sprites/50s_record_grey.png"),this.game.load.image("mini","assets/sprites/50s_mini.png"),this.game.load.image("mini_grey","assets/sprites/50s_mini_grey.png"),this.game.load.image("beatles","assets/sprites/60s_beatles.png"),this.game.load.image("beatles_grey","assets/sprites/60s_beatles_grey.png"),this.game.load.image("worldcup","assets/sprites/60s_worldcup.png"),this.game.load.image("worldcup_grey","assets/sprites/60s_worldcup_grey.png"),this.game.load.image("the_sun","assets/sprites/60s_the_sun.png"),this.game.load.image("the_sun_grey","assets/sprites/60s_the_sun_grey.png"),this.game.load.image("button_level_50s","assets/sprites/level_buttons/level_50s.png"),this.game.load.image("button_level_60s","assets/sprites/level_buttons/level_60s.png"),this.game.load.image("button_level_70s","assets/sprites/level_buttons/level_70s.png"),this.game.load.image("button_level_80s","assets/sprites/level_buttons/level_80s.png"),this.game.load.image("button_level_90s","assets/sprites/level_buttons/level_90s.png"),this.game.load.image("button_level_00s","assets/sprites/level_buttons/level_00s.png"),this.game.load.image("button_level_10s","assets/sprites/level_buttons/level_10s.png"),this.load.image("compass","assets/sprites/compass_rose.png"),this.load.image("touch_segment","assets/sprites/touch_segment.png"),this.load.image("touch","assets/sprites/touch.png"),this.load.image("pause","assets/sprites/pause.png"),this.load.image("time_machine_button","assets/sprites/time-machine-button.png"),this.load.image("resume_button","assets/sprites/resume-button.png"),this.load.image("restart_level_button","assets/sprites/restart-level-button.png"),this.load.image("share_on_facebook","assets/sprites/share-on-facebook-button.png"),this.load.image("share_on_twitter","assets/sprites/share-on-twitter-button.png"),this.loadTileMaps()},loadTileMaps:function(){var e,t,a={};for(t=0;t<Game.Map.MAPS.length;t++)this.addTileSets(Game.Map.MAPS[t],a);for(e in a)a.hasOwnProperty(e)&&this.load.image(e,a[e])},addTileSets:function(e,t){var a,s,i,o=this.cache.getTilemapData(e).data.tilesets;for(i=0;i<o.length;i++)s=o[i].name,a="assets/maps/"+o[i].image,s in t||(t[s]=a)},create:function(){setTimeout(function(){this.game.fadePlugin.fadeOut(0,750,0,function(){this.game.state.start("intro_skynews")}.bind(this))}.bind(this),500)}},Game.State.Startup=function(){},Game.State.Startup.prototype={preload:function(){this.load.image("crown","assets/sprites/crown.png"),this.load.bitmapFont("nokia","assets/fonts/bitmapFonts/nokia.png","assets/fonts/bitmapFonts/nokia.xml"),this.load.bitmapFont("pixeltype","assets/fonts/bitmapFonts/pixeltype.png","assets/fonts/bitmapFonts/pixeltype.xml");var e,t;for(t=0;t<Game.Map.MAPS.length;t++)e=Game.Map.MAPS[t],this.load.tilemap(e,"assets/maps/"+e+".json",null,Phaser.Tilemap.TILED_JSON)},create:function(){this.game.scale.scaleMode=Phaser.ScaleManager.SHOW_ALL,this.game.fadePlugin=this.game.plugins.add(new Phaser.Plugin.Fade(this)),this.game.physics.startSystem(Phaser.Physics.ARCADE),this.game.state.start("preloader")}},Game.State.Tutorial=function(){},Game.State.Tutorial.prototype=new Game.State.BaseState,Game.State.Tutorial.prototype.levelKey="tutorial",Game.State.Tutorial.prototype.nextLevelKey="decade_50s",Game.State.Tutorial.prototype.setCollisions=function(){this.levelModule.tilemap.setCollisionBetween(76,84)},Game.State.Tutorial.prototype.createForegroundLayers=function(){this.banisterLayer=this.levelModule.createLayer("banisters"),this.columnLayer=this.levelModule.createLayer("columns")};var Game={};Game={},Game.State={},Game.Map={},Game.Map.Object={},Game.Score={nbCollectibles:0,nbCollected:0,levelScores:{},allCollected:function(){return this.nbCollectibles===this.nbCollected}},Game.Map.MAPS=["tutorial","decade_50s","decade_60s","decade_2010s"],Game.Levels=[{text:"50s",stateKey:"decade_50s",spriteKey:"button_level_50s",collectibles:["record","tv","mini"]},{text:"60s",stateKey:"decade_60s",spriteKey:"button_level_60s",collectibles:["beatles","the_sun","worldcup"]},{text:"70s",stateKey:null,spriteKey:"button_level_70s",collectibles:[".",".","."]},{text:"80s",stateKey:"tutorial",spriteKey:"button_level_80s",collectibles:["corgi",".","."]},{text:"90s",stateKey:null,spriteKey:"button_level_90s",collectibles:[".",".","."]},{text:"00s",stateKey:null,spriteKey:"button_level_00s",collectibles:[".",".","."]},{text:"10s",stateKey:"decade_2010s",spriteKey:"button_level_10s",collectibles:["corgi","crown","."]}],Game.init=function(){var e=new Phaser.Game(568,320,Phaser.AUTO,"main",null,!1,!1);this.game=e,e.analytics=Game.Analytics,e.storage=new Game.Storage("skynews-queen-feature-game"),e.state.add("startup",Game.State.Startup),e.state.add("preloader",Game.State.Preloader),e.state.add("intro_skynews",Game.State.Intro_Skynews),e.state.add("intro_alexs_house",Game.State.Intro_AlexsHouse),e.state.add("navigation",Game.State.Navigation),e.state.add("tutorial",Game.State.Tutorial),e.state.add("intro_50s",Game.State.Intro_50s),e.state.add("decade_50s",Game.State.Decade_50s),e.state.add("decade_60s",Game.State.Decade_60s),e.state.add("decade_2010s",Game.State.Decade_2010s),e.state.add("end_screen",Game.State.EndScreen),Game.Levels.forEach(function(e){e.collectibles.forEach(function(e){"."!==e&&this.Score.nbCollectibles++}.bind(this))}.bind(this)),Game.getCollectedItems(),e.state.start("startup")},Game.getCollectedItems=function(){this.Score.nbCollected=0,Game.Levels.forEach(function(e){var t=this.game.storage.get(e.stateKey);t&&t.scoredItems.forEach(function(e){"jewel"!==e.sprite_key&&this.Score.nbCollected++}.bind(this)),Game.Score.levelScores[e.stateKey]=t}.bind(this))},window.onload=function(){Game.init()},Phaser.Plugin.Fade=function(e,t){Phaser.Plugin.call(this,e,t)},Phaser.Plugin.Fade.prototype=Object.create(Phaser.Plugin.prototype),Phaser.Plugin.Fade.prototype.constructor=Phaser.Plugin.SamplePlugin,Phaser.Plugin.Fade.prototype.fadeOut=function(e,t,a,s){this.fade(e,t,a,0,1,s)},Phaser.Plugin.Fade.prototype.fadeIn=function(e,t,a,s){this.fade(e,t,a,1,0,s)},Phaser.Plugin.Fade.prototype.fade=function(e,t,a,s,i,o){a=a||0;var n,r=this.game.add.graphics(0,0);r.beginFill(e,1),r.drawRect(this.game.camera.x,this.game.camera.y,1.5*this.game.world.width,1.5*this.game.world.height),r.alpha=s,r.endFill(),n=this.game.add.tween(r),n.to({alpha:i},t,null),o&&n.onComplete.add(o,this),n.start()},Game.Analytics={stateStarted:function(e){this.sendEvent(["state started",e])},stateComplete:function(e){this.sendEvent(["state completed",e])},itemCollected:function(e){this.sendEvent(["item collected",e])},gameCompleted:function(){this.sendEvent(["game completed"])},sendEvent:function(e){setTimeout(function(){ga("send","event","The Reign Game",e[0],e[1])},1)}};var PLAYER_SPEED=200;Game.Controls=function(e,t){this.game=e,this.player=t,this.moving=!1,this.create()},Game.Controls.prototype.create=function(){this.cursors=this.game.input.keyboard.createCursorKeys()},Game.Controls.prototype.handleDown=function(e){this.moving?this.jump():(e.x<this.game.width/2?this.moveLeft():this.moveRight(),this.moving=!0)},Game.Controls.prototype.handleUp=function(){console.log(this.game.input.totalActivePointers),0===this.game.input.totalActivePointers?(this.player.animations.stop(),this.player.frame=2,this.player.body.velocity.x=0,this.moving=!1):this.handleDown(this.game.input.activePointer)},Game.Controls.prototype.moveLeft=function(){this.player.body.velocity.x=-PLAYER_SPEED,this.player.animations.play("left")},Game.Controls.prototype.moveRight=function(){this.player.body.velocity.x=PLAYER_SPEED,this.player.animations.play("right")},Game.Controls.prototype.jump=function(){this.player.body.onFloor()&&(this.player.body.velocity.y=-300)},Game.Controls.prototype.update=function(){var e=0;this.game.input.pointer1.isDown&&e++,this.game.input.pointer2.isDown&&e++,(this.cursors.up.isDown||e>1)&&this.jump(),1===e&&(this.activePointer=this.game.input.pointer1.isDown?this.game.input.pointer1:this.game.input.pointer2),this.cursors.left.isDown?this.moveLeft():this.cursors.right.isDown?this.moveRight():0===e&&(this.player.body.velocity.x=0,this.activePointer=null),this.activePointer&&(this.activePointer.x<this.game.width/2?this.moveLeft():this.activePointer.x>this.game.width/2&&this.moveRight()),0===this.player.body.velocity.x&&(this.player.animations.stop(),this.player.frame=2)};var FACTOID_TEXT_PADDING=10;Game.Map.Object.Factoid=function(e,t){this.game=e,this.text=new Phaser.Text(e,0,0,t.properties.text,{font:"20px silkscreennormal",wordWrap:!0,wordWrapWidth:32*t.properties.tiles,align:"center"}),this.bg=e.add.sprite(t.x,t.y,this._getBackground()),this.bg.anchor.set(.5,.5),this.text.anchor.set(.5,.5),this.bg.visible=!1,this.bg.addChild(this.text),this.emitter=e.add.emitter(t.x,t.y,100),this.emitter.makeParticles(["sparkle1","sparkle2","sparkle3"]),this.emitter.width=this.text.width,this.emitter.height=this.text.height,this.emitter.minParticleSpeed.setTo(-50,-50),this.emitter.maxParticleSpeed.setTo(50,50),this.emitter.gravity=-600,this.emitter.alpha=.5,this.emitter.minParticleAlpha=.7,this.emitter.maxParticleAlpha=1,this.emitter.minParticleScale=.5,this.emitter.maxParticleScale=1.5,this.emitter.start(!0)},Game.Map.Object.Factoid.prototype.reveal=function(){this.bg.visible=!0,this.bg.scale.x=.5,this.bg.scale.y=.5,this.bg.alpha=0,this.game.add.tween(this.bg.scale).to({x:1},1e3,Phaser.Easing.Bounce.Out,!0),this.game.add.tween(this.bg.scale).to({y:1},750,Phaser.Easing.Bounce.Out,!0),this.game.add.tween(this.bg).to({alpha:1},1e3,Phaser.Easing.Linear.None,!0),this.emitter.explode(1e3,100)},Game.Map.Object.Factoid.prototype._getBackground=function(){var e=this.text.width+5+2*FACTOID_TEXT_PADDING,t=this.text.height+2*FACTOID_TEXT_PADDING,a=this.game.add.bitmapData(e,t);return a.ctx.beginPath(),a.ctx.rect(0,0,e,t),a.ctx.fillStyle="rgba(255,255,255, 0.7)",a.ctx.strokeStyle="rgba(0,0,0,0.6)",a.ctx.lineWidth=5,a.ctx.fill(),a.ctx.stroke(),a},Game.Map.Object.FloatingText=function(e,t){this.game=e,this.text=e.add.text(t.x,t.y,t.properties.text,{font:"20px silkscreennormal",wordWrap:!0,wordWrapWidth:32*t.properties.tiles,align:"center",fill:"#000"}),this.text.anchor.set(.5,.5)},Game.LevelScore=function(e,t,a){this.game=e,this.sprites={},this.scoredItems=[],this.collectedItems=this.game.storage.get(t),this.collectibles=a,this.collectibleSize=16,this.addDisplay()},Game.LevelScore.prototype.addDisplay=function(){var e,t,a,s,i=this.game.width-33,o=!1;this.scoreGroup=this.game.add.group(),this.scoreGroup.fixedToCamera=!0,this.scoreText=new Phaser.BitmapText(this.game,i,7,"nokia","0",20),this.scoreGroup.add(this.scoreText),this.collectibles.forEach(function(n){if("jewel"===n.properties.sprite_key){if(!o){o=!0,i-=32;var r=this.game.add.sprite(i,0,"jewel");this.scoreGroup.add(r),i-=20}}else e=n.properties.sprite_key,this.collectedItems&&this.collectedItems.scoredItems.forEach(function(e){e.sprite_key===n.properties.sprite_key&&(t=!0)}),t||(e+="_grey"),a=this.game.add.sprite(i,7,e),s=Math.min(this.collectibleSize/a.width,this.collectibleSize/a.height),a.scale.setTo(s,s),this.scoreGroup.add(a),this.sprites[n.properties.sprite_key]=a,i-=a.width*s+16}.bind(this))},Game.LevelScore.prototype.scoreItem=function(e,t){this.game.analytics.itemCollected(e.sprite_key);var a=this.sprites[e.sprite_key];a&&a.loadTexture(e.sprite_key),this.scoredItems.push(e),Game.Score.levelScores[t]={scoredItems:this.scoredItems},"jewel"!==e.sprite_key&&Game.Score.nbCollected<Game.Score.nbCollectibles&&Game.Score.nbCollected++,this.game.storage.set(t,{scoredItems:this.scoredItems}),this.updatePoints(this.scoredItems)},Game.LevelScore.prototype.updatePoints=function(e){var t,a=0;e.forEach(function(e){t=e.score,typeof t!==Number&&(t=parseInt(t,10)),a+=t}),this.scoreText&&this.scoreText.setText(a)},Game.Map.Module=function(e,t){this.game=e,this.tilemap=e.add.tilemap(t);for(var a=0;a<this.tilemap.tilesets.length;a++)this.tilemap.addTilesetImage(this.tilemap.tilesets[a].name)},Game.Map.Module.prototype={createLayer:function(){return this.tilemap.createLayer.apply(this.tilemap,arguments)},createLayers:function(){var e,t,a={};for(t=0;t<arguments.length;t++)e=arguments[t],a[e]=this.tilemap.createLayer(e);return a},findTextObjects:function(){var e=this,t=[];return this.tilemap.objects.text&&this.tilemap.objects.text.forEach(function(a){a.y-=e.tilemap.tileHeight,a.properties.text=a.properties.text.replace(/\\n/g,"\n").replace(/\\r/g,"\r"),a.properties.size=a.properties.size||20,t.push(a)}),t},findCollectibleObjects:function(){var e=this,t=[];return this.tilemap.objects.collectibles&&this.tilemap.objects.collectibles.forEach(function(a){a.y-=e.tilemap.tileHeight,t.push(a)}),t},findObjectsByType:function(e){var t=this,a=[];return this.tilemap.objects.objects&&this.tilemap.objects.objects.forEach(function(s){s.type===e&&(s.y-=t.tilemap.tileHeight,a.push(s))}),a},getCollisionSprites:function(e,t,a,s){a=a||0,s=s||0;var i,o=this,n=[];return this.tilemap.objects[e].forEach(function(e){e.y-=o.tilemap.tileHeight,i=t.create(e.x+32*a,e.y+32*s),o.game.physics.arcade.enable(i),i.body.setSize(e.properties.width,e.properties.height),i.body.immovable=!0,n.push(i)}),n},spriteFromObject:function(e,t){var a=t.create(e.x,e.y,e.properties.sprite);return a.properties={},Object.keys(e.properties).forEach(function(t){a.properties[t]=e.properties[t]}),a}},Game.PauseMenu=function(e){this.game=e,this.buttonDefinitions=[{sprite:"time_machine_button",x:40,y:80,callback:"backToNavigation"},{sprite:"resume_button",x:40,y:120,callback:"resume"},{sprite:"restart_level_button",x:40,y:160,callback:"restartLevel"},{sprite:"share_on_facebook",x:40,y:200,callback:"shareOnFacebook"},{sprite:"share_on_twitter",x:40,y:240,callback:"shareOnTwitter"}],this.buttons=[],this.addPauseButton(),this.drawMenu(),this.game.input.onDown.add(this.handleInput,this)},Game.PauseMenu.prototype.addPauseButton=function(){this.pauseButton=this.game.add.button(10,10,"pause",this.showPauseMenu,this),this.pauseButton.fixedToCamera=!0},Game.PauseMenu.prototype.drawMenu=function(){var e,t,a;this.menuGroup=this.game.add.group(),this.menuGroup.visible=!1,a=this.game.add.graphics(0,0),a.fixedToCamera=!0,a.beginFill(0,.8),a.drawRect(this.game.camera.x,this.game.camera.y,this.game.width,this.game.height),a.endFill(),this.menuGroup.add(a),e=new Phaser.Text(this.game,240,40,"Paused",{font:"helvetica",fontSize:18,fill:"#ffffff"}),e.fixedToCamera=!0,this.menuGroup.add(e),this.buttonDefinitions.forEach(function(e){t=new Phaser.Image(this.game,e.x,e.y,e.sprite),t.fixedToCamera=!0,this.menuGroup.add(t),this.buttons.push({x1:t.x,y1:t.y,x2:t.x+t.width,y2:t.y+t.height,callback:e.callback})}.bind(this))},Game.PauseMenu.prototype.handleInput=function(e){this.game.paused&&this.buttons.forEach(function(t){e.x>t.x1&&e.x<t.x2&&e.y>t.y1&&e.y<t.y2&&t.callback&&this[t.callback]()}.bind(this))},Game.PauseMenu.prototype.backToNavigation=function(){this.game.paused=!1,this.game.state.start("navigation")},Game.PauseMenu.prototype.resume=function(){this.game.paused=!1,this.pauseButton.visible=!0,this.menuGroup.visible=!1},Game.PauseMenu.prototype.restartLevel=function(){this.game.paused=!1,this.game.state.start(this.game.state.current)},Game.PauseMenu.prototype.showPauseMenu=function(){this.game.paused=!0,this.pauseButton.visible=!1,this.menuGroup.visible=!0},Game.PauseMenu.prototype.shareOnFacebook=function(){console.log("shared on Facebook")},Game.PauseMenu.prototype.shareOnTwitter=function(){console.log("shared on Twitter")},Game.Storage=function(e){this.storageName=e||"skynews-game",this.read()},Game.Storage.prototype.save=function(){localStorage.setItem(this.storageName,JSON.stringify(this.state))},Game.Storage.prototype.read=function(){this.state=JSON.parse(localStorage.getItem(this.storageName)||"{}")||{}},Game.Storage.prototype.set=function(e,t){this.state[e]=t,this.save()},Game.Storage.prototype.get=function(e){return this.state[e]},Game.State.BaseState=function(){this.levelKey=null,this.controls=null,this.collectibleItems=[],this.collectedItems=[],this.parallaxTextGroup=null,this.fixedTextGroup=null},Game.State.BaseState.prototype={TEXT_PARALLAX_SCALE:1.1,create:function(){this.game.analytics.stateStarted(this.levelKey),this.game.physics.arcade.gravity.y=600,this._createState(),this.game.fadePlugin.fadeIn(0,750,0)},addPlayer:function(){var e=this.levelModule.findObjectsByType("player_spawn");this.player=this.game.add.sprite(e[0].x,e[0].y-32,"player"),this.game.physics.arcade.enable(this.player),this.player.body.collideWorldBounds=!0,this.game.camera.follow(this.player),this.player.animations.add("left",[0,1],5,!0),this.player.animations.add("right",[3,4],5,!0)},addCollectibles:function(){this.collectibleItems=[];var e=this.levelModule.findCollectibleObjects();e.forEach(function(e){var t=this.game.add.sprite(e.x,e.y,e.properties.sprite_key);"jewel"!==e.properties.sprite_key&&(t._isArtefact=!0,t._revealFactId=e.properties.revealFactId,this.addArtefactEmitter(t)),t.properties=e.properties,this.game.physics.arcade.enable(t),t.body.allowGravity=!1,t.anchor=new Phaser.Point(.5,.5),this.collectibleItems.push(t)}.bind(this))},addArtefactEmitter:function(e){var t=this.game.add.emitter(e.x,e.y,10);t.makeParticles(["sparkle1","sparkle2","sparkle3"]),t.minParticleSpeed.setTo(-50,-50),t.maxParticleSpeed.setTo(50,50),t.gravity=-600,t.alpha=.5,t.minParticleAlpha=.7,t.maxParticleAlpha=1,t.minParticleScale=.5,t.maxParticleScale=1.5,t.start(!1,1e3,100),e._emitter=t},addNextLevelPortal:function(){var e=this.levelModule.findObjectsByType("next_level");e.length&&(this.nextLevel=this.game.add.sprite(e[0].x,e[0].y,"transparent_32-160"),this.game.physics.arcade.enable(this.nextLevel),this.nextLevel.body.allowGravity=!1,this.nextLevel.y-=110)},_createState:function(){var e;this.levelModule=new Game.Map.Module(this.game,this.levelKey),this.modules={},this.createBackgroundLayers&&"function"==typeof this.createBackgroundLayers&&this.createBackgroundLayers(),this.platform=this.levelModule.createLayer("platform"),this.platform.alpha=0,this.platform.resizeWorld(),this.addNextLevelPortal(),e=this.levelModule.findTextObjects(),this.factReference={},this.addPlayer(),this.addCollectibles(),this.controls=new Game.Controls(this.game,this.player),this.createForegroundLayers&&"function"==typeof this.createForegroundLayers&&this.createForegroundLayers(),e.forEach(function(e){"factoid"===e.properties.type?this.factReference[e.properties.id]=new Game.Map.Object.Factoid(this.game,e):new Game.Map.Object.FloatingText(this.game,e)}.bind(this)),this.setCollisions&&"function"==typeof this.setCollisions&&this.setCollisions(),this.scoreDisplay=new Game.LevelScore(this.game,this.levelKey,this.collectibleItems),this.pauseMenu=new Game.PauseMenu(this.game)},_collectiblesCollisionHandler:function(e,t){var a=null;t._emitter&&(t._emitter.on=!1),a=t,a.x=a.x-this.game.camera.x,a.y=a.y-this.game.camera.y,t.fixedToCamera=!0,a.body.destroy(),this.game.add.tween(a).to({alpha:0},500,"Linear",!0),this.game.add.tween(a.scale).to({x:3,y:3},250,Phaser.Easing.Quadratic.In,!0).chain(this.game.add.tween(a.scale).to({x:1,y:1},250,Phaser.Easing.Quadratic.Out)),this.game.add.tween(a.cameraOffset).to({y:-32},500,Phaser.Easing.Quadratic.InOut,!0),this.game.add.tween(a.cameraOffset).to({x:500},500,Phaser.Easing.Quadratic.InOut,!0).onComplete.add(a.destroy,a),this.collectedItems.push(a),this.itemCollectedHandler&&"function"==typeof this.itemCollectedHandler&&this.itemCollectedHandler(a),this.scoreDisplay.scoreItem(a.properties,this.levelKey),a._revealFactId&&this.factReference[a._revealFactId].reveal()},_nextLevelHandler:function(){var e=this.nextLevelKey;this.game.fadePlugin.fadeOut(0,750,0,function(){this.game.analytics.stateComplete(this.levelKey),Game.Score.allCollected()&&(e="end_screen"),this.game.state.start(e)}.bind(this))},update:function(){this._updateState(),this.updateState&&"function"==typeof this.updateState&&this.updateState()},_updateState:function(){this.parallaxTextGroup&&(this.parallaxTextGroup.x=this.game.world.x*this.TEXT_PARALLAX_SCALE),this.game.physics.arcade.collide(this.player,this.platform),this.game.physics.arcade.overlap(this.player,this.collectibleItems,this._collectiblesCollisionHandler,null,this),this.game.physics.arcade.overlap(this.player,this.nextLevel,this._nextLevelHandler,null,this),this.controls.update()}},Game.State.Decade_2010s=function(){},Game.State.Decade_2010s.prototype=new Game.State.BaseState,Game.State.Decade_2010s.prototype.levelKey="decade_2010s",Game.State.Decade_2010s.prototype.nextLevelKey="navigation",Game.State.Decade_2010s.prototype.setCollisions=function(){this.levelModule.tilemap.setCollisionBetween(834,849),this.levelModule.tilemap.setCollisionBetween(861,882)},Game.State.Decade_50s=function(){},Game.State.Decade_50s.prototype=new Game.State.BaseState,Game.State.Decade_50s.prototype.levelKey="decade_50s",Game.State.Decade_50s.prototype.nextLevelKey="decade_60s",Game.State.Decade_50s.prototype.setCollisions=function(){this.levelModule.tilemap.setCollision(76)},Game.State.Decade_50s.prototype.createBackgroundLayers=function(){this.levelModule.createLayer("background")},Game.State.Decade_50s.prototype.createForegroundLayers=function(){this.levelModule.createLayer("foreground")},Game.State.Decade_60s=function(){},Game.State.Decade_60s.prototype=new Game.State.BaseState,Game.State.Decade_60s.prototype.levelKey="decade_60s",Game.State.Decade_60s.prototype.nextLevelKey="decade_2010s",Game.State.Decade_60s.prototype.setCollisions=function(){this.levelModule.tilemap.setCollision(3)},Game.State.Decade_60s.prototype.createBackgroundLayers=function(){this.levelModule.createLayer("bg_colour"),this.levelModule.createLayer("background")},Game.State.Decade_60s.prototype.createForegroundLayers=function(){this.levelModule.createLayer("foreground")},Game.State.Decade_60s.prototype.updateState=function(){this.parallaxTextGroup.x=this.game.world.x*this.TEXT_PARALLAX_SCALE,this.parallaxTextGroup.y=this.game.world.y*this.TEXT_PARALLAX_SCALE},Game.State.EndScreen=function(){},Game.State.EndScreen.prototype={cursors:null,transitionning:!1,fixedTextOverlays:[{text:"Well done",size:100,x:20,y:20,alpha:.2},{text:"All royal artefacts have been returned!",size:20,x:20,y:120}],create:function(){this.game.analytics.gameCompleted(),this.transitionning=!1,this.createState(),this.game.fadePlugin.fadeIn(0,750,0)},createState:function(){var e=this.game.add.graphics(0,0);e.beginFill(0,1),e.drawRect(this.game.camera.x,this.game.camera.y,1.5*this.game.width,1.5*this.game.height),e.endFill(),this.textGroup=this.game.add.group(),this.textGroup.fixedToCamera=!1,this.textGroup.alpha=1,this.fixedTextOverlays.forEach(function(e){var t=new Phaser.BitmapText(this.game,e.x,e.y,"nokia",e.text,e.size);t.alpha=e.alpha||1,this.textGroup.add(t)}.bind(this)),this.game.add.button(this.game.width-120,this.game.height-50,"next_button",this.nextLevel,this),this.cursors=this.game.input.keyboard.createCursorKeys()},nextLevel:function(){this.transitionning||(this.transitionning=!0,this.game.fadePlugin.fadeOut(0,750,0,function(){this.game.state.start("navigation")}))}},Game.State.Intro_50s=function(){},Game.State.Intro_50s.prototype={cursors:null,transitionning:!1,fixedTextOverlays:[{text:"1950s",size:200,x:20,y:20,alpha:.2},{text:"Post-war Britain started the 1950s hard-up and hurting.\n\nFood rations were in place until 1954, there were unexploded bombs in the\rstreets, and Britain's international standing was shaken by the Suez crisis.\n\nBut by the end of the decade the UK had a new Queen, television sets,\rand rock n'roll.\n\nPrime Minister Harold MacMillan proclaimed 'most of\rour people have never had it so good'.",size:16,x:20,y:20}],create:function(){this.transitionning=!1,this.createState(),this.game.fadePlugin.fadeIn(0,750,0)},createState:function(){var e=this.game.add.graphics(0,0);e.beginFill(0,1),e.drawRect(this.game.camera.x,this.game.camera.y,1.5*this.game.width,1.5*this.game.height),e.endFill(),this.endTextGroup=this.game.add.group(),this.endTextGroup.fixedToCamera=!1,this.endTextGroup.alpha=1,this.fixedTextOverlays.forEach(function(e){var t=new Phaser.Text(this.game,e.x,e.y,e.text,{font:"helvetica",fontSize:e.size,fill:"#ffffff"});t.alpha=e.alpha||1,this.endTextGroup.add(t)}.bind(this)),this.game.add.button(this.game.width-120,this.game.height-50,"next_button",this.nextLevel,this),this.cursors=this.game.input.keyboard.createCursorKeys()},nextLevel:function(){this.transitionning||(this.transitionning=!0,this.game.fadePlugin.fadeOut(0,750,0,function(){this.game.state.start("decade_50s")}))}},Game.State.Intro_AlexsHouse=function(){},Game.State.Intro_AlexsHouse.prototype={cursors:null,transitionning:!1,create:function(){this.transitionning=!1,this.game.add.image(0,0,"alexs_house"),
this.game.add.button(this.game.width-120,this.game.height-50,"next_button",this.nextLevel,this),this.game.fadePlugin.fadeIn(0,750,0)},nextLevel:function(){this.transitionning||(this.transitionning=!0,this.game.fadePlugin.fadeOut(0,750,0,function(){this.game.state.start("navigation")}))}},Game.State.Intro_Skynews=function(){},Game.State.Intro_Skynews.prototype={cursors:null,transitionning:!1,create:function(){var e,t,a,s,i;this.game.analytics.stateStarted("intro"),this.transitionning=!1,this.game.stage.backgroundColor="#fff",this.game.add.image(0,0,"kay"),e=this.game.add.image(10,10,"skynews_logo"),t=this.game.add.image(0,300,"intro_ticker"),a=this.game.add.image(568,300,"intro_ticker"),s=this.game.add.group(),s.add(t),s.add(a),i=this.game.add.tween(s).to({x:-568},1e4,"Linear",!0),i.repeat(),this.clock=this.game.add.text(0,300," 00:00 ",{font:"16px Arial",fill:"#fff",backgroundColor:"black",boundsAlignV:"middle"}),this.speechText1=this.game.add.text(10,50,"A dastardly villain has travelled through time and stolen artifacts from the Queen's reign",{font:"16px Arial",fill:"#000",backgroundColor:"white",wordWrap:!0,wordWrapWidth:200}),this.speechText2=this.game.add.text(10,50,"Police are baffled. Won't somebody come forward and help? For our country!",{font:"16px Arial",fill:"#000",backgroundColor:"white",wordWrap:!0,wordWrapWidth:200}),this.speechText2.visible=!1,this.updateClock(),this.game.time.events.loop(Phaser.Timer.SECOND,this.updateClock,this),this.game.add.button(this.game.width-120,this.game.height-50,"next_button",this.nextFrame,this),this.game.fadePlugin.fadeIn(0,750,0)},nextFrame:function(){this.speechText1.visible?(this.speechText2.visible=!0,this.speechText1.visible=!1):this.nextLevel()},updateClock:function(){var e=new Date;this.clock.setText(" "+("0"+e.getHours()).slice(-2)+":"+("0"+e.getMinutes()).slice(-2)+" ")},nextLevel:function(){this.transitionning||(this.transitionning=!0,this.game.fadePlugin.fadeOut(0,750,0,function(){this.game.state.start("intro_alexs_house")}))}},Game.State.Navigation=function(){},Game.State.Navigation.prototype={cursors:null,transitionning:!1,buttonsOriginX:24,buttonsOriginY:24,buttonsMargin:30,buttonsPerRow:3,buttonHeight:48,buttonWidth:48,collectibleSize:10,create:function(){this.game.analytics.stateStarted("navigation"),this.transitionning=!1,this.createState(),this.game.fadePlugin.fadeIn(0,750,0)},createState:function(){var e=this.game.add.graphics(0,0),t=0,a=0;e.beginFill(0,1),e.drawRect(this.game.camera.x,this.game.camera.y,1.5*this.game.width,1.5*this.game.height),e.endFill(),this.buttonsGroup=this.game.add.group(),Game.Levels.forEach(function(e){var s,i,o,n=Game.Score.levelScores[e.stateKey],r=0;i=this.buttonsOriginX+a*(this.buttonWidth+this.buttonsMargin),o=this.buttonsOriginY+t*(this.buttonHeight+this.buttonsMargin),s=this.game.add.button(i,o,e.spriteKey,this.nextLevel,this),s.properties=e,e.collectibles.forEach(function(e){var t,a,s=i+18*r,l=o+this.buttonHeight+10,h=!1,c=6710886;n&&n.scoredItems.forEach(function(t){t.sprite_key===e&&(h=!0)}.bind(this)),"."===e?(h&&(c=16777215),t=this.game.add.graphics(0,0),t.properties={},t.properties.collectibleName=e,t.beginFill(c,1),t.drawRect(s,l,this.collectibleSize,this.collectibleSize),t.endFill()):(h||(e+="_grey"),t=this.game.add.sprite(s,l,e),a=Math.min(this.collectibleSize/t.width,this.collectibleSize/t.height),t.scale.setTo(a,a)),r++}.bind(this)),a+1>=this.buttonsPerRow?(a=0,t++):a++}.bind(this)),this.cursors=this.game.input.keyboard.createCursorKeys()},nextLevel:function(e){this.transitionning||(this.transitionning=!0,this.game.fadePlugin.fadeOut(0,750,0,function(){this.game.state.start(e.properties.stateKey||"tutorial")}))}},Game.State.Preloader=function(){},Game.State.Preloader.prototype={preload:function(){this.stage.backgroundColor="#000000",this.add.sprite(195,138,"crown"),this.textGroup=this.game.add.group(),this.textGroup.fixedToCamera=!0,this.textGroup.add(new Phaser.BitmapText(this.game,this.game.width/2-50,this.game.height/2-15,"pixeltype","Loading...",40)),this.game.load.image("intro_ticker","assets/sprites/intro-ticker.png"),this.game.load.image("skynews_logo","assets/sprites/8bit_sky_logo.png"),this.game.load.image("kay","assets/sprites/kayburley.png"),this.game.load.image("alexs_house","assets/sprites/alexshouse.png"),this.load.spritesheet("player","assets/sprites/alex_character.png",59,69,6),this.load.spritesheet("next_button","assets/sprites/next_button.png",100,30),this.game.load.image("sparkle1","assets/sprites/sparkle1.png"),this.game.load.image("sparkle2","assets/sprites/sparkle2.png"),this.game.load.image("sparkle3","assets/sprites/sparkle3.png"),this.game.load.image("transparent_32-160","assets/sprites/transparent_32-160.png"),this.game.load.image("jewel","assets/sprites/jewel.png"),this.game.load.image("jewel_grey","assets/sprites/jewel_grey.png"),this.game.load.image("corgi","assets/sprites/corgi.png"),this.game.load.image("corgi_grey","assets/sprites/corgi_grey.png"),this.game.load.image("crown_grey","assets/sprites/crown_grey.png"),this.game.load.image("tv","assets/sprites/50s_tv.png"),this.game.load.image("tv_grey","assets/sprites/50s_tv_grey.png"),this.game.load.image("record","assets/sprites/50s_record.png"),this.game.load.image("record_grey","assets/sprites/50s_record_grey.png"),this.game.load.image("mini","assets/sprites/50s_mini.png"),this.game.load.image("mini_grey","assets/sprites/50s_mini_grey.png"),this.game.load.image("beatles","assets/sprites/60s_beatles.png"),this.game.load.image("beatles_grey","assets/sprites/60s_beatles_grey.png"),this.game.load.image("worldcup","assets/sprites/60s_worldcup.png"),this.game.load.image("worldcup_grey","assets/sprites/60s_worldcup_grey.png"),this.game.load.image("the_sun","assets/sprites/60s_the_sun.png"),this.game.load.image("the_sun_grey","assets/sprites/60s_the_sun_grey.png"),this.game.load.image("button_level_50s","assets/sprites/level_buttons/level_50s.png"),this.game.load.image("button_level_60s","assets/sprites/level_buttons/level_60s.png"),this.game.load.image("button_level_70s","assets/sprites/level_buttons/level_70s.png"),this.game.load.image("button_level_80s","assets/sprites/level_buttons/level_80s.png"),this.game.load.image("button_level_90s","assets/sprites/level_buttons/level_90s.png"),this.game.load.image("button_level_00s","assets/sprites/level_buttons/level_00s.png"),this.game.load.image("button_level_10s","assets/sprites/level_buttons/level_10s.png"),this.load.image("compass","assets/sprites/compass_rose.png"),this.load.image("touch_segment","assets/sprites/touch_segment.png"),this.load.image("touch","assets/sprites/touch.png"),this.load.image("pause","assets/sprites/pause.png"),this.load.image("time_machine_button","assets/sprites/time-machine-button.png"),this.load.image("resume_button","assets/sprites/resume-button.png"),this.load.image("restart_level_button","assets/sprites/restart-level-button.png"),this.load.image("share_on_facebook","assets/sprites/share-on-facebook-button.png"),this.load.image("share_on_twitter","assets/sprites/share-on-twitter-button.png"),this.loadTileMaps()},loadTileMaps:function(){var e,t,a={};for(t=0;t<Game.Map.MAPS.length;t++)this.addTileSets(Game.Map.MAPS[t],a);for(e in a)a.hasOwnProperty(e)&&this.load.image(e,a[e])},addTileSets:function(e,t){var a,s,i,o=this.cache.getTilemapData(e).data.tilesets;for(i=0;i<o.length;i++)s=o[i].name,a="assets/maps/"+o[i].image,s in t||(t[s]=a)},create:function(){setTimeout(function(){this.game.fadePlugin.fadeOut(0,750,0,function(){this.game.state.start("intro_skynews")}.bind(this))}.bind(this),500)}},Game.State.Startup=function(){},Game.State.Startup.prototype={preload:function(){this.load.image("crown","assets/sprites/crown.png"),this.load.bitmapFont("nokia","assets/fonts/bitmapFonts/nokia.png","assets/fonts/bitmapFonts/nokia.xml"),this.load.bitmapFont("pixeltype","assets/fonts/bitmapFonts/pixeltype.png","assets/fonts/bitmapFonts/pixeltype.xml");var e,t;for(t=0;t<Game.Map.MAPS.length;t++)e=Game.Map.MAPS[t],this.load.tilemap(e,"assets/maps/"+e+".json",null,Phaser.Tilemap.TILED_JSON)},create:function(){this.game.scale.scaleMode=Phaser.ScaleManager.SHOW_ALL,this.game.fadePlugin=this.game.plugins.add(new Phaser.Plugin.Fade(this)),this.game.physics.startSystem(Phaser.Physics.ARCADE),this.game.state.start("preloader")}},Game.State.Tutorial=function(){},Game.State.Tutorial.prototype=new Game.State.BaseState,Game.State.Tutorial.prototype.levelKey="tutorial",Game.State.Tutorial.prototype.nextLevelKey="decade_50s",Game.State.Tutorial.prototype.setCollisions=function(){this.levelModule.tilemap.setCollisionBetween(76,84)},Game.State.Tutorial.prototype.createForegroundLayers=function(){this.banisterLayer=this.levelModule.createLayer("banisters"),this.columnLayer=this.levelModule.createLayer("columns")};var Game={};Game={},Game.State={},Game.Map={},Game.Map.Object={},Game.Score={nbCollectibles:0,nbCollected:0,levelScores:{},allCollected:function(){return this.nbCollectibles===this.nbCollected}},Game.Map.MAPS=["tutorial","decade_50s","decade_60s","decade_2010s"],Game.Levels=[{text:"50s",stateKey:"decade_50s",spriteKey:"button_level_50s",collectibles:["record","tv","mini"]},{text:"60s",stateKey:"decade_60s",spriteKey:"button_level_60s",collectibles:["beatles","the_sun","worldcup"]},{text:"70s",stateKey:null,spriteKey:"button_level_70s",collectibles:[".",".","."]},{text:"80s",stateKey:"tutorial",spriteKey:"button_level_80s",collectibles:["corgi",".","."]},{text:"90s",stateKey:null,spriteKey:"button_level_90s",collectibles:[".",".","."]},{text:"00s",stateKey:null,spriteKey:"button_level_00s",collectibles:[".",".","."]},{text:"10s",stateKey:"decade_2010s",spriteKey:"button_level_10s",collectibles:["corgi","crown","."]}],Game.init=function(){var e=new Phaser.Game(568,320,Phaser.AUTO,"main",null,!1,!1);this.game=e,e.analytics=Game.Analytics,e.storage=new Game.Storage("skynews-queen-feature-game"),e.state.add("startup",Game.State.Startup),e.state.add("preloader",Game.State.Preloader),e.state.add("intro_skynews",Game.State.Intro_Skynews),e.state.add("intro_alexs_house",Game.State.Intro_AlexsHouse),e.state.add("navigation",Game.State.Navigation),e.state.add("tutorial",Game.State.Tutorial),e.state.add("intro_50s",Game.State.Intro_50s),e.state.add("decade_50s",Game.State.Decade_50s),e.state.add("decade_60s",Game.State.Decade_60s),e.state.add("decade_2010s",Game.State.Decade_2010s),e.state.add("end_screen",Game.State.EndScreen),Game.Levels.forEach(function(e){e.collectibles.forEach(function(e){"."!==e&&this.Score.nbCollectibles++}.bind(this))}.bind(this)),Game.getCollectedItems(),e.state.start("startup")},Game.getCollectedItems=function(){this.Score.nbCollected=0,Game.Levels.forEach(function(e){var t=this.game.storage.get(e.stateKey);t&&t.scoredItems.forEach(function(e){"jewel"!==e.sprite_key&&this.Score.nbCollected++}.bind(this)),Game.Score.levelScores[e.stateKey]=t}.bind(this))},window.onload=function(){Game.init()},Phaser.Plugin.Fade=function(e,t){Phaser.Plugin.call(this,e,t)},Phaser.Plugin.Fade.prototype=Object.create(Phaser.Plugin.prototype),Phaser.Plugin.Fade.prototype.constructor=Phaser.Plugin.SamplePlugin,Phaser.Plugin.Fade.prototype.fadeOut=function(e,t,a,s){this.fade(e,t,a,0,1,s)},Phaser.Plugin.Fade.prototype.fadeIn=function(e,t,a,s){this.fade(e,t,a,1,0,s)},Phaser.Plugin.Fade.prototype.fade=function(e,t,a,s,i,o){a=a||0;var n,r=this.game.add.graphics(0,0);r.beginFill(e,1),r.drawRect(this.game.camera.x,this.game.camera.y,1.5*this.game.world.width,1.5*this.game.world.height),r.alpha=s,r.endFill(),n=this.game.add.tween(r),n.to({alpha:i},t,null),o&&n.onComplete.add(o,this),n.start()},Game.Analytics={stateStarted:function(e){this.sendEvent(["state started",e])},stateComplete:function(e){this.sendEvent(["state completed",e])},itemCollected:function(e){this.sendEvent(["item collected",e])},gameCompleted:function(){this.sendEvent(["game completed"])},sendEvent:function(e){setTimeout(function(){ga("send","event","The Reign Game",e[0],e[1])},1)}};var PLAYER_SPEED=200;Game.Controls=function(e,t){this.game=e,this.player=t,this.moving=!1,this.create()},Game.Controls.prototype.create=function(){this.cursors=this.game.input.keyboard.createCursorKeys()},Game.Controls.prototype.handleDown=function(e){this.moving?this.jump():(e.x<this.game.width/2?this.moveLeft():this.moveRight(),this.moving=!0)},Game.Controls.prototype.handleUp=function(){console.log(this.game.input.totalActivePointers),0===this.game.input.totalActivePointers?(this.player.animations.stop(),this.player.frame=2,this.player.body.velocity.x=0,this.moving=!1):this.handleDown(this.game.input.activePointer)},Game.Controls.prototype.moveLeft=function(){this.player.body.velocity.x=-PLAYER_SPEED,this.player.animations.play("left")},Game.Controls.prototype.moveRight=function(){this.player.body.velocity.x=PLAYER_SPEED,this.player.animations.play("right")},Game.Controls.prototype.jump=function(){this.player.body.onFloor()&&(this.player.body.velocity.y=-300)},Game.Controls.prototype.update=function(){var e=0;this.game.input.pointer1.isDown&&e++,this.game.input.pointer2.isDown&&e++,(this.cursors.up.isDown||e>1)&&this.jump(),1===e&&(this.activePointer=this.game.input.pointer1.isDown?this.game.input.pointer1:this.game.input.pointer2),this.cursors.left.isDown?this.moveLeft():this.cursors.right.isDown?this.moveRight():0===e&&(this.player.body.velocity.x=0,this.activePointer=null),this.activePointer&&(this.activePointer.x<this.game.width/2?this.moveLeft():this.activePointer.x>this.game.width/2&&this.moveRight()),0===this.player.body.velocity.x&&(this.player.animations.stop(),this.player.frame=2)};var FACTOID_TEXT_PADDING=10;Game.Map.Object.Factoid=function(e,t){this.game=e,this.text=new Phaser.Text(e,0,0,t.properties.text,{font:"20px silkscreennormal",wordWrap:!0,wordWrapWidth:32*t.properties.tiles,align:"center"}),this.bg=e.add.sprite(t.x,t.y,this._getBackground()),this.bg.anchor.set(.5,.5),this.text.anchor.set(.5,.5),this.bg.visible=!1,this.bg.addChild(this.text),this.emitter=e.add.emitter(t.x,t.y,100),this.emitter.makeParticles(["sparkle1","sparkle2","sparkle3"]),this.emitter.width=this.text.width,this.emitter.height=this.text.height,this.emitter.minParticleSpeed.setTo(-50,-50),this.emitter.maxParticleSpeed.setTo(50,50),this.emitter.gravity=-600,this.emitter.alpha=.5,this.emitter.minParticleAlpha=.7,this.emitter.maxParticleAlpha=1,this.emitter.minParticleScale=.5,this.emitter.maxParticleScale=1.5,this.emitter.start(!0)},Game.Map.Object.Factoid.prototype.reveal=function(){this.bg.visible=!0,this.bg.scale.x=.5,this.bg.scale.y=.5,this.bg.alpha=0,this.game.add.tween(this.bg.scale).to({x:1},1e3,Phaser.Easing.Bounce.Out,!0),this.game.add.tween(this.bg.scale).to({y:1},750,Phaser.Easing.Bounce.Out,!0),this.game.add.tween(this.bg).to({alpha:1},1e3,Phaser.Easing.Linear.None,!0),this.emitter.explode(1e3,100)},Game.Map.Object.Factoid.prototype._getBackground=function(){var e=this.text.width+5+2*FACTOID_TEXT_PADDING,t=this.text.height+2*FACTOID_TEXT_PADDING,a=this.game.add.bitmapData(e,t);return a.ctx.beginPath(),a.ctx.rect(0,0,e,t),a.ctx.fillStyle="rgba(255,255,255, 0.7)",a.ctx.strokeStyle="rgba(0,0,0,0.6)",a.ctx.lineWidth=5,a.ctx.fill(),a.ctx.stroke(),a},Game.Map.Object.FloatingText=function(e,t){this.game=e,this.text=e.add.text(t.x,t.y,t.properties.text,{font:"20px silkscreennormal",wordWrap:!0,wordWrapWidth:32*t.properties.tiles,align:"center",fill:"#000"}),this.text.anchor.set(.5,.5)},Game.LevelScore=function(e,t,a){this.game=e,this.sprites={},this.scoredItems=[],this.collectedItems=this.game.storage.get(t),this.collectibles=a,this.collectibleSize=16,this.addDisplay()},Game.LevelScore.prototype.addDisplay=function(){var e,t,a,s,i=this.game.width-33,o=!1;this.scoreGroup=this.game.add.group(),this.scoreGroup.fixedToCamera=!0,this.scoreText=new Phaser.BitmapText(this.game,i,7,"nokia","0",20),this.scoreGroup.add(this.scoreText),this.collectibles.forEach(function(n){if("jewel"===n.properties.sprite_key){if(!o){o=!0,i-=32;var r=this.game.add.sprite(i,0,"jewel");this.scoreGroup.add(r),i-=20}}else e=n.properties.sprite_key,this.collectedItems&&this.collectedItems.scoredItems.forEach(function(e){e.sprite_key===n.properties.sprite_key&&(t=!0)}),t||(e+="_grey"),a=this.game.add.sprite(i,7,e),s=Math.min(this.collectibleSize/a.width,this.collectibleSize/a.height),a.scale.setTo(s,s),this.scoreGroup.add(a),this.sprites[n.properties.sprite_key]=a,i-=a.width*s+16}.bind(this))},Game.LevelScore.prototype.scoreItem=function(e,t){this.game.analytics.itemCollected(e.sprite_key);var a=this.sprites[e.sprite_key];a&&a.loadTexture(e.sprite_key),this.scoredItems.push(e),Game.Score.levelScores[t]={scoredItems:this.scoredItems},"jewel"!==e.sprite_key&&Game.Score.nbCollected<Game.Score.nbCollectibles&&Game.Score.nbCollected++,this.game.storage.set(t,{scoredItems:this.scoredItems}),this.updatePoints(this.scoredItems)},Game.LevelScore.prototype.updatePoints=function(e){var t,a=0;e.forEach(function(e){t=e.score,typeof t!==Number&&(t=parseInt(t,10)),a+=t}),this.scoreText&&this.scoreText.setText(a)},Game.Map.Module=function(e,t){this.game=e,this.tilemap=e.add.tilemap(t);for(var a=0;a<this.tilemap.tilesets.length;a++)this.tilemap.addTilesetImage(this.tilemap.tilesets[a].name)},Game.Map.Module.prototype={createLayer:function(){return this.tilemap.createLayer.apply(this.tilemap,arguments)},createLayers:function(){var e,t,a={};for(t=0;t<arguments.length;t++)e=arguments[t],a[e]=this.tilemap.createLayer(e);return a},findTextObjects:function(){var e=this,t=[];return this.tilemap.objects.text&&this.tilemap.objects.text.forEach(function(a){a.y-=e.tilemap.tileHeight,a.properties.text=a.properties.text.replace(/\\n/g,"\n").replace(/\\r/g,"\r"),a.properties.size=a.properties.size||20,t.push(a)}),t},findCollectibleObjects:function(){var e=this,t=[];return this.tilemap.objects.collectibles&&this.tilemap.objects.collectibles.forEach(function(a){a.y-=e.tilemap.tileHeight,t.push(a)}),t},findObjectsByType:function(e){var t=this,a=[];return this.tilemap.objects.objects&&this.tilemap.objects.objects.forEach(function(s){s.type===e&&(s.y-=t.tilemap.tileHeight,a.push(s))}),a},getCollisionSprites:function(e,t,a,s){a=a||0,s=s||0;var i,o=this,n=[];return this.tilemap.objects[e].forEach(function(e){e.y-=o.tilemap.tileHeight,i=t.create(e.x+32*a,e.y+32*s),o.game.physics.arcade.enable(i),i.body.setSize(e.properties.width,e.properties.height),i.body.immovable=!0,n.push(i)}),n},spriteFromObject:function(e,t){var a=t.create(e.x,e.y,e.properties.sprite);return a.properties={},Object.keys(e.properties).forEach(function(t){a.properties[t]=e.properties[t]}),a}},Game.PauseMenu=function(e){this.game=e,this.buttonDefinitions=[{sprite:"time_machine_button",x:40,y:80,callback:"backToNavigation"},{sprite:"resume_button",x:40,y:120,callback:"resume"},{sprite:"restart_level_button",x:40,y:160,callback:"restartLevel"},{sprite:"share_on_facebook",x:40,y:200,callback:"shareOnFacebook"},{sprite:"share_on_twitter",x:40,y:240,callback:"shareOnTwitter"}],this.buttons=[],this.addPauseButton(),this.drawMenu(),this.game.input.onDown.add(this.handleInput,this)},Game.PauseMenu.prototype.addPauseButton=function(){this.pauseButton=this.game.add.button(10,10,"pause",this.showPauseMenu,this),this.pauseButton.fixedToCamera=!0},Game.PauseMenu.prototype.drawMenu=function(){var e,t,a;this.menuGroup=this.game.add.group(),this.menuGroup.visible=!1,a=this.game.add.graphics(0,0),a.fixedToCamera=!0,a.beginFill(0,.8),a.drawRect(this.game.camera.x,this.game.camera.y,this.game.width,this.game.height),a.endFill(),this.menuGroup.add(a),e=new Phaser.Text(this.game,240,40,"Paused",{font:"helvetica",fontSize:18,fill:"#ffffff"}),e.fixedToCamera=!0,this.menuGroup.add(e),this.buttonDefinitions.forEach(function(e){t=new Phaser.Image(this.game,e.x,e.y,e.sprite),t.fixedToCamera=!0,this.menuGroup.add(t),this.buttons.push({x1:t.x,y1:t.y,x2:t.x+t.width,y2:t.y+t.height,callback:e.callback})}.bind(this))},Game.PauseMenu.prototype.handleInput=function(e){this.game.paused&&this.buttons.forEach(function(t){e.x>t.x1&&e.x<t.x2&&e.y>t.y1&&e.y<t.y2&&t.callback&&this[t.callback]()}.bind(this))},Game.PauseMenu.prototype.backToNavigation=function(){this.game.paused=!1,this.game.state.start("navigation")},Game.PauseMenu.prototype.resume=function(){this.game.paused=!1,this.pauseButton.visible=!0,this.menuGroup.visible=!1},Game.PauseMenu.prototype.restartLevel=function(){this.game.paused=!1,this.game.state.start(this.game.state.current)},Game.PauseMenu.prototype.showPauseMenu=function(){this.game.paused=!0,this.pauseButton.visible=!1,this.menuGroup.visible=!0},Game.PauseMenu.prototype.shareOnFacebook=function(){console.log("shared on Facebook")},Game.PauseMenu.prototype.shareOnTwitter=function(){console.log("shared on Twitter")},Game.Storage=function(e){this.storageName=e||"skynews-game",this.read()},Game.Storage.prototype.save=function(){localStorage.setItem(this.storageName,JSON.stringify(this.state))},Game.Storage.prototype.read=function(){this.state=JSON.parse(localStorage.getItem(this.storageName)||"{}")||{}},Game.Storage.prototype.set=function(e,t){this.state[e]=t,this.save()},Game.Storage.prototype.get=function(e){return this.state[e]},Game.State.BaseState=function(){this.levelKey=null,this.controls=null,this.collectibleItems=[],this.collectedItems=[],this.parallaxTextGroup=null,this.fixedTextGroup=null},Game.State.BaseState.prototype={TEXT_PARALLAX_SCALE:1.1,create:function(){this.game.analytics.stateStarted(this.levelKey),this.game.physics.arcade.gravity.y=600,this._createState(),this.game.fadePlugin.fadeIn(0,750,0)},addPlayer:function(){var e=this.levelModule.findObjectsByType("player_spawn");this.player=this.game.add.sprite(e[0].x,e[0].y-32,"player"),this.game.physics.arcade.enable(this.player),this.player.body.collideWorldBounds=!0,this.game.camera.follow(this.player),this.player.animations.add("left",[0,1],5,!0),this.player.animations.add("right",[3,4],5,!0)},addCollectibles:function(){this.collectibleItems=[];var e=this.levelModule.findCollectibleObjects();e.forEach(function(e){var t=this.game.add.sprite(e.x,e.y,e.properties.sprite_key);"jewel"!==e.properties.sprite_key&&(t._isArtefact=!0,t._revealFactId=e.properties.revealFactId,this.addArtefactEmitter(t)),t.properties=e.properties,this.game.physics.arcade.enable(t),t.body.allowGravity=!1,t.anchor=new Phaser.Point(.5,.5),this.collectibleItems.push(t)}.bind(this))},addArtefactEmitter:function(e){var t=this.game.add.emitter(e.x,e.y,10);t.makeParticles(["sparkle1","sparkle2","sparkle3"]),t.minParticleSpeed.setTo(-50,-50),t.maxParticleSpeed.setTo(50,50),t.gravity=-600,t.alpha=.5,t.minParticleAlpha=.7,t.maxParticleAlpha=1,t.minParticleScale=.5,t.maxParticleScale=1.5,t.start(!1,1e3,100),e._emitter=t},addNextLevelPortal:function(){var e=this.levelModule.findObjectsByType("next_level");e.length&&(this.nextLevel=this.game.add.sprite(e[0].x,e[0].y,"transparent_32-160"),this.game.physics.arcade.enable(this.nextLevel),this.nextLevel.body.allowGravity=!1,this.nextLevel.y-=110)},_createState:function(){var e;this.levelModule=new Game.Map.Module(this.game,this.levelKey),this.modules={},this.createBackgroundLayers&&"function"==typeof this.createBackgroundLayers&&this.createBackgroundLayers(),this.platform=this.levelModule.createLayer("platform"),this.platform.alpha=0,this.platform.resizeWorld(),this.addNextLevelPortal(),e=this.levelModule.findTextObjects(),this.factReference={},this.addPlayer(),this.addCollectibles(),this.controls=new Game.Controls(this.game,this.player),this.createForegroundLayers&&"function"==typeof this.createForegroundLayers&&this.createForegroundLayers(),e.forEach(function(e){"factoid"===e.properties.type?this.factReference[e.properties.id]=new Game.Map.Object.Factoid(this.game,e):new Game.Map.Object.FloatingText(this.game,e)}.bind(this)),this.setCollisions&&"function"==typeof this.setCollisions&&this.setCollisions(),this.scoreDisplay=new Game.LevelScore(this.game,this.levelKey,this.collectibleItems),this.pauseMenu=new Game.PauseMenu(this.game)},_collectiblesCollisionHandler:function(e,t){var a=null;t._emitter&&(t._emitter.on=!1),a=t,a.x=a.x-this.game.camera.x,a.y=a.y-this.game.camera.y,t.fixedToCamera=!0,a.body.destroy(),this.game.add.tween(a).to({alpha:0},500,"Linear",!0),this.game.add.tween(a.scale).to({x:3,y:3},250,Phaser.Easing.Quadratic.In,!0).chain(this.game.add.tween(a.scale).to({x:1,y:1},250,Phaser.Easing.Quadratic.Out)),this.game.add.tween(a.cameraOffset).to({y:-32},500,Phaser.Easing.Quadratic.InOut,!0),this.game.add.tween(a.cameraOffset).to({x:500},500,Phaser.Easing.Quadratic.InOut,!0).onComplete.add(a.destroy,a),this.collectedItems.push(a),this.itemCollectedHandler&&"function"==typeof this.itemCollectedHandler&&this.itemCollectedHandler(a),this.scoreDisplay.scoreItem(a.properties,this.levelKey),a._revealFactId&&this.factReference[a._revealFactId].reveal()},_nextLevelHandler:function(){var e=this.nextLevelKey;this.game.fadePlugin.fadeOut(0,750,0,function(){this.game.analytics.stateComplete(this.levelKey),Game.Score.allCollected()&&(e="end_screen"),this.game.state.start(e)}.bind(this))},update:function(){this._updateState(),this.updateState&&"function"==typeof this.updateState&&this.updateState()},_updateState:function(){this.parallaxTextGroup&&(this.parallaxTextGroup.x=this.game.world.x*this.TEXT_PARALLAX_SCALE),this.game.physics.arcade.collide(this.player,this.platform),this.game.physics.arcade.overlap(this.player,this.collectibleItems,this._collectiblesCollisionHandler,null,this),this.game.physics.arcade.overlap(this.player,this.nextLevel,this._nextLevelHandler,null,this),this.controls.update()}},Game.State.Decade_2010s=function(){},Game.State.Decade_2010s.prototype=new Game.State.BaseState,Game.State.Decade_2010s.prototype.levelKey="decade_2010s",Game.State.Decade_2010s.prototype.nextLevelKey="navigation",Game.State.Decade_2010s.prototype.setCollisions=function(){this.levelModule.tilemap.setCollisionBetween(834,849),this.levelModule.tilemap.setCollisionBetween(861,882)},Game.State.Decade_50s=function(){},Game.State.Decade_50s.prototype=new Game.State.BaseState,Game.State.Decade_50s.prototype.levelKey="decade_50s",Game.State.Decade_50s.prototype.nextLevelKey="decade_60s",Game.State.Decade_50s.prototype.setCollisions=function(){this.levelModule.tilemap.setCollision(76)},Game.State.Decade_50s.prototype.createBackgroundLayers=function(){this.levelModule.createLayer("background")},Game.State.Decade_50s.prototype.createForegroundLayers=function(){this.levelModule.createLayer("foreground")},Game.State.Decade_60s=function(){},Game.State.Decade_60s.prototype=new Game.State.BaseState,Game.State.Decade_60s.prototype.levelKey="decade_60s",Game.State.Decade_60s.prototype.nextLevelKey="decade_2010s",Game.State.Decade_60s.prototype.setCollisions=function(){this.levelModule.tilemap.setCollision(3)},Game.State.Decade_60s.prototype.createBackgroundLayers=function(){this.levelModule.createLayer("bg_colour"),this.levelModule.createLayer("background")},Game.State.Decade_60s.prototype.createForegroundLayers=function(){this.levelModule.createLayer("foreground")},Game.State.Decade_60s.prototype.updateState=function(){this.parallaxTextGroup.x=this.game.world.x*this.TEXT_PARALLAX_SCALE,this.parallaxTextGroup.y=this.game.world.y*this.TEXT_PARALLAX_SCALE},Game.State.EndScreen=function(){},Game.State.EndScreen.prototype={cursors:null,transitionning:!1,fixedTextOverlays:[{text:"Well done",size:100,x:20,y:20,alpha:.2},{text:"All royal artefacts have been returned!",size:20,x:20,y:120}],create:function(){this.game.analytics.gameCompleted(),this.transitionning=!1,this.createState(),this.game.fadePlugin.fadeIn(0,750,0)},createState:function(){var e=this.game.add.graphics(0,0);e.beginFill(0,1),e.drawRect(this.game.camera.x,this.game.camera.y,1.5*this.game.width,1.5*this.game.height),e.endFill(),this.textGroup=this.game.add.group(),this.textGroup.fixedToCamera=!1,this.textGroup.alpha=1,this.fixedTextOverlays.forEach(function(e){var t=new Phaser.BitmapText(this.game,e.x,e.y,"nokia",e.text,e.size);t.alpha=e.alpha||1,this.textGroup.add(t)}.bind(this)),this.game.add.button(this.game.width-120,this.game.height-50,"next_button",this.nextLevel,this),this.cursors=this.game.input.keyboard.createCursorKeys()},nextLevel:function(){this.transitionning||(this.transitionning=!0,this.game.fadePlugin.fadeOut(0,750,0,function(){this.game.state.start("navigation")}))}},Game.State.Intro_50s=function(){},Game.State.Intro_50s.prototype={cursors:null,transitionning:!1,fixedTextOverlays:[{text:"1950s",size:200,x:20,y:20,alpha:.2},{text:"Post-war Britain started the 1950s hard-up and hurting.\n\nFood rations were in place until 1954, there were unexploded bombs in the\rstreets, and Britain's international standing was shaken by the Suez crisis.\n\nBut by the end of the decade the UK had a new Queen, television sets,\rand rock n'roll.\n\nPrime Minister Harold MacMillan proclaimed 'most of\rour people have never had it so good'.",size:16,x:20,y:20}],create:function(){this.transitionning=!1,this.createState(),this.game.fadePlugin.fadeIn(0,750,0)},createState:function(){var e=this.game.add.graphics(0,0);e.beginFill(0,1),e.drawRect(this.game.camera.x,this.game.camera.y,1.5*this.game.width,1.5*this.game.height),e.endFill(),this.endTextGroup=this.game.add.group(),this.endTextGroup.fixedToCamera=!1,this.endTextGroup.alpha=1,this.fixedTextOverlays.forEach(function(e){var t=new Phaser.Text(this.game,e.x,e.y,e.text,{font:"helvetica",fontSize:e.size,fill:"#ffffff"});t.alpha=e.alpha||1,this.endTextGroup.add(t)}.bind(this)),this.game.add.button(this.game.width-120,this.game.height-50,"next_button",this.nextLevel,this),this.cursors=this.game.input.keyboard.createCursorKeys()},nextLevel:function(){this.transitionning||(this.transitionning=!0,this.game.fadePlugin.fadeOut(0,750,0,function(){this.game.state.start("decade_50s")}))}},Game.State.Intro_AlexsHouse=function(){},Game.State.Intro_AlexsHouse.prototype={cursors:null,transitionning:!1,create:function(){this.transitionning=!1,this.game.add.image(0,0,"alexs_house"),this.game.add.button(this.game.width-120,this.game.height-50,"next_button",this.nextLevel,this),this.game.fadePlugin.fadeIn(0,750,0)},nextLevel:function(){this.transitionning||(this.transitionning=!0,this.game.fadePlugin.fadeOut(0,750,0,function(){this.game.state.start("navigation")}))}},Game.State.Intro_Skynews=function(){},Game.State.Intro_Skynews.prototype={cursors:null,transitionning:!1,create:function(){var e,t,a,s,i;this.game.analytics.stateStarted("intro"),this.transitionning=!1,this.game.stage.backgroundColor="#fff",this.game.add.image(0,0,"kay"),e=this.game.add.image(10,10,"skynews_logo"),t=this.game.add.image(0,300,"intro_ticker"),a=this.game.add.image(568,300,"intro_ticker"),s=this.game.add.group(),s.add(t),s.add(a),i=this.game.add.tween(s).to({x:-568},1e4,"Linear",!0),i.repeat(),this.clock=this.game.add.text(0,300," 00:00 ",{font:"16px Arial",fill:"#fff",backgroundColor:"black",boundsAlignV:"middle"}),this.speechText1=this.game.add.text(10,50,"A dastardly villain has travelled through time and stolen artifacts from the Queen's reign",{font:"16px Arial",fill:"#000",backgroundColor:"white",wordWrap:!0,wordWrapWidth:200}),this.speechText2=this.game.add.text(10,50,"Police are baffled. Won't somebody come forward and help? For our country!",{font:"16px Arial",fill:"#000",backgroundColor:"white",wordWrap:!0,wordWrapWidth:200}),this.speechText2.visible=!1,this.updateClock(),this.game.time.events.loop(Phaser.Timer.SECOND,this.updateClock,this),this.game.add.button(this.game.width-120,this.game.height-50,"next_button",this.nextFrame,this),this.game.fadePlugin.fadeIn(0,750,0)},nextFrame:function(){this.speechText1.visible?(this.speechText2.visible=!0,this.speechText1.visible=!1):this.nextLevel()},updateClock:function(){var e=new Date;this.clock.setText(" "+("0"+e.getHours()).slice(-2)+":"+("0"+e.getMinutes()).slice(-2)+" ")},nextLevel:function(){this.transitionning||(this.transitionning=!0,this.game.fadePlugin.fadeOut(0,750,0,function(){
this.game.state.start("intro_alexs_house")}))}},Game.State.Navigation=function(){},Game.State.Navigation.prototype={cursors:null,transitionning:!1,buttonsOriginX:24,buttonsOriginY:24,buttonsMargin:30,buttonsPerRow:3,buttonHeight:48,buttonWidth:48,collectibleSize:10,create:function(){this.game.analytics.stateStarted("navigation"),this.transitionning=!1,this.createState(),this.game.fadePlugin.fadeIn(0,750,0)},createState:function(){var e=this.game.add.graphics(0,0),t=0,a=0;e.beginFill(0,1),e.drawRect(this.game.camera.x,this.game.camera.y,1.5*this.game.width,1.5*this.game.height),e.endFill(),this.buttonsGroup=this.game.add.group(),Game.Levels.forEach(function(e){var s,i,o,n=Game.Score.levelScores[e.stateKey],r=0;i=this.buttonsOriginX+a*(this.buttonWidth+this.buttonsMargin),o=this.buttonsOriginY+t*(this.buttonHeight+this.buttonsMargin),s=this.game.add.button(i,o,e.spriteKey,this.nextLevel,this),s.properties=e,e.collectibles.forEach(function(e){var t,a,s=i+18*r,l=o+this.buttonHeight+10,h=!1,c=6710886;n&&n.scoredItems.forEach(function(t){t.sprite_key===e&&(h=!0)}.bind(this)),"."===e?(h&&(c=16777215),t=this.game.add.graphics(0,0),t.properties={},t.properties.collectibleName=e,t.beginFill(c,1),t.drawRect(s,l,this.collectibleSize,this.collectibleSize),t.endFill()):(h||(e+="_grey"),t=this.game.add.sprite(s,l,e),a=Math.min(this.collectibleSize/t.width,this.collectibleSize/t.height),t.scale.setTo(a,a)),r++}.bind(this)),a+1>=this.buttonsPerRow?(a=0,t++):a++}.bind(this)),this.cursors=this.game.input.keyboard.createCursorKeys()},nextLevel:function(e){this.transitionning||(this.transitionning=!0,this.game.fadePlugin.fadeOut(0,750,0,function(){this.game.state.start(e.properties.stateKey||"tutorial")}))}},Game.State.Preloader=function(){},Game.State.Preloader.prototype={preload:function(){this.stage.backgroundColor="#000000",this.add.sprite(195,138,"crown"),this.textGroup=this.game.add.group(),this.textGroup.fixedToCamera=!0,this.textGroup.add(new Phaser.BitmapText(this.game,this.game.width/2-50,this.game.height/2-15,"pixeltype","Loading...",40)),this.game.load.image("intro_ticker","assets/sprites/intro-ticker.png"),this.game.load.image("skynews_logo","assets/sprites/8bit_sky_logo.png"),this.game.load.image("kay","assets/sprites/kayburley.png"),this.game.load.image("alexs_house","assets/sprites/alexshouse.png"),this.load.spritesheet("player","assets/sprites/alex_character.png",59,69,6),this.load.spritesheet("next_button","assets/sprites/next_button.png",100,30),this.game.load.image("sparkle1","assets/sprites/sparkle1.png"),this.game.load.image("sparkle2","assets/sprites/sparkle2.png"),this.game.load.image("sparkle3","assets/sprites/sparkle3.png"),this.game.load.image("transparent_32-160","assets/sprites/transparent_32-160.png"),this.game.load.image("jewel","assets/sprites/jewel.png"),this.game.load.image("jewel_grey","assets/sprites/jewel_grey.png"),this.game.load.image("corgi","assets/sprites/corgi.png"),this.game.load.image("corgi_grey","assets/sprites/corgi_grey.png"),this.game.load.image("crown_grey","assets/sprites/crown_grey.png"),this.game.load.image("tv","assets/sprites/50s_tv.png"),this.game.load.image("tv_grey","assets/sprites/50s_tv_grey.png"),this.game.load.image("record","assets/sprites/50s_record.png"),this.game.load.image("record_grey","assets/sprites/50s_record_grey.png"),this.game.load.image("mini","assets/sprites/50s_mini.png"),this.game.load.image("mini_grey","assets/sprites/50s_mini_grey.png"),this.game.load.image("beatles","assets/sprites/60s_beatles.png"),this.game.load.image("beatles_grey","assets/sprites/60s_beatles_grey.png"),this.game.load.image("worldcup","assets/sprites/60s_worldcup.png"),this.game.load.image("worldcup_grey","assets/sprites/60s_worldcup_grey.png"),this.game.load.image("the_sun","assets/sprites/60s_the_sun.png"),this.game.load.image("the_sun_grey","assets/sprites/60s_the_sun_grey.png"),this.game.load.image("button_level_50s","assets/sprites/level_buttons/level_50s.png"),this.game.load.image("button_level_60s","assets/sprites/level_buttons/level_60s.png"),this.game.load.image("button_level_70s","assets/sprites/level_buttons/level_70s.png"),this.game.load.image("button_level_80s","assets/sprites/level_buttons/level_80s.png"),this.game.load.image("button_level_90s","assets/sprites/level_buttons/level_90s.png"),this.game.load.image("button_level_00s","assets/sprites/level_buttons/level_00s.png"),this.game.load.image("button_level_10s","assets/sprites/level_buttons/level_10s.png"),this.load.image("compass","assets/sprites/compass_rose.png"),this.load.image("touch_segment","assets/sprites/touch_segment.png"),this.load.image("touch","assets/sprites/touch.png"),this.load.image("pause","assets/sprites/pause.png"),this.load.image("time_machine_button","assets/sprites/time-machine-button.png"),this.load.image("resume_button","assets/sprites/resume-button.png"),this.load.image("restart_level_button","assets/sprites/restart-level-button.png"),this.load.image("share_on_facebook","assets/sprites/share-on-facebook-button.png"),this.load.image("share_on_twitter","assets/sprites/share-on-twitter-button.png"),this.loadTileMaps()},loadTileMaps:function(){var e,t,a={};for(t=0;t<Game.Map.MAPS.length;t++)this.addTileSets(Game.Map.MAPS[t],a);for(e in a)a.hasOwnProperty(e)&&this.load.image(e,a[e])},addTileSets:function(e,t){var a,s,i,o=this.cache.getTilemapData(e).data.tilesets;for(i=0;i<o.length;i++)s=o[i].name,a="assets/maps/"+o[i].image,s in t||(t[s]=a)},create:function(){setTimeout(function(){this.game.fadePlugin.fadeOut(0,750,0,function(){this.game.state.start("intro_skynews")}.bind(this))}.bind(this),500)}},Game.State.Startup=function(){},Game.State.Startup.prototype={preload:function(){this.load.image("crown","assets/sprites/crown.png"),this.load.bitmapFont("nokia","assets/fonts/bitmapFonts/nokia.png","assets/fonts/bitmapFonts/nokia.xml"),this.load.bitmapFont("pixeltype","assets/fonts/bitmapFonts/pixeltype.png","assets/fonts/bitmapFonts/pixeltype.xml");var e,t;for(t=0;t<Game.Map.MAPS.length;t++)e=Game.Map.MAPS[t],this.load.tilemap(e,"assets/maps/"+e+".json",null,Phaser.Tilemap.TILED_JSON)},create:function(){this.game.scale.scaleMode=Phaser.ScaleManager.SHOW_ALL,this.game.fadePlugin=this.game.plugins.add(new Phaser.Plugin.Fade(this)),this.game.physics.startSystem(Phaser.Physics.ARCADE),this.game.state.start("preloader")}},Game.State.Tutorial=function(){},Game.State.Tutorial.prototype=new Game.State.BaseState,Game.State.Tutorial.prototype.levelKey="tutorial",Game.State.Tutorial.prototype.nextLevelKey="decade_50s",Game.State.Tutorial.prototype.setCollisions=function(){this.levelModule.tilemap.setCollisionBetween(76,84)},Game.State.Tutorial.prototype.createForegroundLayers=function(){this.banisterLayer=this.levelModule.createLayer("banisters"),this.columnLayer=this.levelModule.createLayer("columns")};var Game={};Game={},Game.State={},Game.Map={},Game.Map.Object={},Game.Score={nbCollectibles:0,nbCollected:0,levelScores:{},allCollected:function(){return this.nbCollectibles===this.nbCollected}},Game.Map.MAPS=["tutorial","decade_50s","decade_60s","decade_2010s"],Game.Levels=[{text:"50s",stateKey:"decade_50s",spriteKey:"button_level_50s",collectibles:["record","tv","mini"]},{text:"60s",stateKey:"decade_60s",spriteKey:"button_level_60s",collectibles:["beatles","the_sun","worldcup"]},{text:"70s",stateKey:null,spriteKey:"button_level_70s",collectibles:[".",".","."]},{text:"80s",stateKey:"tutorial",spriteKey:"button_level_80s",collectibles:["corgi",".","."]},{text:"90s",stateKey:null,spriteKey:"button_level_90s",collectibles:[".",".","."]},{text:"00s",stateKey:null,spriteKey:"button_level_00s",collectibles:[".",".","."]},{text:"10s",stateKey:"decade_2010s",spriteKey:"button_level_10s",collectibles:["corgi","crown","."]}],Game.init=function(){var e=new Phaser.Game(568,320,Phaser.AUTO,"main",null,!1,!1);this.game=e,e.analytics=Game.Analytics,e.storage=new Game.Storage("skynews-queen-feature-game"),e.state.add("startup",Game.State.Startup),e.state.add("preloader",Game.State.Preloader),e.state.add("intro_skynews",Game.State.Intro_Skynews),e.state.add("intro_alexs_house",Game.State.Intro_AlexsHouse),e.state.add("navigation",Game.State.Navigation),e.state.add("tutorial",Game.State.Tutorial),e.state.add("intro_50s",Game.State.Intro_50s),e.state.add("decade_50s",Game.State.Decade_50s),e.state.add("decade_60s",Game.State.Decade_60s),e.state.add("decade_2010s",Game.State.Decade_2010s),e.state.add("end_screen",Game.State.EndScreen),Game.Levels.forEach(function(e){e.collectibles.forEach(function(e){"."!==e&&this.Score.nbCollectibles++}.bind(this))}.bind(this)),Game.getCollectedItems(),e.state.start("startup")},Game.getCollectedItems=function(){this.Score.nbCollected=0,Game.Levels.forEach(function(e){var t=this.game.storage.get(e.stateKey);t&&t.scoredItems.forEach(function(e){"jewel"!==e.sprite_key&&this.Score.nbCollected++}.bind(this)),Game.Score.levelScores[e.stateKey]=t}.bind(this))},window.onload=function(){Game.init()},Phaser.Plugin.Fade=function(e,t){Phaser.Plugin.call(this,e,t)},Phaser.Plugin.Fade.prototype=Object.create(Phaser.Plugin.prototype),Phaser.Plugin.Fade.prototype.constructor=Phaser.Plugin.SamplePlugin,Phaser.Plugin.Fade.prototype.fadeOut=function(e,t,a,s){this.fade(e,t,a,0,1,s)},Phaser.Plugin.Fade.prototype.fadeIn=function(e,t,a,s){this.fade(e,t,a,1,0,s)},Phaser.Plugin.Fade.prototype.fade=function(e,t,a,s,i,o){a=a||0;var n,r=this.game.add.graphics(0,0);r.beginFill(e,1),r.drawRect(this.game.camera.x,this.game.camera.y,1.5*this.game.world.width,1.5*this.game.world.height),r.alpha=s,r.endFill(),n=this.game.add.tween(r),n.to({alpha:i},t,null),o&&n.onComplete.add(o,this),n.start()},Game.Analytics={stateStarted:function(e){this.sendEvent(["state started",e])},stateComplete:function(e){this.sendEvent(["state completed",e])},itemCollected:function(e){this.sendEvent(["item collected",e])},gameCompleted:function(){this.sendEvent(["game completed"])},sendEvent:function(e){setTimeout(function(){ga("send","event","The Reign Game",e[0],e[1])},1)}};var PLAYER_SPEED=200;Game.Controls=function(e,t){this.game=e,this.player=t,this.moving=!1,this.create()},Game.Controls.prototype.create=function(){this.cursors=this.game.input.keyboard.createCursorKeys()},Game.Controls.prototype.handleDown=function(e){this.moving?this.jump():(e.x<this.game.width/2?this.moveLeft():this.moveRight(),this.moving=!0)},Game.Controls.prototype.handleUp=function(){console.log(this.game.input.totalActivePointers),0===this.game.input.totalActivePointers?(this.player.animations.stop(),this.player.frame=2,this.player.body.velocity.x=0,this.moving=!1):this.handleDown(this.game.input.activePointer)},Game.Controls.prototype.moveLeft=function(){this.player.body.velocity.x=-PLAYER_SPEED,this.player.animations.play("left")},Game.Controls.prototype.moveRight=function(){this.player.body.velocity.x=PLAYER_SPEED,this.player.animations.play("right")},Game.Controls.prototype.jump=function(){this.player.body.onFloor()&&(this.player.body.velocity.y=-300)},Game.Controls.prototype.update=function(){var e=0;this.game.input.pointer1.isDown&&e++,this.game.input.pointer2.isDown&&e++,(this.cursors.up.isDown||e>1)&&this.jump(),1===e&&(this.activePointer=this.game.input.pointer1.isDown?this.game.input.pointer1:this.game.input.pointer2),this.cursors.left.isDown?this.moveLeft():this.cursors.right.isDown?this.moveRight():0===e&&(this.player.body.velocity.x=0,this.activePointer=null),this.activePointer&&(this.activePointer.x<this.game.width/2?this.moveLeft():this.activePointer.x>this.game.width/2&&this.moveRight()),0===this.player.body.velocity.x&&(this.player.animations.stop(),this.player.frame=2)};var FACTOID_TEXT_PADDING=10;Game.Map.Object.Factoid=function(e,t){this.game=e,this.text=new Phaser.Text(e,0,0,t.properties.text,{font:"20px silkscreennormal",wordWrap:!0,wordWrapWidth:32*t.properties.tiles,align:"center"}),this.bg=e.add.sprite(t.x,t.y,this._getBackground()),this.bg.anchor.set(.5,.5),this.text.anchor.set(.5,.5),this.bg.visible=!1,this.bg.addChild(this.text),this.emitter=e.add.emitter(t.x,t.y,100),this.emitter.makeParticles(["sparkle1","sparkle2","sparkle3"]),this.emitter.width=this.text.width,this.emitter.height=this.text.height,this.emitter.minParticleSpeed.setTo(-50,-50),this.emitter.maxParticleSpeed.setTo(50,50),this.emitter.gravity=-600,this.emitter.alpha=.5,this.emitter.minParticleAlpha=.7,this.emitter.maxParticleAlpha=1,this.emitter.minParticleScale=.5,this.emitter.maxParticleScale=1.5,this.emitter.start(!0)},Game.Map.Object.Factoid.prototype.reveal=function(){this.bg.visible=!0,this.bg.scale.x=.5,this.bg.scale.y=.5,this.bg.alpha=0,this.game.add.tween(this.bg.scale).to({x:1},1e3,Phaser.Easing.Bounce.Out,!0),this.game.add.tween(this.bg.scale).to({y:1},750,Phaser.Easing.Bounce.Out,!0),this.game.add.tween(this.bg).to({alpha:1},1e3,Phaser.Easing.Linear.None,!0),this.emitter.explode(1e3,100)},Game.Map.Object.Factoid.prototype._getBackground=function(){var e=this.text.width+5+2*FACTOID_TEXT_PADDING,t=this.text.height+2*FACTOID_TEXT_PADDING,a=this.game.add.bitmapData(e,t);return a.ctx.beginPath(),a.ctx.rect(0,0,e,t),a.ctx.fillStyle="rgba(255,255,255, 0.7)",a.ctx.strokeStyle="rgba(0,0,0,0.6)",a.ctx.lineWidth=5,a.ctx.fill(),a.ctx.stroke(),a},Game.Map.Object.FloatingText=function(e,t){this.game=e,this.text=e.add.text(t.x,t.y,t.properties.text,{font:"20px silkscreennormal",wordWrap:!0,wordWrapWidth:32*t.properties.tiles,align:"center",fill:"#000"}),this.text.anchor.set(.5,.5)},Game.LevelScore=function(e,t,a){this.game=e,this.sprites={},this.scoredItems=[],this.collectedItems=this.game.storage.get(t),this.collectibles=a,this.collectibleSize=16,this.addDisplay()},Game.LevelScore.prototype.addDisplay=function(){var e,t,a,s,i=this.game.width-33,o=!1;this.scoreGroup=this.game.add.group(),this.scoreGroup.fixedToCamera=!0,this.scoreText=new Phaser.BitmapText(this.game,i,7,"nokia","0",20),this.scoreGroup.add(this.scoreText),this.collectibles.forEach(function(n){if("jewel"===n.properties.sprite_key){if(!o){o=!0,i-=32;var r=this.game.add.sprite(i,0,"jewel");this.scoreGroup.add(r),i-=20}}else e=n.properties.sprite_key,this.collectedItems&&this.collectedItems.scoredItems.forEach(function(e){e.sprite_key===n.properties.sprite_key&&(t=!0)}),t||(e+="_grey"),a=this.game.add.sprite(i,7,e),s=Math.min(this.collectibleSize/a.width,this.collectibleSize/a.height),a.scale.setTo(s,s),this.scoreGroup.add(a),this.sprites[n.properties.sprite_key]=a,i-=a.width*s+16}.bind(this))},Game.LevelScore.prototype.scoreItem=function(e,t){this.game.analytics.itemCollected(e.sprite_key);var a=this.sprites[e.sprite_key];a&&a.loadTexture(e.sprite_key),this.scoredItems.push(e),Game.Score.levelScores[t]={scoredItems:this.scoredItems},"jewel"!==e.sprite_key&&Game.Score.nbCollected<Game.Score.nbCollectibles&&Game.Score.nbCollected++,this.game.storage.set(t,{scoredItems:this.scoredItems}),this.updatePoints(this.scoredItems)},Game.LevelScore.prototype.updatePoints=function(e){var t,a=0;e.forEach(function(e){t=e.score,typeof t!==Number&&(t=parseInt(t,10)),a+=t}),this.scoreText&&this.scoreText.setText(a)},Game.Map.Module=function(e,t){this.game=e,this.tilemap=e.add.tilemap(t);for(var a=0;a<this.tilemap.tilesets.length;a++)this.tilemap.addTilesetImage(this.tilemap.tilesets[a].name)},Game.Map.Module.prototype={createLayer:function(){return this.tilemap.createLayer.apply(this.tilemap,arguments)},createLayers:function(){var e,t,a={};for(t=0;t<arguments.length;t++)e=arguments[t],a[e]=this.tilemap.createLayer(e);return a},findTextObjects:function(){var e=this,t=[];return this.tilemap.objects.text&&this.tilemap.objects.text.forEach(function(a){a.y-=e.tilemap.tileHeight,a.properties.text=a.properties.text.replace(/\\n/g,"\n").replace(/\\r/g,"\r"),a.properties.size=a.properties.size||20,t.push(a)}),t},findCollectibleObjects:function(){var e=this,t=[];return this.tilemap.objects.collectibles&&this.tilemap.objects.collectibles.forEach(function(a){a.y-=e.tilemap.tileHeight,t.push(a)}),t},findObjectsByType:function(e){var t=this,a=[];return this.tilemap.objects.objects&&this.tilemap.objects.objects.forEach(function(s){s.type===e&&(s.y-=t.tilemap.tileHeight,a.push(s))}),a},getCollisionSprites:function(e,t,a,s){a=a||0,s=s||0;var i,o=this,n=[];return this.tilemap.objects[e].forEach(function(e){e.y-=o.tilemap.tileHeight,i=t.create(e.x+32*a,e.y+32*s),o.game.physics.arcade.enable(i),i.body.setSize(e.properties.width,e.properties.height),i.body.immovable=!0,n.push(i)}),n},spriteFromObject:function(e,t){var a=t.create(e.x,e.y,e.properties.sprite);return a.properties={},Object.keys(e.properties).forEach(function(t){a.properties[t]=e.properties[t]}),a}},Game.PauseMenu=function(e){this.game=e,this.buttonDefinitions=[{sprite:"time_machine_button",x:40,y:80,callback:"backToNavigation"},{sprite:"resume_button",x:40,y:120,callback:"resume"},{sprite:"restart_level_button",x:40,y:160,callback:"restartLevel"},{sprite:"share_on_facebook",x:40,y:200,callback:"shareOnFacebook"},{sprite:"share_on_twitter",x:40,y:240,callback:"shareOnTwitter"}],this.buttons=[],this.addPauseButton(),this.drawMenu(),this.game.input.onDown.add(this.handleInput,this)},Game.PauseMenu.prototype.addPauseButton=function(){this.pauseButton=this.game.add.button(10,10,"pause",this.showPauseMenu,this),this.pauseButton.fixedToCamera=!0},Game.PauseMenu.prototype.drawMenu=function(){var e,t,a;this.menuGroup=this.game.add.group(),this.menuGroup.visible=!1,a=this.game.add.graphics(0,0),a.fixedToCamera=!0,a.beginFill(0,.8),a.drawRect(this.game.camera.x,this.game.camera.y,this.game.width,this.game.height),a.endFill(),this.menuGroup.add(a),e=new Phaser.Text(this.game,240,40,"Paused",{font:"helvetica",fontSize:18,fill:"#ffffff"}),e.fixedToCamera=!0,this.menuGroup.add(e),this.buttonDefinitions.forEach(function(e){t=new Phaser.Image(this.game,e.x,e.y,e.sprite),t.fixedToCamera=!0,this.menuGroup.add(t),this.buttons.push({x1:t.x,y1:t.y,x2:t.x+t.width,y2:t.y+t.height,callback:e.callback})}.bind(this))},Game.PauseMenu.prototype.handleInput=function(e){this.game.paused&&this.buttons.forEach(function(t){e.x>t.x1&&e.x<t.x2&&e.y>t.y1&&e.y<t.y2&&t.callback&&this[t.callback]()}.bind(this))},Game.PauseMenu.prototype.backToNavigation=function(){this.game.paused=!1,this.game.state.start("navigation")},Game.PauseMenu.prototype.resume=function(){this.game.paused=!1,this.pauseButton.visible=!0,this.menuGroup.visible=!1},Game.PauseMenu.prototype.restartLevel=function(){this.game.paused=!1,this.game.state.start(this.game.state.current)},Game.PauseMenu.prototype.showPauseMenu=function(){this.game.paused=!0,this.pauseButton.visible=!1,this.menuGroup.visible=!0},Game.PauseMenu.prototype.shareOnFacebook=function(){console.log("shared on Facebook")},Game.PauseMenu.prototype.shareOnTwitter=function(){console.log("shared on Twitter")},Game.Storage=function(e){this.storageName=e||"skynews-game",this.read()},Game.Storage.prototype.save=function(){localStorage.setItem(this.storageName,JSON.stringify(this.state))},Game.Storage.prototype.read=function(){this.state=JSON.parse(localStorage.getItem(this.storageName)||"{}")||{}},Game.Storage.prototype.set=function(e,t){this.state[e]=t,this.save()},Game.Storage.prototype.get=function(e){return this.state[e]},Game.State.BaseState=function(){this.levelKey=null,this.controls=null,this.collectibleItems=[],this.collectedItems=[],this.parallaxTextGroup=null,this.fixedTextGroup=null},Game.State.BaseState.prototype={TEXT_PARALLAX_SCALE:1.1,create:function(){this.game.analytics.stateStarted(this.levelKey),this.game.physics.arcade.gravity.y=600,this._createState(),this.game.fadePlugin.fadeIn(0,750,0)},addPlayer:function(){var e=this.levelModule.findObjectsByType("player_spawn");this.player=this.game.add.sprite(e[0].x,e[0].y-32,"player"),this.game.physics.arcade.enable(this.player),this.player.body.collideWorldBounds=!0,this.game.camera.follow(this.player),this.player.animations.add("left",[0,1],5,!0),this.player.animations.add("right",[3,4],5,!0)},addCollectibles:function(){this.collectibleItems=[];var e=this.levelModule.findCollectibleObjects();e.forEach(function(e){var t=this.game.add.sprite(e.x,e.y,e.properties.sprite_key);"jewel"!==e.properties.sprite_key&&(t._isArtefact=!0,t._revealFactId=e.properties.revealFactId,this.addArtefactEmitter(t)),t.properties=e.properties,this.game.physics.arcade.enable(t),t.body.allowGravity=!1,t.anchor=new Phaser.Point(.5,.5),this.collectibleItems.push(t)}.bind(this))},addArtefactEmitter:function(e){var t=this.game.add.emitter(e.x,e.y,10);t.makeParticles(["sparkle1","sparkle2","sparkle3"]),t.minParticleSpeed.setTo(-50,-50),t.maxParticleSpeed.setTo(50,50),t.gravity=-600,t.alpha=.5,t.minParticleAlpha=.7,t.maxParticleAlpha=1,t.minParticleScale=.5,t.maxParticleScale=1.5,t.start(!1,1e3,100),e._emitter=t},addNextLevelPortal:function(){var e=this.levelModule.findObjectsByType("next_level");e.length&&(this.nextLevel=this.game.add.sprite(e[0].x,e[0].y,"transparent_32-160"),this.game.physics.arcade.enable(this.nextLevel),this.nextLevel.body.allowGravity=!1,this.nextLevel.y-=110)},_createState:function(){var e;this.levelModule=new Game.Map.Module(this.game,this.levelKey),this.modules={},this.createBackgroundLayers&&"function"==typeof this.createBackgroundLayers&&this.createBackgroundLayers(),this.platform=this.levelModule.createLayer("platform"),this.platform.alpha=0,this.platform.resizeWorld(),this.addNextLevelPortal(),e=this.levelModule.findTextObjects(),this.factReference={},this.addPlayer(),this.addCollectibles(),this.controls=new Game.Controls(this.game,this.player),this.createForegroundLayers&&"function"==typeof this.createForegroundLayers&&this.createForegroundLayers(),e.forEach(function(e){"factoid"===e.properties.type?this.factReference[e.properties.id]=new Game.Map.Object.Factoid(this.game,e):new Game.Map.Object.FloatingText(this.game,e)}.bind(this)),this.setCollisions&&"function"==typeof this.setCollisions&&this.setCollisions(),this.scoreDisplay=new Game.LevelScore(this.game,this.levelKey,this.collectibleItems),this.pauseMenu=new Game.PauseMenu(this.game)},_collectiblesCollisionHandler:function(e,t){var a=null;t._emitter&&(t._emitter.on=!1),a=t,a.x=a.x-this.game.camera.x,a.y=a.y-this.game.camera.y,t.fixedToCamera=!0,a.body.destroy(),this.game.add.tween(a).to({alpha:0},500,"Linear",!0),this.game.add.tween(a.scale).to({x:3,y:3},250,Phaser.Easing.Quadratic.In,!0).chain(this.game.add.tween(a.scale).to({x:1,y:1},250,Phaser.Easing.Quadratic.Out)),this.game.add.tween(a.cameraOffset).to({y:-32},500,Phaser.Easing.Quadratic.InOut,!0),this.game.add.tween(a.cameraOffset).to({x:500},500,Phaser.Easing.Quadratic.InOut,!0).onComplete.add(a.destroy,a),this.collectedItems.push(a),this.itemCollectedHandler&&"function"==typeof this.itemCollectedHandler&&this.itemCollectedHandler(a),this.scoreDisplay.scoreItem(a.properties,this.levelKey),a._revealFactId&&this.factReference[a._revealFactId].reveal()},_nextLevelHandler:function(){var e=this.nextLevelKey;this.game.fadePlugin.fadeOut(0,750,0,function(){this.game.analytics.stateComplete(this.levelKey),Game.Score.allCollected()&&(e="end_screen"),this.game.state.start(e)}.bind(this))},update:function(){this._updateState(),this.updateState&&"function"==typeof this.updateState&&this.updateState()},_updateState:function(){this.parallaxTextGroup&&(this.parallaxTextGroup.x=this.game.world.x*this.TEXT_PARALLAX_SCALE),this.game.physics.arcade.collide(this.player,this.platform),this.game.physics.arcade.overlap(this.player,this.collectibleItems,this._collectiblesCollisionHandler,null,this),this.game.physics.arcade.overlap(this.player,this.nextLevel,this._nextLevelHandler,null,this),this.controls.update()}},Game.State.Decade_2010s=function(){},Game.State.Decade_2010s.prototype=new Game.State.BaseState,Game.State.Decade_2010s.prototype.levelKey="decade_2010s",Game.State.Decade_2010s.prototype.nextLevelKey="navigation",Game.State.Decade_2010s.prototype.setCollisions=function(){this.levelModule.tilemap.setCollisionBetween(834,849),this.levelModule.tilemap.setCollisionBetween(861,882)},Game.State.Decade_50s=function(){},Game.State.Decade_50s.prototype=new Game.State.BaseState,Game.State.Decade_50s.prototype.levelKey="decade_50s",Game.State.Decade_50s.prototype.nextLevelKey="decade_60s",Game.State.Decade_50s.prototype.setCollisions=function(){this.levelModule.tilemap.setCollision(76)},Game.State.Decade_50s.prototype.createBackgroundLayers=function(){this.levelModule.createLayer("background")},Game.State.Decade_50s.prototype.createForegroundLayers=function(){this.levelModule.createLayer("foreground")},Game.State.Decade_60s=function(){},Game.State.Decade_60s.prototype=new Game.State.BaseState,Game.State.Decade_60s.prototype.levelKey="decade_60s",Game.State.Decade_60s.prototype.nextLevelKey="decade_2010s",Game.State.Decade_60s.prototype.setCollisions=function(){this.levelModule.tilemap.setCollision(3)},Game.State.Decade_60s.prototype.createBackgroundLayers=function(){this.levelModule.createLayer("bg_colour"),this.levelModule.createLayer("background")},Game.State.Decade_60s.prototype.createForegroundLayers=function(){this.levelModule.createLayer("foreground")},Game.State.Decade_60s.prototype.updateState=function(){this.parallaxTextGroup.x=this.game.world.x*this.TEXT_PARALLAX_SCALE,this.parallaxTextGroup.y=this.game.world.y*this.TEXT_PARALLAX_SCALE},Game.State.EndScreen=function(){},Game.State.EndScreen.prototype={cursors:null,transitionning:!1,fixedTextOverlays:[{text:"Well done",size:100,x:20,y:20,alpha:.2},{text:"All royal artefacts have been returned!",size:20,x:20,y:120}],create:function(){this.game.analytics.gameCompleted(),this.transitionning=!1,this.createState(),this.game.fadePlugin.fadeIn(0,750,0)},createState:function(){var e=this.game.add.graphics(0,0);e.beginFill(0,1),e.drawRect(this.game.camera.x,this.game.camera.y,1.5*this.game.width,1.5*this.game.height),e.endFill(),this.textGroup=this.game.add.group(),this.textGroup.fixedToCamera=!1,this.textGroup.alpha=1,this.fixedTextOverlays.forEach(function(e){var t=new Phaser.BitmapText(this.game,e.x,e.y,"nokia",e.text,e.size);t.alpha=e.alpha||1,this.textGroup.add(t)}.bind(this)),this.game.add.button(this.game.width-120,this.game.height-50,"next_button",this.nextLevel,this),this.cursors=this.game.input.keyboard.createCursorKeys()},nextLevel:function(){this.transitionning||(this.transitionning=!0,this.game.fadePlugin.fadeOut(0,750,0,function(){this.game.state.start("navigation")}))}},Game.State.Intro_50s=function(){},Game.State.Intro_50s.prototype={cursors:null,transitionning:!1,fixedTextOverlays:[{text:"1950s",size:200,x:20,y:20,alpha:.2},{text:"Post-war Britain started the 1950s hard-up and hurting.\n\nFood rations were in place until 1954, there were unexploded bombs in the\rstreets, and Britain's international standing was shaken by the Suez crisis.\n\nBut by the end of the decade the UK had a new Queen, television sets,\rand rock n'roll.\n\nPrime Minister Harold MacMillan proclaimed 'most of\rour people have never had it so good'.",size:16,x:20,y:20}],create:function(){this.transitionning=!1,this.createState(),this.game.fadePlugin.fadeIn(0,750,0)},createState:function(){var e=this.game.add.graphics(0,0);e.beginFill(0,1),e.drawRect(this.game.camera.x,this.game.camera.y,1.5*this.game.width,1.5*this.game.height),e.endFill(),this.endTextGroup=this.game.add.group(),this.endTextGroup.fixedToCamera=!1,this.endTextGroup.alpha=1,this.fixedTextOverlays.forEach(function(e){var t=new Phaser.Text(this.game,e.x,e.y,e.text,{font:"helvetica",fontSize:e.size,fill:"#ffffff"});t.alpha=e.alpha||1,this.endTextGroup.add(t)}.bind(this)),this.game.add.button(this.game.width-120,this.game.height-50,"next_button",this.nextLevel,this),this.cursors=this.game.input.keyboard.createCursorKeys()},nextLevel:function(){this.transitionning||(this.transitionning=!0,this.game.fadePlugin.fadeOut(0,750,0,function(){this.game.state.start("decade_50s")}))}},Game.State.Intro_AlexsHouse=function(){},Game.State.Intro_AlexsHouse.prototype={cursors:null,transitionning:!1,create:function(){this.transitionning=!1,this.game.add.image(0,0,"alexs_house"),this.game.add.button(this.game.width-120,this.game.height-50,"next_button",this.nextLevel,this),this.game.fadePlugin.fadeIn(0,750,0)},nextLevel:function(){this.transitionning||(this.transitionning=!0,this.game.fadePlugin.fadeOut(0,750,0,function(){this.game.state.start("navigation")}))}},Game.State.Intro_Skynews=function(){},Game.State.Intro_Skynews.prototype={cursors:null,transitionning:!1,create:function(){var e,t,a,s,i;this.game.analytics.stateStarted("intro"),this.transitionning=!1,this.game.stage.backgroundColor="#fff",this.game.add.image(0,0,"kay"),e=this.game.add.image(10,10,"skynews_logo"),t=this.game.add.image(0,300,"intro_ticker"),a=this.game.add.image(568,300,"intro_ticker"),s=this.game.add.group(),s.add(t),s.add(a),i=this.game.add.tween(s).to({x:-568},1e4,"Linear",!0),i.repeat(),this.clock=this.game.add.text(0,300," 00:00 ",{font:"16px Arial",fill:"#fff",backgroundColor:"black",boundsAlignV:"middle"}),this.speechText1=this.game.add.text(10,50,"A dastardly villain has travelled through time and stolen artifacts from the Queen's reign",{font:"16px Arial",fill:"#000",backgroundColor:"white",wordWrap:!0,wordWrapWidth:200}),this.speechText2=this.game.add.text(10,50,"Police are baffled. Won't somebody come forward and help? For our country!",{font:"16px Arial",fill:"#000",backgroundColor:"white",wordWrap:!0,wordWrapWidth:200}),this.speechText2.visible=!1,this.updateClock(),this.game.time.events.loop(Phaser.Timer.SECOND,this.updateClock,this),this.game.add.button(this.game.width-120,this.game.height-50,"next_button",this.nextFrame,this),this.game.fadePlugin.fadeIn(0,750,0)},nextFrame:function(){this.speechText1.visible?(this.speechText2.visible=!0,this.speechText1.visible=!1):this.nextLevel()},updateClock:function(){var e=new Date;this.clock.setText(" "+("0"+e.getHours()).slice(-2)+":"+("0"+e.getMinutes()).slice(-2)+" ")},nextLevel:function(){this.transitionning||(this.transitionning=!0,this.game.fadePlugin.fadeOut(0,750,0,function(){this.game.state.start("intro_alexs_house")}))}},Game.State.Navigation=function(){},Game.State.Navigation.prototype={cursors:null,transitionning:!1,buttonsOriginX:24,buttonsOriginY:24,buttonsMargin:30,buttonsPerRow:3,buttonHeight:48,buttonWidth:48,collectibleSize:10,create:function(){this.game.analytics.stateStarted("navigation"),this.transitionning=!1,this.createState(),this.game.fadePlugin.fadeIn(0,750,0)},createState:function(){var e=this.game.add.graphics(0,0),t=0,a=0;e.beginFill(0,1),e.drawRect(this.game.camera.x,this.game.camera.y,1.5*this.game.width,1.5*this.game.height),e.endFill(),this.buttonsGroup=this.game.add.group(),Game.Levels.forEach(function(e){var s,i,o,n=Game.Score.levelScores[e.stateKey],r=0;i=this.buttonsOriginX+a*(this.buttonWidth+this.buttonsMargin),o=this.buttonsOriginY+t*(this.buttonHeight+this.buttonsMargin),s=this.game.add.button(i,o,e.spriteKey,this.nextLevel,this),s.properties=e,e.collectibles.forEach(function(e){var t,a,s=i+18*r,l=o+this.buttonHeight+10,h=!1,c=6710886;n&&n.scoredItems.forEach(function(t){t.sprite_key===e&&(h=!0)}.bind(this)),"."===e?(h&&(c=16777215),t=this.game.add.graphics(0,0),t.properties={},t.properties.collectibleName=e,t.beginFill(c,1),t.drawRect(s,l,this.collectibleSize,this.collectibleSize),t.endFill()):(h||(e+="_grey"),t=this.game.add.sprite(s,l,e),a=Math.min(this.collectibleSize/t.width,this.collectibleSize/t.height),t.scale.setTo(a,a)),r++}.bind(this)),a+1>=this.buttonsPerRow?(a=0,t++):a++}.bind(this)),this.cursors=this.game.input.keyboard.createCursorKeys()},nextLevel:function(e){this.transitionning||(this.transitionning=!0,this.game.fadePlugin.fadeOut(0,750,0,function(){this.game.state.start(e.properties.stateKey||"tutorial")}))}},Game.State.Preloader=function(){},Game.State.Preloader.prototype={preload:function(){this.stage.backgroundColor="#000000",this.add.sprite(195,138,"crown"),this.textGroup=this.game.add.group(),this.textGroup.fixedToCamera=!0,this.textGroup.add(new Phaser.BitmapText(this.game,this.game.width/2-50,this.game.height/2-15,"pixeltype","Loading...",40)),
this.game.load.image("intro_ticker","assets/sprites/intro-ticker.png"),this.game.load.image("skynews_logo","assets/sprites/8bit_sky_logo.png"),this.game.load.image("kay","assets/sprites/kayburley.png"),this.game.load.image("alexs_house","assets/sprites/alexshouse.png"),this.load.spritesheet("player","assets/sprites/alex_character.png",59,69,6),this.load.spritesheet("next_button","assets/sprites/next_button.png",100,30),this.game.load.image("sparkle1","assets/sprites/sparkle1.png"),this.game.load.image("sparkle2","assets/sprites/sparkle2.png"),this.game.load.image("sparkle3","assets/sprites/sparkle3.png"),this.game.load.image("transparent_32-160","assets/sprites/transparent_32-160.png"),this.game.load.image("jewel","assets/sprites/jewel.png"),this.game.load.image("jewel_grey","assets/sprites/jewel_grey.png"),this.game.load.image("corgi","assets/sprites/corgi.png"),this.game.load.image("corgi_grey","assets/sprites/corgi_grey.png"),this.game.load.image("crown_grey","assets/sprites/crown_grey.png"),this.game.load.image("tv","assets/sprites/50s_tv.png"),this.game.load.image("tv_grey","assets/sprites/50s_tv_grey.png"),this.game.load.image("record","assets/sprites/50s_record.png"),this.game.load.image("record_grey","assets/sprites/50s_record_grey.png"),this.game.load.image("mini","assets/sprites/50s_mini.png"),this.game.load.image("mini_grey","assets/sprites/50s_mini_grey.png"),this.game.load.image("beatles","assets/sprites/60s_beatles.png"),this.game.load.image("beatles_grey","assets/sprites/60s_beatles_grey.png"),this.game.load.image("worldcup","assets/sprites/60s_worldcup.png"),this.game.load.image("worldcup_grey","assets/sprites/60s_worldcup_grey.png"),this.game.load.image("the_sun","assets/sprites/60s_the_sun.png"),this.game.load.image("the_sun_grey","assets/sprites/60s_the_sun_grey.png"),this.game.load.image("button_level_50s","assets/sprites/level_buttons/level_50s.png"),this.game.load.image("button_level_60s","assets/sprites/level_buttons/level_60s.png"),this.game.load.image("button_level_70s","assets/sprites/level_buttons/level_70s.png"),this.game.load.image("button_level_80s","assets/sprites/level_buttons/level_80s.png"),this.game.load.image("button_level_90s","assets/sprites/level_buttons/level_90s.png"),this.game.load.image("button_level_00s","assets/sprites/level_buttons/level_00s.png"),this.game.load.image("button_level_10s","assets/sprites/level_buttons/level_10s.png"),this.load.image("compass","assets/sprites/compass_rose.png"),this.load.image("touch_segment","assets/sprites/touch_segment.png"),this.load.image("touch","assets/sprites/touch.png"),this.load.image("pause","assets/sprites/pause.png"),this.load.image("time_machine_button","assets/sprites/time-machine-button.png"),this.load.image("resume_button","assets/sprites/resume-button.png"),this.load.image("restart_level_button","assets/sprites/restart-level-button.png"),this.load.image("share_on_facebook","assets/sprites/share-on-facebook-button.png"),this.load.image("share_on_twitter","assets/sprites/share-on-twitter-button.png"),this.loadTileMaps()},loadTileMaps:function(){var e,t,a={};for(t=0;t<Game.Map.MAPS.length;t++)this.addTileSets(Game.Map.MAPS[t],a);for(e in a)a.hasOwnProperty(e)&&this.load.image(e,a[e])},addTileSets:function(e,t){var a,s,i,o=this.cache.getTilemapData(e).data.tilesets;for(i=0;i<o.length;i++)s=o[i].name,a="assets/maps/"+o[i].image,s in t||(t[s]=a)},create:function(){setTimeout(function(){this.game.fadePlugin.fadeOut(0,750,0,function(){this.game.state.start("intro_skynews")}.bind(this))}.bind(this),500)}},Game.State.Startup=function(){},Game.State.Startup.prototype={preload:function(){this.load.image("crown","assets/sprites/crown.png"),this.load.bitmapFont("nokia","assets/fonts/bitmapFonts/nokia.png","assets/fonts/bitmapFonts/nokia.xml"),this.load.bitmapFont("pixeltype","assets/fonts/bitmapFonts/pixeltype.png","assets/fonts/bitmapFonts/pixeltype.xml");var e,t;for(t=0;t<Game.Map.MAPS.length;t++)e=Game.Map.MAPS[t],this.load.tilemap(e,"assets/maps/"+e+".json",null,Phaser.Tilemap.TILED_JSON)},create:function(){this.game.scale.scaleMode=Phaser.ScaleManager.SHOW_ALL,this.game.fadePlugin=this.game.plugins.add(new Phaser.Plugin.Fade(this)),this.game.physics.startSystem(Phaser.Physics.ARCADE),this.game.state.start("preloader")}},Game.State.Tutorial=function(){},Game.State.Tutorial.prototype=new Game.State.BaseState,Game.State.Tutorial.prototype.levelKey="tutorial",Game.State.Tutorial.prototype.nextLevelKey="decade_50s",Game.State.Tutorial.prototype.setCollisions=function(){this.levelModule.tilemap.setCollisionBetween(76,84)},Game.State.Tutorial.prototype.createForegroundLayers=function(){this.banisterLayer=this.levelModule.createLayer("banisters"),this.columnLayer=this.levelModule.createLayer("columns")};var Game={};Game={},Game.State={},Game.Map={},Game.Map.Object={},Game.Score={nbCollectibles:0,nbCollected:0,levelScores:{},allCollected:function(){return this.nbCollectibles===this.nbCollected}},Game.Map.MAPS=["tutorial","decade_50s","decade_60s","decade_2010s"],Game.Levels=[{text:"50s",stateKey:"decade_50s",spriteKey:"button_level_50s",collectibles:["record","tv","mini"]},{text:"60s",stateKey:"decade_60s",spriteKey:"button_level_60s",collectibles:["beatles","the_sun","worldcup"]},{text:"70s",stateKey:null,spriteKey:"button_level_70s",collectibles:[".",".","."]},{text:"80s",stateKey:"tutorial",spriteKey:"button_level_80s",collectibles:["corgi",".","."]},{text:"90s",stateKey:null,spriteKey:"button_level_90s",collectibles:[".",".","."]},{text:"00s",stateKey:null,spriteKey:"button_level_00s",collectibles:[".",".","."]},{text:"10s",stateKey:"decade_2010s",spriteKey:"button_level_10s",collectibles:["corgi","crown","."]}],Game.init=function(){var e=new Phaser.Game(568,320,Phaser.AUTO,"main",null,!1,!1);this.game=e,e.analytics=Game.Analytics,e.storage=new Game.Storage("skynews-queen-feature-game"),e.state.add("startup",Game.State.Startup),e.state.add("preloader",Game.State.Preloader),e.state.add("intro_skynews",Game.State.Intro_Skynews),e.state.add("intro_alexs_house",Game.State.Intro_AlexsHouse),e.state.add("navigation",Game.State.Navigation),e.state.add("tutorial",Game.State.Tutorial),e.state.add("intro_50s",Game.State.Intro_50s),e.state.add("decade_50s",Game.State.Decade_50s),e.state.add("decade_60s",Game.State.Decade_60s),e.state.add("decade_2010s",Game.State.Decade_2010s),e.state.add("end_screen",Game.State.EndScreen),Game.Levels.forEach(function(e){e.collectibles.forEach(function(e){"."!==e&&this.Score.nbCollectibles++}.bind(this))}.bind(this)),Game.getCollectedItems(),e.state.start("startup")},Game.getCollectedItems=function(){this.Score.nbCollected=0,Game.Levels.forEach(function(e){var t=this.game.storage.get(e.stateKey);t&&t.scoredItems.forEach(function(e){"jewel"!==e.sprite_key&&this.Score.nbCollected++}.bind(this)),Game.Score.levelScores[e.stateKey]=t}.bind(this))},window.onload=function(){Game.init()},Phaser.Plugin.Fade=function(e,t){Phaser.Plugin.call(this,e,t)},Phaser.Plugin.Fade.prototype=Object.create(Phaser.Plugin.prototype),Phaser.Plugin.Fade.prototype.constructor=Phaser.Plugin.SamplePlugin,Phaser.Plugin.Fade.prototype.fadeOut=function(e,t,a,s){this.fade(e,t,a,0,1,s)},Phaser.Plugin.Fade.prototype.fadeIn=function(e,t,a,s){this.fade(e,t,a,1,0,s)},Phaser.Plugin.Fade.prototype.fade=function(e,t,a,s,i,o){a=a||0;var n,r=this.game.add.graphics(0,0);r.beginFill(e,1),r.drawRect(this.game.camera.x,this.game.camera.y,1.5*this.game.world.width,1.5*this.game.world.height),r.alpha=s,r.endFill(),n=this.game.add.tween(r),n.to({alpha:i},t,null),o&&n.onComplete.add(o,this),n.start()},Game.Analytics={stateStarted:function(e){this.sendEvent(["state started",e])},stateComplete:function(e){this.sendEvent(["state completed",e])},itemCollected:function(e){this.sendEvent(["item collected",e])},gameCompleted:function(){this.sendEvent(["game completed"])},sendEvent:function(e){setTimeout(function(){ga("send","event","The Reign Game",e[0],e[1])},1)}};var PLAYER_SPEED=200;Game.Controls=function(e,t){this.game=e,this.player=t,this.moving=!1,this.create()},Game.Controls.prototype.create=function(){this.cursors=this.game.input.keyboard.createCursorKeys()},Game.Controls.prototype.handleDown=function(e){this.moving?this.jump():(e.x<this.game.width/2?this.moveLeft():this.moveRight(),this.moving=!0)},Game.Controls.prototype.handleUp=function(){console.log(this.game.input.totalActivePointers),0===this.game.input.totalActivePointers?(this.player.animations.stop(),this.player.frame=2,this.player.body.velocity.x=0,this.moving=!1):this.handleDown(this.game.input.activePointer)},Game.Controls.prototype.moveLeft=function(){this.player.body.velocity.x=-PLAYER_SPEED,this.player.animations.play("left")},Game.Controls.prototype.moveRight=function(){this.player.body.velocity.x=PLAYER_SPEED,this.player.animations.play("right")},Game.Controls.prototype.jump=function(){this.player.body.onFloor()&&(this.player.body.velocity.y=-300)},Game.Controls.prototype.update=function(){var e=0;this.game.input.pointer1.isDown&&e++,this.game.input.pointer2.isDown&&e++,(this.cursors.up.isDown||e>1)&&this.jump(),1===e&&(this.activePointer=this.game.input.pointer1.isDown?this.game.input.pointer1:this.game.input.pointer2),this.cursors.left.isDown?this.moveLeft():this.cursors.right.isDown?this.moveRight():0===e&&(this.player.body.velocity.x=0,this.activePointer=null),this.activePointer&&(this.activePointer.x<this.game.width/2?this.moveLeft():this.activePointer.x>this.game.width/2&&this.moveRight()),0===this.player.body.velocity.x&&(this.player.animations.stop(),this.player.frame=2)};var FACTOID_TEXT_PADDING=10;Game.Map.Object.Factoid=function(e,t){this.game=e,this.text=new Phaser.Text(e,0,0,t.properties.text,{font:"20px silkscreennormal",wordWrap:!0,wordWrapWidth:32*t.properties.tiles,align:"center"}),this.bg=e.add.sprite(t.x,t.y,this._getBackground()),this.bg.anchor.set(.5,.5),this.text.anchor.set(.5,.5),this.bg.visible=!1,this.bg.addChild(this.text),this.emitter=e.add.emitter(t.x,t.y,100),this.emitter.makeParticles(["sparkle1","sparkle2","sparkle3"]),this.emitter.width=this.text.width,this.emitter.height=this.text.height,this.emitter.minParticleSpeed.setTo(-50,-50),this.emitter.maxParticleSpeed.setTo(50,50),this.emitter.gravity=-600,this.emitter.alpha=.5,this.emitter.minParticleAlpha=.7,this.emitter.maxParticleAlpha=1,this.emitter.minParticleScale=.5,this.emitter.maxParticleScale=1.5,this.emitter.start(!0)},Game.Map.Object.Factoid.prototype.reveal=function(){this.bg.visible=!0,this.bg.scale.x=.5,this.bg.scale.y=.5,this.bg.alpha=0,this.game.add.tween(this.bg.scale).to({x:1},1e3,Phaser.Easing.Bounce.Out,!0),this.game.add.tween(this.bg.scale).to({y:1},750,Phaser.Easing.Bounce.Out,!0),this.game.add.tween(this.bg).to({alpha:1},1e3,Phaser.Easing.Linear.None,!0),this.emitter.explode(1e3,100)},Game.Map.Object.Factoid.prototype._getBackground=function(){var e=this.text.width+5+2*FACTOID_TEXT_PADDING,t=this.text.height+2*FACTOID_TEXT_PADDING,a=this.game.add.bitmapData(e,t);return a.ctx.beginPath(),a.ctx.rect(0,0,e,t),a.ctx.fillStyle="rgba(255,255,255, 0.7)",a.ctx.strokeStyle="rgba(0,0,0,0.6)",a.ctx.lineWidth=5,a.ctx.fill(),a.ctx.stroke(),a},Game.Map.Object.FloatingText=function(e,t){this.game=e,this.text=e.add.text(t.x,t.y,t.properties.text,{font:"20px silkscreennormal",wordWrap:!0,wordWrapWidth:32*t.properties.tiles,align:"center",fill:"#000"}),this.text.anchor.set(.5,.5)},Game.LevelScore=function(e,t,a){this.game=e,this.sprites={},this.scoredItems=[],this.collectedItems=this.game.storage.get(t),this.collectibles=a,this.collectibleSize=16,this.addDisplay()},Game.LevelScore.prototype.addDisplay=function(){var e,t,a,s,i=this.game.width-33,o=!1;this.scoreGroup=this.game.add.group(),this.scoreGroup.fixedToCamera=!0,this.scoreText=new Phaser.BitmapText(this.game,i,7,"nokia","0",20),this.scoreGroup.add(this.scoreText),this.collectibles.forEach(function(n){if("jewel"===n.properties.sprite_key){if(!o){o=!0,i-=32;var r=this.game.add.sprite(i,0,"jewel");this.scoreGroup.add(r),i-=20}}else e=n.properties.sprite_key,this.collectedItems&&this.collectedItems.scoredItems.forEach(function(e){e.sprite_key===n.properties.sprite_key&&(t=!0)}),t||(e+="_grey"),a=this.game.add.sprite(i,7,e),s=Math.min(this.collectibleSize/a.width,this.collectibleSize/a.height),a.scale.setTo(s,s),this.scoreGroup.add(a),this.sprites[n.properties.sprite_key]=a,i-=a.width*s+16}.bind(this))},Game.LevelScore.prototype.scoreItem=function(e,t){this.game.analytics.itemCollected(e.sprite_key);var a=this.sprites[e.sprite_key];a&&a.loadTexture(e.sprite_key),this.scoredItems.push(e),Game.Score.levelScores[t]={scoredItems:this.scoredItems},"jewel"!==e.sprite_key&&Game.Score.nbCollected<Game.Score.nbCollectibles&&Game.Score.nbCollected++,this.game.storage.set(t,{scoredItems:this.scoredItems}),this.updatePoints(this.scoredItems)},Game.LevelScore.prototype.updatePoints=function(e){var t,a=0;e.forEach(function(e){t=e.score,typeof t!==Number&&(t=parseInt(t,10)),a+=t}),this.scoreText&&this.scoreText.setText(a)},Game.Map.Module=function(e,t){this.game=e,this.tilemap=e.add.tilemap(t);for(var a=0;a<this.tilemap.tilesets.length;a++)this.tilemap.addTilesetImage(this.tilemap.tilesets[a].name)},Game.Map.Module.prototype={createLayer:function(){return this.tilemap.createLayer.apply(this.tilemap,arguments)},createLayers:function(){var e,t,a={};for(t=0;t<arguments.length;t++)e=arguments[t],a[e]=this.tilemap.createLayer(e);return a},findTextObjects:function(){var e=this,t=[];return this.tilemap.objects.text&&this.tilemap.objects.text.forEach(function(a){a.y-=e.tilemap.tileHeight,a.properties.text=a.properties.text.replace(/\\n/g,"\n").replace(/\\r/g,"\r"),a.properties.size=a.properties.size||20,t.push(a)}),t},findCollectibleObjects:function(){var e=this,t=[];return this.tilemap.objects.collectibles&&this.tilemap.objects.collectibles.forEach(function(a){a.y-=e.tilemap.tileHeight,t.push(a)}),t},findObjectsByType:function(e){var t=this,a=[];return this.tilemap.objects.objects&&this.tilemap.objects.objects.forEach(function(s){s.type===e&&(s.y-=t.tilemap.tileHeight,a.push(s))}),a},getCollisionSprites:function(e,t,a,s){a=a||0,s=s||0;var i,o=this,n=[];return this.tilemap.objects[e].forEach(function(e){e.y-=o.tilemap.tileHeight,i=t.create(e.x+32*a,e.y+32*s),o.game.physics.arcade.enable(i),i.body.setSize(e.properties.width,e.properties.height),i.body.immovable=!0,n.push(i)}),n},spriteFromObject:function(e,t){var a=t.create(e.x,e.y,e.properties.sprite);return a.properties={},Object.keys(e.properties).forEach(function(t){a.properties[t]=e.properties[t]}),a}},Game.PauseMenu=function(e){this.game=e,this.buttonDefinitions=[{sprite:"time_machine_button",x:40,y:80,callback:"backToNavigation"},{sprite:"resume_button",x:40,y:120,callback:"resume"},{sprite:"restart_level_button",x:40,y:160,callback:"restartLevel"},{sprite:"share_on_facebook",x:40,y:200,callback:"shareOnFacebook"},{sprite:"share_on_twitter",x:40,y:240,callback:"shareOnTwitter"}],this.buttons=[],this.addPauseButton(),this.drawMenu(),this.game.input.onDown.add(this.handleInput,this)},Game.PauseMenu.prototype.addPauseButton=function(){this.pauseButton=this.game.add.button(10,10,"pause",this.showPauseMenu,this),this.pauseButton.fixedToCamera=!0},Game.PauseMenu.prototype.drawMenu=function(){var e,t,a;this.menuGroup=this.game.add.group(),this.menuGroup.visible=!1,a=this.game.add.graphics(0,0),a.fixedToCamera=!0,a.beginFill(0,.8),a.drawRect(this.game.camera.x,this.game.camera.y,this.game.width,this.game.height),a.endFill(),this.menuGroup.add(a),e=new Phaser.Text(this.game,240,40,"Paused",{font:"helvetica",fontSize:18,fill:"#ffffff"}),e.fixedToCamera=!0,this.menuGroup.add(e),this.buttonDefinitions.forEach(function(e){t=new Phaser.Image(this.game,e.x,e.y,e.sprite),t.fixedToCamera=!0,this.menuGroup.add(t),this.buttons.push({x1:t.x,y1:t.y,x2:t.x+t.width,y2:t.y+t.height,callback:e.callback})}.bind(this))},Game.PauseMenu.prototype.handleInput=function(e){this.game.paused&&this.buttons.forEach(function(t){e.x>t.x1&&e.x<t.x2&&e.y>t.y1&&e.y<t.y2&&t.callback&&this[t.callback]()}.bind(this))},Game.PauseMenu.prototype.backToNavigation=function(){this.game.paused=!1,this.game.state.start("navigation")},Game.PauseMenu.prototype.resume=function(){this.game.paused=!1,this.pauseButton.visible=!0,this.menuGroup.visible=!1},Game.PauseMenu.prototype.restartLevel=function(){this.game.paused=!1,this.game.state.start(this.game.state.current)},Game.PauseMenu.prototype.showPauseMenu=function(){this.game.paused=!0,this.pauseButton.visible=!1,this.menuGroup.visible=!0},Game.PauseMenu.prototype.shareOnFacebook=function(){console.log("shared on Facebook")},Game.PauseMenu.prototype.shareOnTwitter=function(){console.log("shared on Twitter")},Game.Storage=function(e){this.storageName=e||"skynews-game",this.read()},Game.Storage.prototype.save=function(){localStorage.setItem(this.storageName,JSON.stringify(this.state))},Game.Storage.prototype.read=function(){this.state=JSON.parse(localStorage.getItem(this.storageName)||"{}")||{}},Game.Storage.prototype.set=function(e,t){this.state[e]=t,this.save()},Game.Storage.prototype.get=function(e){return this.state[e]},Game.State.BaseState=function(){this.levelKey=null,this.controls=null,this.collectibleItems=[],this.collectedItems=[],this.parallaxTextGroup=null,this.fixedTextGroup=null},Game.State.BaseState.prototype={TEXT_PARALLAX_SCALE:1.1,create:function(){this.game.analytics.stateStarted(this.levelKey),this.game.physics.arcade.gravity.y=600,this._createState(),this.game.fadePlugin.fadeIn(0,750,0)},addPlayer:function(){var e=this.levelModule.findObjectsByType("player_spawn");this.player=this.game.add.sprite(e[0].x,e[0].y-32,"player"),this.game.physics.arcade.enable(this.player),this.player.body.collideWorldBounds=!0,this.game.camera.follow(this.player),this.player.animations.add("left",[0,1],5,!0),this.player.animations.add("right",[3,4],5,!0)},addCollectibles:function(){this.collectibleItems=[];var e=this.levelModule.findCollectibleObjects();e.forEach(function(e){var t=this.game.add.sprite(e.x,e.y,e.properties.sprite_key);"jewel"!==e.properties.sprite_key&&(t._isArtefact=!0,t._revealFactId=e.properties.revealFactId,this.addArtefactEmitter(t)),t.properties=e.properties,this.game.physics.arcade.enable(t),t.body.allowGravity=!1,t.anchor=new Phaser.Point(.5,.5),this.collectibleItems.push(t)}.bind(this))},addArtefactEmitter:function(e){var t=this.game.add.emitter(e.x,e.y,10);t.makeParticles(["sparkle1","sparkle2","sparkle3"]),t.minParticleSpeed.setTo(-50,-50),t.maxParticleSpeed.setTo(50,50),t.gravity=-600,t.alpha=.5,t.minParticleAlpha=.7,t.maxParticleAlpha=1,t.minParticleScale=.5,t.maxParticleScale=1.5,t.start(!1,1e3,100),e._emitter=t},addNextLevelPortal:function(){var e=this.levelModule.findObjectsByType("next_level");e.length&&(this.nextLevel=this.game.add.sprite(e[0].x,e[0].y,"transparent_32-160"),this.game.physics.arcade.enable(this.nextLevel),this.nextLevel.body.allowGravity=!1,this.nextLevel.y-=110)},_createState:function(){var e;this.levelModule=new Game.Map.Module(this.game,this.levelKey),this.modules={},this.createBackgroundLayers&&"function"==typeof this.createBackgroundLayers&&this.createBackgroundLayers(),this.platform=this.levelModule.createLayer("platform"),this.platform.alpha=0,this.platform.resizeWorld(),this.addNextLevelPortal(),e=this.levelModule.findTextObjects(),this.factReference={},this.addPlayer(),this.addCollectibles(),this.controls=new Game.Controls(this.game,this.player),this.createForegroundLayers&&"function"==typeof this.createForegroundLayers&&this.createForegroundLayers(),e.forEach(function(e){"factoid"===e.properties.type?this.factReference[e.properties.id]=new Game.Map.Object.Factoid(this.game,e):new Game.Map.Object.FloatingText(this.game,e)}.bind(this)),this.setCollisions&&"function"==typeof this.setCollisions&&this.setCollisions(),this.scoreDisplay=new Game.LevelScore(this.game,this.levelKey,this.collectibleItems),this.pauseMenu=new Game.PauseMenu(this.game)},_collectiblesCollisionHandler:function(e,t){var a=null;t._emitter&&(t._emitter.on=!1),a=t,a.x=a.x-this.game.camera.x,a.y=a.y-this.game.camera.y,t.fixedToCamera=!0,a.body.destroy(),this.game.add.tween(a).to({alpha:0},500,"Linear",!0),this.game.add.tween(a.scale).to({x:3,y:3},250,Phaser.Easing.Quadratic.In,!0).chain(this.game.add.tween(a.scale).to({x:1,y:1},250,Phaser.Easing.Quadratic.Out)),this.game.add.tween(a.cameraOffset).to({y:-32},500,Phaser.Easing.Quadratic.InOut,!0),this.game.add.tween(a.cameraOffset).to({x:500},500,Phaser.Easing.Quadratic.InOut,!0).onComplete.add(a.destroy,a),this.collectedItems.push(a),this.itemCollectedHandler&&"function"==typeof this.itemCollectedHandler&&this.itemCollectedHandler(a),this.scoreDisplay.scoreItem(a.properties,this.levelKey),a._revealFactId&&this.factReference[a._revealFactId].reveal()},_nextLevelHandler:function(){var e=this.nextLevelKey;this.game.fadePlugin.fadeOut(0,750,0,function(){this.game.analytics.stateComplete(this.levelKey),Game.Score.allCollected()&&(e="end_screen"),this.game.state.start(e)}.bind(this))},update:function(){this._updateState(),this.updateState&&"function"==typeof this.updateState&&this.updateState()},_updateState:function(){this.parallaxTextGroup&&(this.parallaxTextGroup.x=this.game.world.x*this.TEXT_PARALLAX_SCALE),this.game.physics.arcade.collide(this.player,this.platform),this.game.physics.arcade.overlap(this.player,this.collectibleItems,this._collectiblesCollisionHandler,null,this),this.game.physics.arcade.overlap(this.player,this.nextLevel,this._nextLevelHandler,null,this),this.controls.update()}},Game.State.Decade_2010s=function(){},Game.State.Decade_2010s.prototype=new Game.State.BaseState,Game.State.Decade_2010s.prototype.levelKey="decade_2010s",Game.State.Decade_2010s.prototype.nextLevelKey="navigation",Game.State.Decade_2010s.prototype.setCollisions=function(){this.levelModule.tilemap.setCollisionBetween(834,849),this.levelModule.tilemap.setCollisionBetween(861,882)},Game.State.Decade_50s=function(){},Game.State.Decade_50s.prototype=new Game.State.BaseState,Game.State.Decade_50s.prototype.levelKey="decade_50s",Game.State.Decade_50s.prototype.nextLevelKey="decade_60s",Game.State.Decade_50s.prototype.setCollisions=function(){this.levelModule.tilemap.setCollision(76)},Game.State.Decade_50s.prototype.createBackgroundLayers=function(){this.levelModule.createLayer("background")},Game.State.Decade_50s.prototype.createForegroundLayers=function(){this.levelModule.createLayer("foreground")},Game.State.Decade_60s=function(){},Game.State.Decade_60s.prototype=new Game.State.BaseState,Game.State.Decade_60s.prototype.levelKey="decade_60s",Game.State.Decade_60s.prototype.nextLevelKey="decade_2010s",Game.State.Decade_60s.prototype.setCollisions=function(){this.levelModule.tilemap.setCollision(3)},Game.State.Decade_60s.prototype.createBackgroundLayers=function(){this.levelModule.createLayer("bg_colour"),this.levelModule.createLayer("background")},Game.State.Decade_60s.prototype.createForegroundLayers=function(){this.levelModule.createLayer("foreground")},Game.State.Decade_60s.prototype.updateState=function(){this.parallaxTextGroup.x=this.game.world.x*this.TEXT_PARALLAX_SCALE,this.parallaxTextGroup.y=this.game.world.y*this.TEXT_PARALLAX_SCALE},Game.State.EndScreen=function(){},Game.State.EndScreen.prototype={cursors:null,transitionning:!1,fixedTextOverlays:[{text:"Well done",size:100,x:20,y:20,alpha:.2},{text:"All royal artefacts have been returned!",size:20,x:20,y:120}],create:function(){this.game.analytics.gameCompleted(),this.transitionning=!1,this.createState(),this.game.fadePlugin.fadeIn(0,750,0)},createState:function(){var e=this.game.add.graphics(0,0);e.beginFill(0,1),e.drawRect(this.game.camera.x,this.game.camera.y,1.5*this.game.width,1.5*this.game.height),e.endFill(),this.textGroup=this.game.add.group(),this.textGroup.fixedToCamera=!1,this.textGroup.alpha=1,this.fixedTextOverlays.forEach(function(e){var t=new Phaser.BitmapText(this.game,e.x,e.y,"nokia",e.text,e.size);t.alpha=e.alpha||1,this.textGroup.add(t)}.bind(this)),this.game.add.button(this.game.width-120,this.game.height-50,"next_button",this.nextLevel,this),this.cursors=this.game.input.keyboard.createCursorKeys()},nextLevel:function(){this.transitionning||(this.transitionning=!0,this.game.fadePlugin.fadeOut(0,750,0,function(){this.game.state.start("navigation")}))}},Game.State.Intro_50s=function(){},Game.State.Intro_50s.prototype={cursors:null,transitionning:!1,fixedTextOverlays:[{text:"1950s",size:200,x:20,y:20,alpha:.2},{text:"Post-war Britain started the 1950s hard-up and hurting.\n\nFood rations were in place until 1954, there were unexploded bombs in the\rstreets, and Britain's international standing was shaken by the Suez crisis.\n\nBut by the end of the decade the UK had a new Queen, television sets,\rand rock n'roll.\n\nPrime Minister Harold MacMillan proclaimed 'most of\rour people have never had it so good'.",size:16,x:20,y:20}],create:function(){this.transitionning=!1,this.createState(),this.game.fadePlugin.fadeIn(0,750,0)},createState:function(){var e=this.game.add.graphics(0,0);e.beginFill(0,1),e.drawRect(this.game.camera.x,this.game.camera.y,1.5*this.game.width,1.5*this.game.height),e.endFill(),this.endTextGroup=this.game.add.group(),this.endTextGroup.fixedToCamera=!1,this.endTextGroup.alpha=1,this.fixedTextOverlays.forEach(function(e){var t=new Phaser.Text(this.game,e.x,e.y,e.text,{font:"helvetica",fontSize:e.size,fill:"#ffffff"});t.alpha=e.alpha||1,this.endTextGroup.add(t)}.bind(this)),this.game.add.button(this.game.width-120,this.game.height-50,"next_button",this.nextLevel,this),this.cursors=this.game.input.keyboard.createCursorKeys()},nextLevel:function(){this.transitionning||(this.transitionning=!0,this.game.fadePlugin.fadeOut(0,750,0,function(){this.game.state.start("decade_50s")}))}},Game.State.Intro_AlexsHouse=function(){},Game.State.Intro_AlexsHouse.prototype={cursors:null,transitionning:!1,create:function(){this.transitionning=!1,this.game.add.image(0,0,"alexs_house"),this.game.add.button(this.game.width-120,this.game.height-50,"next_button",this.nextLevel,this),this.game.fadePlugin.fadeIn(0,750,0)},nextLevel:function(){this.transitionning||(this.transitionning=!0,this.game.fadePlugin.fadeOut(0,750,0,function(){this.game.state.start("navigation")}))}},Game.State.Intro_Skynews=function(){},Game.State.Intro_Skynews.prototype={cursors:null,transitionning:!1,create:function(){var e,t,a,s,i;this.game.analytics.stateStarted("intro"),this.transitionning=!1,this.game.stage.backgroundColor="#fff",this.game.add.image(0,0,"kay"),e=this.game.add.image(10,10,"skynews_logo"),t=this.game.add.image(0,300,"intro_ticker"),a=this.game.add.image(568,300,"intro_ticker"),s=this.game.add.group(),s.add(t),s.add(a),i=this.game.add.tween(s).to({x:-568},1e4,"Linear",!0),i.repeat(),this.clock=this.game.add.text(0,300," 00:00 ",{font:"16px Arial",fill:"#fff",backgroundColor:"black",boundsAlignV:"middle"}),this.speechText1=this.game.add.text(10,50,"A dastardly villain has travelled through time and stolen artifacts from the Queen's reign",{font:"16px Arial",fill:"#000",backgroundColor:"white",wordWrap:!0,wordWrapWidth:200}),this.speechText2=this.game.add.text(10,50,"Police are baffled. Won't somebody come forward and help? For our country!",{font:"16px Arial",fill:"#000",backgroundColor:"white",wordWrap:!0,wordWrapWidth:200}),this.speechText2.visible=!1,this.updateClock(),this.game.time.events.loop(Phaser.Timer.SECOND,this.updateClock,this),this.game.add.button(this.game.width-120,this.game.height-50,"next_button",this.nextFrame,this),this.game.fadePlugin.fadeIn(0,750,0)},nextFrame:function(){this.speechText1.visible?(this.speechText2.visible=!0,this.speechText1.visible=!1):this.nextLevel()},updateClock:function(){var e=new Date;this.clock.setText(" "+("0"+e.getHours()).slice(-2)+":"+("0"+e.getMinutes()).slice(-2)+" ")},nextLevel:function(){this.transitionning||(this.transitionning=!0,this.game.fadePlugin.fadeOut(0,750,0,function(){this.game.state.start("intro_alexs_house")}))}},Game.State.Navigation=function(){},Game.State.Navigation.prototype={cursors:null,transitionning:!1,buttonsOriginX:24,buttonsOriginY:24,buttonsMargin:30,buttonsPerRow:3,buttonHeight:48,buttonWidth:48,collectibleSize:10,create:function(){this.game.analytics.stateStarted("navigation"),this.transitionning=!1,this.createState(),this.game.fadePlugin.fadeIn(0,750,0)},createState:function(){var e=this.game.add.graphics(0,0),t=0,a=0;e.beginFill(0,1),e.drawRect(this.game.camera.x,this.game.camera.y,1.5*this.game.width,1.5*this.game.height),e.endFill(),this.buttonsGroup=this.game.add.group(),Game.Levels.forEach(function(e){var s,i,o,n=Game.Score.levelScores[e.stateKey],r=0;i=this.buttonsOriginX+a*(this.buttonWidth+this.buttonsMargin),o=this.buttonsOriginY+t*(this.buttonHeight+this.buttonsMargin),s=this.game.add.button(i,o,e.spriteKey,this.nextLevel,this),s.properties=e,e.collectibles.forEach(function(e){var t,a,s=i+18*r,l=o+this.buttonHeight+10,h=!1,c=6710886;n&&n.scoredItems.forEach(function(t){t.sprite_key===e&&(h=!0)}.bind(this)),"."===e?(h&&(c=16777215),t=this.game.add.graphics(0,0),t.properties={},t.properties.collectibleName=e,t.beginFill(c,1),t.drawRect(s,l,this.collectibleSize,this.collectibleSize),t.endFill()):(h||(e+="_grey"),t=this.game.add.sprite(s,l,e),a=Math.min(this.collectibleSize/t.width,this.collectibleSize/t.height),t.scale.setTo(a,a)),r++}.bind(this)),a+1>=this.buttonsPerRow?(a=0,t++):a++}.bind(this)),this.cursors=this.game.input.keyboard.createCursorKeys()},nextLevel:function(e){this.transitionning||(this.transitionning=!0,this.game.fadePlugin.fadeOut(0,750,0,function(){this.game.state.start(e.properties.stateKey||"tutorial")}))}},Game.State.Preloader=function(){},Game.State.Preloader.prototype={preload:function(){this.stage.backgroundColor="#000000",this.add.sprite(195,138,"crown"),this.textGroup=this.game.add.group(),this.textGroup.fixedToCamera=!0,this.textGroup.add(new Phaser.BitmapText(this.game,this.game.width/2-50,this.game.height/2-15,"pixeltype","Loading...",40)),this.game.load.image("intro_ticker","assets/sprites/intro-ticker.png"),this.game.load.image("skynews_logo","assets/sprites/8bit_sky_logo.png"),this.game.load.image("kay","assets/sprites/kayburley.png"),this.game.load.image("alexs_house","assets/sprites/alexshouse.png"),this.load.spritesheet("player","assets/sprites/alex_character.png",59,69,6),this.load.spritesheet("next_button","assets/sprites/next_button.png",100,30),this.game.load.image("sparkle1","assets/sprites/sparkle1.png"),this.game.load.image("sparkle2","assets/sprites/sparkle2.png"),this.game.load.image("sparkle3","assets/sprites/sparkle3.png"),this.game.load.image("transparent_32-160","assets/sprites/transparent_32-160.png"),this.game.load.image("jewel","assets/sprites/jewel.png"),this.game.load.image("jewel_grey","assets/sprites/jewel_grey.png"),this.game.load.image("corgi","assets/sprites/corgi.png"),this.game.load.image("corgi_grey","assets/sprites/corgi_grey.png"),this.game.load.image("crown_grey","assets/sprites/crown_grey.png"),this.game.load.image("tv","assets/sprites/50s_tv.png"),this.game.load.image("tv_grey","assets/sprites/50s_tv_grey.png"),this.game.load.image("record","assets/sprites/50s_record.png"),this.game.load.image("record_grey","assets/sprites/50s_record_grey.png"),this.game.load.image("mini","assets/sprites/50s_mini.png"),this.game.load.image("mini_grey","assets/sprites/50s_mini_grey.png"),this.game.load.image("beatles","assets/sprites/60s_beatles.png"),this.game.load.image("beatles_grey","assets/sprites/60s_beatles_grey.png"),this.game.load.image("worldcup","assets/sprites/60s_worldcup.png"),this.game.load.image("worldcup_grey","assets/sprites/60s_worldcup_grey.png"),this.game.load.image("the_sun","assets/sprites/60s_the_sun.png"),this.game.load.image("the_sun_grey","assets/sprites/60s_the_sun_grey.png"),this.game.load.image("button_level_50s","assets/sprites/level_buttons/level_50s.png"),this.game.load.image("button_level_60s","assets/sprites/level_buttons/level_60s.png"),
this.game.load.image("button_level_70s","assets/sprites/level_buttons/level_70s.png"),this.game.load.image("button_level_80s","assets/sprites/level_buttons/level_80s.png"),this.game.load.image("button_level_90s","assets/sprites/level_buttons/level_90s.png"),this.game.load.image("button_level_00s","assets/sprites/level_buttons/level_00s.png"),this.game.load.image("button_level_10s","assets/sprites/level_buttons/level_10s.png"),this.load.image("compass","assets/sprites/compass_rose.png"),this.load.image("touch_segment","assets/sprites/touch_segment.png"),this.load.image("touch","assets/sprites/touch.png"),this.load.image("pause","assets/sprites/pause.png"),this.load.image("time_machine_button","assets/sprites/time-machine-button.png"),this.load.image("resume_button","assets/sprites/resume-button.png"),this.load.image("restart_level_button","assets/sprites/restart-level-button.png"),this.load.image("share_on_facebook","assets/sprites/share-on-facebook-button.png"),this.load.image("share_on_twitter","assets/sprites/share-on-twitter-button.png"),this.loadTileMaps()},loadTileMaps:function(){var e,t,a={};for(t=0;t<Game.Map.MAPS.length;t++)this.addTileSets(Game.Map.MAPS[t],a);for(e in a)a.hasOwnProperty(e)&&this.load.image(e,a[e])},addTileSets:function(e,t){var a,s,i,o=this.cache.getTilemapData(e).data.tilesets;for(i=0;i<o.length;i++)s=o[i].name,a="assets/maps/"+o[i].image,s in t||(t[s]=a)},create:function(){setTimeout(function(){this.game.fadePlugin.fadeOut(0,750,0,function(){this.game.state.start("intro_skynews")}.bind(this))}.bind(this),500)}},Game.State.Startup=function(){},Game.State.Startup.prototype={preload:function(){this.load.image("crown","assets/sprites/crown.png"),this.load.bitmapFont("nokia","assets/fonts/bitmapFonts/nokia.png","assets/fonts/bitmapFonts/nokia.xml"),this.load.bitmapFont("pixeltype","assets/fonts/bitmapFonts/pixeltype.png","assets/fonts/bitmapFonts/pixeltype.xml");var e,t;for(t=0;t<Game.Map.MAPS.length;t++)e=Game.Map.MAPS[t],this.load.tilemap(e,"assets/maps/"+e+".json",null,Phaser.Tilemap.TILED_JSON)},create:function(){this.game.scale.scaleMode=Phaser.ScaleManager.SHOW_ALL,this.game.fadePlugin=this.game.plugins.add(new Phaser.Plugin.Fade(this)),this.game.physics.startSystem(Phaser.Physics.ARCADE),this.game.state.start("preloader")}},Game.State.Tutorial=function(){},Game.State.Tutorial.prototype=new Game.State.BaseState,Game.State.Tutorial.prototype.levelKey="tutorial",Game.State.Tutorial.prototype.nextLevelKey="decade_50s",Game.State.Tutorial.prototype.setCollisions=function(){this.levelModule.tilemap.setCollisionBetween(76,84)},Game.State.Tutorial.prototype.createForegroundLayers=function(){this.banisterLayer=this.levelModule.createLayer("banisters"),this.columnLayer=this.levelModule.createLayer("columns")};var Game={};Game={},Game.State={},Game.Map={},Game.Map.Object={},Game.Score={nbCollectibles:0,nbCollected:0,levelScores:{},allCollected:function(){return this.nbCollectibles===this.nbCollected}},Game.Map.MAPS=["tutorial","decade_50s","decade_60s","decade_2010s"],Game.Levels=[{text:"50s",stateKey:"decade_50s",spriteKey:"button_level_50s",collectibles:["record","tv","mini"]},{text:"60s",stateKey:"decade_60s",spriteKey:"button_level_60s",collectibles:["beatles","the_sun","worldcup"]},{text:"70s",stateKey:null,spriteKey:"button_level_70s",collectibles:[".",".","."]},{text:"80s",stateKey:"tutorial",spriteKey:"button_level_80s",collectibles:["corgi",".","."]},{text:"90s",stateKey:null,spriteKey:"button_level_90s",collectibles:[".",".","."]},{text:"00s",stateKey:null,spriteKey:"button_level_00s",collectibles:[".",".","."]},{text:"10s",stateKey:"decade_2010s",spriteKey:"button_level_10s",collectibles:["corgi","crown","."]}],Game.init=function(){var e=new Phaser.Game(568,320,Phaser.AUTO,"main",null,!1,!1);this.game=e,e.analytics=Game.Analytics,e.storage=new Game.Storage("skynews-queen-feature-game"),e.state.add("startup",Game.State.Startup),e.state.add("preloader",Game.State.Preloader),e.state.add("intro_skynews",Game.State.Intro_Skynews),e.state.add("intro_alexs_house",Game.State.Intro_AlexsHouse),e.state.add("navigation",Game.State.Navigation),e.state.add("tutorial",Game.State.Tutorial),e.state.add("intro_50s",Game.State.Intro_50s),e.state.add("decade_50s",Game.State.Decade_50s),e.state.add("decade_60s",Game.State.Decade_60s),e.state.add("decade_2010s",Game.State.Decade_2010s),e.state.add("end_screen",Game.State.EndScreen),Game.Levels.forEach(function(e){e.collectibles.forEach(function(e){"."!==e&&this.Score.nbCollectibles++}.bind(this))}.bind(this)),Game.getCollectedItems(),e.state.start("startup")},Game.getCollectedItems=function(){this.Score.nbCollected=0,Game.Levels.forEach(function(e){var t=this.game.storage.get(e.stateKey);t&&t.scoredItems.forEach(function(e){"jewel"!==e.sprite_key&&this.Score.nbCollected++}.bind(this)),Game.Score.levelScores[e.stateKey]=t}.bind(this))},window.onload=function(){Game.init()},Phaser.Plugin.Fade=function(e,t){Phaser.Plugin.call(this,e,t)},Phaser.Plugin.Fade.prototype=Object.create(Phaser.Plugin.prototype),Phaser.Plugin.Fade.prototype.constructor=Phaser.Plugin.SamplePlugin,Phaser.Plugin.Fade.prototype.fadeOut=function(e,t,a,s){this.fade(e,t,a,0,1,s)},Phaser.Plugin.Fade.prototype.fadeIn=function(e,t,a,s){this.fade(e,t,a,1,0,s)},Phaser.Plugin.Fade.prototype.fade=function(e,t,a,s,i,o){a=a||0;var n,r=this.game.add.graphics(0,0);r.beginFill(e,1),r.drawRect(this.game.camera.x,this.game.camera.y,1.5*this.game.world.width,1.5*this.game.world.height),r.alpha=s,r.endFill(),n=this.game.add.tween(r),n.to({alpha:i},t,null),o&&n.onComplete.add(o,this),n.start()},Game.Analytics={stateStarted:function(e){this.sendEvent(["state started",e])},stateComplete:function(e){this.sendEvent(["state completed",e])},itemCollected:function(e){this.sendEvent(["item collected",e])},gameCompleted:function(){this.sendEvent(["game completed"])},sendEvent:function(e){setTimeout(function(){ga("send","event","The Reign Game",e[0],e[1])},1)}};var PLAYER_SPEED=200;Game.Controls=function(e,t){this.game=e,this.player=t,this.moving=!1,this.create()},Game.Controls.prototype.create=function(){this.cursors=this.game.input.keyboard.createCursorKeys()},Game.Controls.prototype.handleDown=function(e){this.moving?this.jump():(e.x<this.game.width/2?this.moveLeft():this.moveRight(),this.moving=!0)},Game.Controls.prototype.handleUp=function(){console.log(this.game.input.totalActivePointers),0===this.game.input.totalActivePointers?(this.player.animations.stop(),this.player.frame=2,this.player.body.velocity.x=0,this.moving=!1):this.handleDown(this.game.input.activePointer)},Game.Controls.prototype.moveLeft=function(){this.player.body.velocity.x=-PLAYER_SPEED,this.player.animations.play("left")},Game.Controls.prototype.moveRight=function(){this.player.body.velocity.x=PLAYER_SPEED,this.player.animations.play("right")},Game.Controls.prototype.jump=function(){this.player.body.onFloor()&&(this.player.body.velocity.y=-300)},Game.Controls.prototype.update=function(){var e=0;this.game.input.pointer1.isDown&&e++,this.game.input.pointer2.isDown&&e++,(this.cursors.up.isDown||e>1)&&this.jump(),1===e&&(this.activePointer=this.game.input.pointer1.isDown?this.game.input.pointer1:this.game.input.pointer2),this.cursors.left.isDown?this.moveLeft():this.cursors.right.isDown?this.moveRight():0===e&&(this.player.body.velocity.x=0,this.activePointer=null),this.activePointer&&(this.activePointer.x<this.game.width/2?this.moveLeft():this.activePointer.x>this.game.width/2&&this.moveRight()),0===this.player.body.velocity.x&&(this.player.animations.stop(),this.player.frame=2)};var FACTOID_TEXT_PADDING=10;Game.Map.Object.Factoid=function(e,t){this.game=e,this.text=new Phaser.Text(e,0,0,t.properties.text,{font:"20px silkscreennormal",wordWrap:!0,wordWrapWidth:32*t.properties.tiles,align:"center"}),this.bg=e.add.sprite(t.x,t.y,this._getBackground()),this.bg.anchor.set(.5,.5),this.text.anchor.set(.5,.5),this.bg.visible=!1,this.bg.addChild(this.text),this.emitter=e.add.emitter(t.x,t.y,100),this.emitter.makeParticles(["sparkle1","sparkle2","sparkle3"]),this.emitter.width=this.text.width,this.emitter.height=this.text.height,this.emitter.minParticleSpeed.setTo(-50,-50),this.emitter.maxParticleSpeed.setTo(50,50),this.emitter.gravity=-600,this.emitter.alpha=.5,this.emitter.minParticleAlpha=.7,this.emitter.maxParticleAlpha=1,this.emitter.minParticleScale=.5,this.emitter.maxParticleScale=1.5,this.emitter.start(!0)},Game.Map.Object.Factoid.prototype.reveal=function(){this.bg.visible=!0,this.bg.scale.x=.5,this.bg.scale.y=.5,this.bg.alpha=0,this.game.add.tween(this.bg.scale).to({x:1},1e3,Phaser.Easing.Bounce.Out,!0),this.game.add.tween(this.bg.scale).to({y:1},750,Phaser.Easing.Bounce.Out,!0),this.game.add.tween(this.bg).to({alpha:1},1e3,Phaser.Easing.Linear.None,!0),this.emitter.explode(1e3,100)},Game.Map.Object.Factoid.prototype._getBackground=function(){var e=this.text.width+5+2*FACTOID_TEXT_PADDING,t=this.text.height+2*FACTOID_TEXT_PADDING,a=this.game.add.bitmapData(e,t);return a.ctx.beginPath(),a.ctx.rect(0,0,e,t),a.ctx.fillStyle="rgba(255,255,255, 0.7)",a.ctx.strokeStyle="rgba(0,0,0,0.6)",a.ctx.lineWidth=5,a.ctx.fill(),a.ctx.stroke(),a},Game.Map.Object.FloatingText=function(e,t){this.game=e,this.text=e.add.text(t.x,t.y,t.properties.text,{font:"20px silkscreennormal",wordWrap:!0,wordWrapWidth:32*t.properties.tiles,align:"center",fill:"#000"}),this.text.anchor.set(.5,.5)},Game.LevelScore=function(e,t,a){this.game=e,this.sprites={},this.scoredItems=[],this.collectedItems=this.game.storage.get(t),this.collectibles=a,this.collectibleSize=16,this.addDisplay()},Game.LevelScore.prototype.addDisplay=function(){var e,t,a,s,i=this.game.width-33,o=!1;this.scoreGroup=this.game.add.group(),this.scoreGroup.fixedToCamera=!0,this.scoreText=new Phaser.BitmapText(this.game,i,7,"nokia","0",20),this.scoreGroup.add(this.scoreText),this.collectibles.forEach(function(n){if("jewel"===n.properties.sprite_key){if(!o){o=!0,i-=32;var r=this.game.add.sprite(i,0,"jewel");this.scoreGroup.add(r),i-=20}}else e=n.properties.sprite_key,this.collectedItems&&this.collectedItems.scoredItems.forEach(function(e){e.sprite_key===n.properties.sprite_key&&(t=!0)}),t||(e+="_grey"),a=this.game.add.sprite(i,7,e),s=Math.min(this.collectibleSize/a.width,this.collectibleSize/a.height),a.scale.setTo(s,s),this.scoreGroup.add(a),this.sprites[n.properties.sprite_key]=a,i-=a.width*s+16}.bind(this))},Game.LevelScore.prototype.scoreItem=function(e,t){this.game.analytics.itemCollected(e.sprite_key);var a=this.sprites[e.sprite_key];a&&a.loadTexture(e.sprite_key),this.scoredItems.push(e),Game.Score.levelScores[t]={scoredItems:this.scoredItems},"jewel"!==e.sprite_key&&Game.Score.nbCollected<Game.Score.nbCollectibles&&Game.Score.nbCollected++,this.game.storage.set(t,{scoredItems:this.scoredItems}),this.updatePoints(this.scoredItems)},Game.LevelScore.prototype.updatePoints=function(e){var t,a=0;e.forEach(function(e){t=e.score,typeof t!==Number&&(t=parseInt(t,10)),a+=t}),this.scoreText&&this.scoreText.setText(a)},Game.Map.Module=function(e,t){this.game=e,this.tilemap=e.add.tilemap(t);for(var a=0;a<this.tilemap.tilesets.length;a++)this.tilemap.addTilesetImage(this.tilemap.tilesets[a].name)},Game.Map.Module.prototype={createLayer:function(){return this.tilemap.createLayer.apply(this.tilemap,arguments)},createLayers:function(){var e,t,a={};for(t=0;t<arguments.length;t++)e=arguments[t],a[e]=this.tilemap.createLayer(e);return a},findTextObjects:function(){var e=this,t=[];return this.tilemap.objects.text&&this.tilemap.objects.text.forEach(function(a){a.y-=e.tilemap.tileHeight,a.properties.text=a.properties.text.replace(/\\n/g,"\n").replace(/\\r/g,"\r"),a.properties.size=a.properties.size||20,t.push(a)}),t},findCollectibleObjects:function(){var e=this,t=[];return this.tilemap.objects.collectibles&&this.tilemap.objects.collectibles.forEach(function(a){a.y-=e.tilemap.tileHeight,t.push(a)}),t},findObjectsByType:function(e){var t=this,a=[];return this.tilemap.objects.objects&&this.tilemap.objects.objects.forEach(function(s){s.type===e&&(s.y-=t.tilemap.tileHeight,a.push(s))}),a},getCollisionSprites:function(e,t,a,s){a=a||0,s=s||0;var i,o=this,n=[];return this.tilemap.objects[e].forEach(function(e){e.y-=o.tilemap.tileHeight,i=t.create(e.x+32*a,e.y+32*s),o.game.physics.arcade.enable(i),i.body.setSize(e.properties.width,e.properties.height),i.body.immovable=!0,n.push(i)}),n},spriteFromObject:function(e,t){var a=t.create(e.x,e.y,e.properties.sprite);return a.properties={},Object.keys(e.properties).forEach(function(t){a.properties[t]=e.properties[t]}),a}},Game.PauseMenu=function(e){this.game=e,this.buttonDefinitions=[{sprite:"time_machine_button",x:40,y:80,callback:"backToNavigation"},{sprite:"resume_button",x:40,y:120,callback:"resume"},{sprite:"restart_level_button",x:40,y:160,callback:"restartLevel"},{sprite:"share_on_facebook",x:40,y:200,callback:"shareOnFacebook"},{sprite:"share_on_twitter",x:40,y:240,callback:"shareOnTwitter"}],this.buttons=[],this.addPauseButton(),this.drawMenu(),this.game.input.onDown.add(this.handleInput,this)},Game.PauseMenu.prototype.addPauseButton=function(){this.pauseButton=this.game.add.button(10,10,"pause",this.showPauseMenu,this),this.pauseButton.fixedToCamera=!0},Game.PauseMenu.prototype.drawMenu=function(){var e,t,a;this.menuGroup=this.game.add.group(),this.menuGroup.visible=!1,a=this.game.add.graphics(0,0),a.fixedToCamera=!0,a.beginFill(0,.8),a.drawRect(this.game.camera.x,this.game.camera.y,this.game.width,this.game.height),a.endFill(),this.menuGroup.add(a),e=new Phaser.Text(this.game,240,40,"Paused",{font:"helvetica",fontSize:18,fill:"#ffffff"}),e.fixedToCamera=!0,this.menuGroup.add(e),this.buttonDefinitions.forEach(function(e){t=new Phaser.Image(this.game,e.x,e.y,e.sprite),t.fixedToCamera=!0,this.menuGroup.add(t),this.buttons.push({x1:t.x,y1:t.y,x2:t.x+t.width,y2:t.y+t.height,callback:e.callback})}.bind(this))},Game.PauseMenu.prototype.handleInput=function(e){this.game.paused&&this.buttons.forEach(function(t){e.x>t.x1&&e.x<t.x2&&e.y>t.y1&&e.y<t.y2&&t.callback&&this[t.callback]()}.bind(this))},Game.PauseMenu.prototype.backToNavigation=function(){this.game.paused=!1,this.game.state.start("navigation")},Game.PauseMenu.prototype.resume=function(){this.game.paused=!1,this.pauseButton.visible=!0,this.menuGroup.visible=!1},Game.PauseMenu.prototype.restartLevel=function(){this.game.paused=!1,this.game.state.start(this.game.state.current)},Game.PauseMenu.prototype.showPauseMenu=function(){this.game.paused=!0,this.pauseButton.visible=!1,this.menuGroup.visible=!0},Game.PauseMenu.prototype.shareOnFacebook=function(){console.log("shared on Facebook")},Game.PauseMenu.prototype.shareOnTwitter=function(){console.log("shared on Twitter")},Game.Storage=function(e){this.storageName=e||"skynews-game",this.read()},Game.Storage.prototype.save=function(){localStorage.setItem(this.storageName,JSON.stringify(this.state))},Game.Storage.prototype.read=function(){this.state=JSON.parse(localStorage.getItem(this.storageName)||"{}")||{}},Game.Storage.prototype.set=function(e,t){this.state[e]=t,this.save()},Game.Storage.prototype.get=function(e){return this.state[e]},Game.State.BaseState=function(){this.levelKey=null,this.controls=null,this.collectibleItems=[],this.collectedItems=[],this.parallaxTextGroup=null,this.fixedTextGroup=null},Game.State.BaseState.prototype={TEXT_PARALLAX_SCALE:1.1,create:function(){this.game.analytics.stateStarted(this.levelKey),this.game.physics.arcade.gravity.y=600,this._createState(),this.game.fadePlugin.fadeIn(0,750,0)},addPlayer:function(){var e=this.levelModule.findObjectsByType("player_spawn");this.player=this.game.add.sprite(e[0].x,e[0].y-32,"player"),this.game.physics.arcade.enable(this.player),this.player.body.collideWorldBounds=!0,this.game.camera.follow(this.player),this.player.animations.add("left",[0,1],5,!0),this.player.animations.add("right",[3,4],5,!0)},addCollectibles:function(){this.collectibleItems=[];var e=this.levelModule.findCollectibleObjects();e.forEach(function(e){var t=this.game.add.sprite(e.x,e.y,e.properties.sprite_key);"jewel"!==e.properties.sprite_key&&(t._isArtefact=!0,t._revealFactId=e.properties.revealFactId,this.addArtefactEmitter(t)),t.properties=e.properties,this.game.physics.arcade.enable(t),t.body.allowGravity=!1,t.anchor=new Phaser.Point(.5,.5),this.collectibleItems.push(t)}.bind(this))},addArtefactEmitter:function(e){var t=this.game.add.emitter(e.x,e.y,10);t.makeParticles(["sparkle1","sparkle2","sparkle3"]),t.minParticleSpeed.setTo(-50,-50),t.maxParticleSpeed.setTo(50,50),t.gravity=-600,t.alpha=.5,t.minParticleAlpha=.7,t.maxParticleAlpha=1,t.minParticleScale=.5,t.maxParticleScale=1.5,t.start(!1,1e3,100),e._emitter=t},addNextLevelPortal:function(){var e=this.levelModule.findObjectsByType("next_level");e.length&&(this.nextLevel=this.game.add.sprite(e[0].x,e[0].y,"transparent_32-160"),this.game.physics.arcade.enable(this.nextLevel),this.nextLevel.body.allowGravity=!1,this.nextLevel.y-=110)},_createState:function(){var e;this.levelModule=new Game.Map.Module(this.game,this.levelKey),this.modules={},this.createBackgroundLayers&&"function"==typeof this.createBackgroundLayers&&this.createBackgroundLayers(),this.platform=this.levelModule.createLayer("platform"),this.platform.alpha=0,this.platform.resizeWorld(),this.addNextLevelPortal(),e=this.levelModule.findTextObjects(),this.factReference={},this.addPlayer(),this.addCollectibles(),this.controls=new Game.Controls(this.game,this.player),this.createForegroundLayers&&"function"==typeof this.createForegroundLayers&&this.createForegroundLayers(),e.forEach(function(e){"factoid"===e.properties.type?this.factReference[e.properties.id]=new Game.Map.Object.Factoid(this.game,e):new Game.Map.Object.FloatingText(this.game,e)}.bind(this)),this.setCollisions&&"function"==typeof this.setCollisions&&this.setCollisions(),this.scoreDisplay=new Game.LevelScore(this.game,this.levelKey,this.collectibleItems),this.pauseMenu=new Game.PauseMenu(this.game)},_collectiblesCollisionHandler:function(e,t){var a=null;t._emitter&&(t._emitter.on=!1),a=t,a.x=a.x-this.game.camera.x,a.y=a.y-this.game.camera.y,t.fixedToCamera=!0,a.body.destroy(),this.game.add.tween(a).to({alpha:0},500,"Linear",!0),this.game.add.tween(a.scale).to({x:3,y:3},250,Phaser.Easing.Quadratic.In,!0).chain(this.game.add.tween(a.scale).to({x:1,y:1},250,Phaser.Easing.Quadratic.Out)),this.game.add.tween(a.cameraOffset).to({y:-32},500,Phaser.Easing.Quadratic.InOut,!0),this.game.add.tween(a.cameraOffset).to({x:500},500,Phaser.Easing.Quadratic.InOut,!0).onComplete.add(a.destroy,a),this.collectedItems.push(a),this.itemCollectedHandler&&"function"==typeof this.itemCollectedHandler&&this.itemCollectedHandler(a),this.scoreDisplay.scoreItem(a.properties,this.levelKey),a._revealFactId&&this.factReference[a._revealFactId].reveal()},_nextLevelHandler:function(){var e=this.nextLevelKey;this.game.fadePlugin.fadeOut(0,750,0,function(){this.game.analytics.stateComplete(this.levelKey),Game.Score.allCollected()&&(e="end_screen"),this.game.state.start(e)}.bind(this))},update:function(){this._updateState(),this.updateState&&"function"==typeof this.updateState&&this.updateState()},_updateState:function(){this.parallaxTextGroup&&(this.parallaxTextGroup.x=this.game.world.x*this.TEXT_PARALLAX_SCALE),this.game.physics.arcade.collide(this.player,this.platform),this.game.physics.arcade.overlap(this.player,this.collectibleItems,this._collectiblesCollisionHandler,null,this),this.game.physics.arcade.overlap(this.player,this.nextLevel,this._nextLevelHandler,null,this),this.controls.update()}},Game.State.Decade_2010s=function(){},Game.State.Decade_2010s.prototype=new Game.State.BaseState,Game.State.Decade_2010s.prototype.levelKey="decade_2010s",Game.State.Decade_2010s.prototype.nextLevelKey="navigation",Game.State.Decade_2010s.prototype.setCollisions=function(){this.levelModule.tilemap.setCollisionBetween(834,849),this.levelModule.tilemap.setCollisionBetween(861,882)},Game.State.Decade_50s=function(){},Game.State.Decade_50s.prototype=new Game.State.BaseState,Game.State.Decade_50s.prototype.levelKey="decade_50s",Game.State.Decade_50s.prototype.nextLevelKey="decade_60s",Game.State.Decade_50s.prototype.setCollisions=function(){this.levelModule.tilemap.setCollision(76)},Game.State.Decade_50s.prototype.createBackgroundLayers=function(){this.levelModule.createLayer("background")},Game.State.Decade_50s.prototype.createForegroundLayers=function(){this.levelModule.createLayer("foreground")},Game.State.Decade_60s=function(){},Game.State.Decade_60s.prototype=new Game.State.BaseState,Game.State.Decade_60s.prototype.levelKey="decade_60s",Game.State.Decade_60s.prototype.nextLevelKey="decade_2010s",Game.State.Decade_60s.prototype.setCollisions=function(){this.levelModule.tilemap.setCollision(3)},Game.State.Decade_60s.prototype.createBackgroundLayers=function(){this.levelModule.createLayer("bg_colour"),this.levelModule.createLayer("background")},Game.State.Decade_60s.prototype.createForegroundLayers=function(){this.levelModule.createLayer("foreground")},Game.State.Decade_60s.prototype.updateState=function(){this.parallaxTextGroup.x=this.game.world.x*this.TEXT_PARALLAX_SCALE,this.parallaxTextGroup.y=this.game.world.y*this.TEXT_PARALLAX_SCALE},Game.State.EndScreen=function(){},Game.State.EndScreen.prototype={cursors:null,transitionning:!1,fixedTextOverlays:[{text:"Well done",size:100,x:20,y:20,alpha:.2},{text:"All royal artefacts have been returned!",size:20,x:20,y:120}],create:function(){this.game.analytics.gameCompleted(),this.transitionning=!1,this.createState(),this.game.fadePlugin.fadeIn(0,750,0)},createState:function(){var e=this.game.add.graphics(0,0);e.beginFill(0,1),e.drawRect(this.game.camera.x,this.game.camera.y,1.5*this.game.width,1.5*this.game.height),e.endFill(),this.textGroup=this.game.add.group(),this.textGroup.fixedToCamera=!1,this.textGroup.alpha=1,this.fixedTextOverlays.forEach(function(e){var t=new Phaser.BitmapText(this.game,e.x,e.y,"nokia",e.text,e.size);t.alpha=e.alpha||1,this.textGroup.add(t)}.bind(this)),this.game.add.button(this.game.width-120,this.game.height-50,"next_button",this.nextLevel,this),this.cursors=this.game.input.keyboard.createCursorKeys()},nextLevel:function(){this.transitionning||(this.transitionning=!0,this.game.fadePlugin.fadeOut(0,750,0,function(){this.game.state.start("navigation")}))}},Game.State.Intro_50s=function(){},Game.State.Intro_50s.prototype={cursors:null,transitionning:!1,fixedTextOverlays:[{text:"1950s",size:200,x:20,y:20,alpha:.2},{text:"Post-war Britain started the 1950s hard-up and hurting.\n\nFood rations were in place until 1954, there were unexploded bombs in the\rstreets, and Britain's international standing was shaken by the Suez crisis.\n\nBut by the end of the decade the UK had a new Queen, television sets,\rand rock n'roll.\n\nPrime Minister Harold MacMillan proclaimed 'most of\rour people have never had it so good'.",size:16,x:20,y:20}],create:function(){this.transitionning=!1,this.createState(),this.game.fadePlugin.fadeIn(0,750,0)},createState:function(){var e=this.game.add.graphics(0,0);e.beginFill(0,1),e.drawRect(this.game.camera.x,this.game.camera.y,1.5*this.game.width,1.5*this.game.height),e.endFill(),this.endTextGroup=this.game.add.group(),this.endTextGroup.fixedToCamera=!1,this.endTextGroup.alpha=1,this.fixedTextOverlays.forEach(function(e){var t=new Phaser.Text(this.game,e.x,e.y,e.text,{font:"helvetica",fontSize:e.size,fill:"#ffffff"});t.alpha=e.alpha||1,this.endTextGroup.add(t)}.bind(this)),this.game.add.button(this.game.width-120,this.game.height-50,"next_button",this.nextLevel,this),this.cursors=this.game.input.keyboard.createCursorKeys()},nextLevel:function(){this.transitionning||(this.transitionning=!0,this.game.fadePlugin.fadeOut(0,750,0,function(){this.game.state.start("decade_50s")}))}},Game.State.Intro_AlexsHouse=function(){},Game.State.Intro_AlexsHouse.prototype={cursors:null,transitionning:!1,create:function(){this.transitionning=!1,this.game.add.image(0,0,"alexs_house"),this.game.add.button(this.game.width-120,this.game.height-50,"next_button",this.nextLevel,this),this.game.fadePlugin.fadeIn(0,750,0)},nextLevel:function(){this.transitionning||(this.transitionning=!0,this.game.fadePlugin.fadeOut(0,750,0,function(){this.game.state.start("navigation")}))}},Game.State.Intro_Skynews=function(){},Game.State.Intro_Skynews.prototype={cursors:null,transitionning:!1,create:function(){var e,t,a,s,i;this.game.analytics.stateStarted("intro"),this.transitionning=!1,this.game.stage.backgroundColor="#fff",this.game.add.image(0,0,"kay"),e=this.game.add.image(10,10,"skynews_logo"),t=this.game.add.image(0,300,"intro_ticker"),a=this.game.add.image(568,300,"intro_ticker"),s=this.game.add.group(),s.add(t),s.add(a),i=this.game.add.tween(s).to({x:-568},1e4,"Linear",!0),i.repeat(),this.clock=this.game.add.text(0,300," 00:00 ",{font:"16px Arial",fill:"#fff",backgroundColor:"black",boundsAlignV:"middle"}),this.speechText1=this.game.add.text(10,50,"A dastardly villain has travelled through time and stolen artifacts from the Queen's reign",{font:"16px Arial",fill:"#000",backgroundColor:"white",wordWrap:!0,wordWrapWidth:200}),this.speechText2=this.game.add.text(10,50,"Police are baffled. Won't somebody come forward and help? For our country!",{font:"16px Arial",fill:"#000",backgroundColor:"white",wordWrap:!0,wordWrapWidth:200}),this.speechText2.visible=!1,this.updateClock(),this.game.time.events.loop(Phaser.Timer.SECOND,this.updateClock,this),this.game.add.button(this.game.width-120,this.game.height-50,"next_button",this.nextFrame,this),this.game.fadePlugin.fadeIn(0,750,0)},nextFrame:function(){this.speechText1.visible?(this.speechText2.visible=!0,this.speechText1.visible=!1):this.nextLevel()},updateClock:function(){var e=new Date;this.clock.setText(" "+("0"+e.getHours()).slice(-2)+":"+("0"+e.getMinutes()).slice(-2)+" ")},nextLevel:function(){this.transitionning||(this.transitionning=!0,this.game.fadePlugin.fadeOut(0,750,0,function(){this.game.state.start("intro_alexs_house")}))}},Game.State.Navigation=function(){},Game.State.Navigation.prototype={cursors:null,transitionning:!1,buttonsOriginX:24,buttonsOriginY:24,buttonsMargin:30,buttonsPerRow:3,buttonHeight:48,buttonWidth:48,collectibleSize:10,create:function(){this.game.analytics.stateStarted("navigation"),this.transitionning=!1,this.createState(),this.game.fadePlugin.fadeIn(0,750,0)},createState:function(){var e=this.game.add.graphics(0,0),t=0,a=0;e.beginFill(0,1),e.drawRect(this.game.camera.x,this.game.camera.y,1.5*this.game.width,1.5*this.game.height),e.endFill(),this.buttonsGroup=this.game.add.group(),Game.Levels.forEach(function(e){var s,i,o,n=Game.Score.levelScores[e.stateKey],r=0;i=this.buttonsOriginX+a*(this.buttonWidth+this.buttonsMargin),o=this.buttonsOriginY+t*(this.buttonHeight+this.buttonsMargin),s=this.game.add.button(i,o,e.spriteKey,this.nextLevel,this),s.properties=e,e.collectibles.forEach(function(e){var t,a,s=i+18*r,l=o+this.buttonHeight+10,h=!1,c=6710886;n&&n.scoredItems.forEach(function(t){t.sprite_key===e&&(h=!0)}.bind(this)),"."===e?(h&&(c=16777215),t=this.game.add.graphics(0,0),t.properties={},t.properties.collectibleName=e,t.beginFill(c,1),t.drawRect(s,l,this.collectibleSize,this.collectibleSize),t.endFill()):(h||(e+="_grey"),t=this.game.add.sprite(s,l,e),a=Math.min(this.collectibleSize/t.width,this.collectibleSize/t.height),t.scale.setTo(a,a)),r++}.bind(this)),a+1>=this.buttonsPerRow?(a=0,t++):a++}.bind(this)),this.cursors=this.game.input.keyboard.createCursorKeys()},nextLevel:function(e){this.transitionning||(this.transitionning=!0,this.game.fadePlugin.fadeOut(0,750,0,function(){this.game.state.start(e.properties.stateKey||"tutorial")}))}},Game.State.Preloader=function(){},Game.State.Preloader.prototype={preload:function(){this.stage.backgroundColor="#000000",this.add.sprite(195,138,"crown"),this.textGroup=this.game.add.group(),this.textGroup.fixedToCamera=!0,this.textGroup.add(new Phaser.BitmapText(this.game,this.game.width/2-50,this.game.height/2-15,"pixeltype","Loading...",40)),this.game.load.image("intro_ticker","assets/sprites/intro-ticker.png"),this.game.load.image("skynews_logo","assets/sprites/8bit_sky_logo.png"),this.game.load.image("kay","assets/sprites/kayburley.png"),this.game.load.image("alexs_house","assets/sprites/alexshouse.png"),this.load.spritesheet("player","assets/sprites/alex_character.png",59,69,6),this.load.spritesheet("next_button","assets/sprites/next_button.png",100,30),this.game.load.image("sparkle1","assets/sprites/sparkle1.png"),this.game.load.image("sparkle2","assets/sprites/sparkle2.png"),this.game.load.image("sparkle3","assets/sprites/sparkle3.png"),this.game.load.image("transparent_32-160","assets/sprites/transparent_32-160.png"),this.game.load.image("jewel","assets/sprites/jewel.png"),this.game.load.image("jewel_grey","assets/sprites/jewel_grey.png"),this.game.load.image("corgi","assets/sprites/corgi.png"),this.game.load.image("corgi_grey","assets/sprites/corgi_grey.png"),this.game.load.image("crown_grey","assets/sprites/crown_grey.png"),this.game.load.image("tv","assets/sprites/50s_tv.png"),this.game.load.image("tv_grey","assets/sprites/50s_tv_grey.png"),this.game.load.image("record","assets/sprites/50s_record.png"),this.game.load.image("record_grey","assets/sprites/50s_record_grey.png"),this.game.load.image("mini","assets/sprites/50s_mini.png"),this.game.load.image("mini_grey","assets/sprites/50s_mini_grey.png"),this.game.load.image("beatles","assets/sprites/60s_beatles.png"),this.game.load.image("beatles_grey","assets/sprites/60s_beatles_grey.png"),this.game.load.image("worldcup","assets/sprites/60s_worldcup.png"),this.game.load.image("worldcup_grey","assets/sprites/60s_worldcup_grey.png"),this.game.load.image("the_sun","assets/sprites/60s_the_sun.png"),this.game.load.image("the_sun_grey","assets/sprites/60s_the_sun_grey.png"),this.game.load.image("button_level_50s","assets/sprites/level_buttons/level_50s.png"),this.game.load.image("button_level_60s","assets/sprites/level_buttons/level_60s.png"),this.game.load.image("button_level_70s","assets/sprites/level_buttons/level_70s.png"),this.game.load.image("button_level_80s","assets/sprites/level_buttons/level_80s.png"),this.game.load.image("button_level_90s","assets/sprites/level_buttons/level_90s.png"),this.game.load.image("button_level_00s","assets/sprites/level_buttons/level_00s.png"),this.game.load.image("button_level_10s","assets/sprites/level_buttons/level_10s.png"),this.load.image("compass","assets/sprites/compass_rose.png"),this.load.image("touch_segment","assets/sprites/touch_segment.png"),this.load.image("touch","assets/sprites/touch.png"),this.load.image("pause","assets/sprites/pause.png"),this.load.image("time_machine_button","assets/sprites/time-machine-button.png"),this.load.image("resume_button","assets/sprites/resume-button.png"),this.load.image("restart_level_button","assets/sprites/restart-level-button.png"),this.load.image("share_on_facebook","assets/sprites/share-on-facebook-button.png"),this.load.image("share_on_twitter","assets/sprites/share-on-twitter-button.png"),this.loadTileMaps()},loadTileMaps:function(){var e,t,a={};for(t=0;t<Game.Map.MAPS.length;t++)this.addTileSets(Game.Map.MAPS[t],a);for(e in a)a.hasOwnProperty(e)&&this.load.image(e,a[e])},addTileSets:function(e,t){var a,s,i,o=this.cache.getTilemapData(e).data.tilesets;for(i=0;i<o.length;i++)s=o[i].name,a="assets/maps/"+o[i].image,s in t||(t[s]=a)},create:function(){setTimeout(function(){this.game.fadePlugin.fadeOut(0,750,0,function(){this.game.state.start("intro_skynews")}.bind(this))}.bind(this),500)}},Game.State.Startup=function(){},Game.State.Startup.prototype={preload:function(){this.load.image("crown","assets/sprites/crown.png"),this.load.bitmapFont("nokia","assets/fonts/bitmapFonts/nokia.png","assets/fonts/bitmapFonts/nokia.xml"),this.load.bitmapFont("pixeltype","assets/fonts/bitmapFonts/pixeltype.png","assets/fonts/bitmapFonts/pixeltype.xml");var e,t;for(t=0;t<Game.Map.MAPS.length;t++)e=Game.Map.MAPS[t],
this.load.tilemap(e,"assets/maps/"+e+".json",null,Phaser.Tilemap.TILED_JSON)},create:function(){this.game.scale.scaleMode=Phaser.ScaleManager.SHOW_ALL,this.game.fadePlugin=this.game.plugins.add(new Phaser.Plugin.Fade(this)),this.game.physics.startSystem(Phaser.Physics.ARCADE),this.game.state.start("preloader")}},Game.State.Tutorial=function(){},Game.State.Tutorial.prototype=new Game.State.BaseState,Game.State.Tutorial.prototype.levelKey="tutorial",Game.State.Tutorial.prototype.nextLevelKey="decade_50s",Game.State.Tutorial.prototype.setCollisions=function(){this.levelModule.tilemap.setCollisionBetween(76,84)},Game.State.Tutorial.prototype.createForegroundLayers=function(){this.banisterLayer=this.levelModule.createLayer("banisters"),this.columnLayer=this.levelModule.createLayer("columns")};